import{t as e}from"./table_mixin-Up91sngm.js";import{U as t}from"./UploadHttpComponent-BYOf1cyn.js";import{A as i,B as a,D as l,b as s,r as o,o as d,c as r,d as n,i as h,e as m,j as p,g as c,F as f,v as u,f as b,w as g,t as y,x as w,y as x,z as j,E as v,M}from"./index-3VtalNXz.js";import{v as R}from"./validateRules-33HAVMqP.js";import{v as Y}from"./view_simple_table-DvzHaPqF.js";import{Z as C,a as D,z as k,c as P}from"./zcq-sb-dky-m4cIjOtd.js";import{m as E}from"./modal_select-tyIL9VOp.js";import{v as S}from"./view_file-CiRT0xUh.js";let L=a.base;const $={loadTableDataService:e=>i({url:"".concat(L,"/fxyj/queryNdFxyj"),method:"post",data:e,showLoading:!0}),loadViewDialogService:e=>i({url:"".concat(L,"/fxyj/fxyjLog"),method:"post",data:e,showLoading:!0}),saveTableDataService:e=>i({url:"".concat(L,"/fxyj/saveNdFxyjList"),method:"post",data:e,showLoading:!0}),doDelTableDataService:e=>i({url:"".concat(L,"/fxyj/deleteNdFxyj"),method:"post",data:e,showLoading:!0}),downloadModuleService:e=>i({url:"".concat(L,"/fxyj/download-ndfxyj-tpl"),method:"post",data:e,responseType:"blob",showLoading:!0}).then(e=>{l(e,"年度风险预警导入模板","xlsx")})},I={data:()=>({}),methods:{selectCs(e,t){this.$vxeModal.show(P,{omsDefaultNode:this.$store.state.omsDefaultNode,d5000DefaultNode:this.$store.state.d5000DefaultNode,showOMS:!1},{width:600,height:188,title:"选择停电厂站类型"},{refreshCZXX:i=>{e[t.field]=i.CZMC,e[t.field+"Id"]=i.CZID,e[t.field+"lx"]=i.tdcslx,e[t.field+"Param"]=i,e[t.field+"Param0"]=i}})},selectSb(e,t){if(!e.tdcslx)return void this.$message({message:"停电场所类型为空，请先选择停电场所",type:"warning"});if(!e.tdcsParam)return void this.$message({message:"当前为非对象化场所，请重选场所后再选择停电设备",type:"warning"});let i={id:e.id,tdcsParam:e.tdcsParam,bdlx:"rjh-dd"};"D5000"==e.tdcslx?this.$vxeModal.show(C,{paramdata:i,sblist:e[t.field+"List"],isCommon:!0},{width:1e3,height:650,title:"设备选择-D5000"},{refreshSBXX:i=>{e[t.field+"List"]=i,e[t.field+"List0"]=i,e[t.field+"Id"]=i.map(e=>e.sbid).join(","),e[t.field]=i.map(e=>e.sbddmm).join(",")}}):"OMS"==e.tdcslx?this.$vxeModal.show(D,{paramdata:i,sblist:e[t.field+"List"],isCommon:!0},{width:1e3,height:650,title:"设备选择-OMS"},{refreshSBXX:i=>{e[t.field+"List"]=i,e[t.field+"List0"]=i,e[t.field+"Id"]=i.map(e=>e.sbid).join(","),e[t.field]=i.map(e=>e.sbddmm).join(",")}}):"DKY"==e.tdcslx&&this.$vxeModal.show(k,{paramdata:i,sblist:e[t.field+"List"],isCommon:!0},{width:1e3,height:650,title:"设备选择-DKY"},{refreshSBXX:i=>{e[t.field+"List"]=i,e[t.field+"List0"]=i,e[t.field+"Id"]=i.map(e=>e.sbid).join(","),e[t.field]=i.map(e=>e.sbddmm).join(",")}})}}},T={name:"ndfxyj",mixins:[e,I],components:{UploadHttpComponent:t},props:{isModal:{type:Boolean,default:!1}},data:()=>({total:0,searchParams:{keyword:"",year:"",month:"",sortOrder:"",sortColumn:""},tableData:[],isAutoWrap:!1}),watch:{},computed:{tableHeaderList(){return[{type:"checkbox",width:50,fixed:"left"},{type:"seq",width:60,fixed:"left"},{field:"ssdq",title:"地区",width:80,fixed:"left"},{field:"kssj",title:"开始时间",width:140,fixed:"left",sortable:!0,editRender:{name:"ElDatePicker",props:{type:"date",labelFormat:"YYYY-MM-DD",valueFormat:"YYYY-MM-DD",clearable:!0}}},{field:"jssj",title:"结束时间",width:140,fixed:"left",sortable:!0,editRender:{name:"ElDatePicker",props:{type:"date",labelFormat:"YYYY-MM-DD",valueFormat:"YYYY-MM-DD",clearable:!0}}},{field:"gq",title:"工期",width:100,sortable:!0,headerAlign:"center",align:"right",fixed:"left",formatter:["formatterNumber",1],editRender:{name:"ElInput",props:{type:"number",min:0,step:1,clearable:!0}}},{field:"tdcs",title:"停电场所",width:120,fixed:"left",editRender:{}},{field:"tdsb",title:"停电设备",minWidth:220,editRender:{}},{field:"glbm",title:"管理部门",width:120,editRender:{name:"ElSelect",options:this.$store.state.staticOptionsObj.glbm,props:{clearable:!0}}},{field:"zygz",title:"主要工作",minWidth:280,headerAlign:"center",align:"left",editRender:{name:"ElInput",props:{type:"textarea",clearable:!0,autosize:!this.isAutoWrap||{maxRows:1},resize:"none"}}},{field:"state",title:"清单状态",width:120,editRender:{name:"ElInput",props:{clearable:!0}}},{field:"fxfx",title:"风险分析",minWidth:280,headerAlign:"center",align:"left",editRender:{name:"ElInput",props:{type:"textarea",clearable:!0,autosize:!this.isAutoWrap||{maxRows:1},resize:"none"}}},{field:"gzfs",title:"故障方式",width:100,editRender:{name:"ElSelect",options:this.$store.state.staticOptionsObj.gzfs,props:{clearable:!0}}},{field:"jyqfhss",title:"压降前负荷损失（MW）",minWidth:140,sortable:!0,headerAlign:"center",align:"right",formatter:["formatterNumber",2],editRender:{name:"ElInput",props:{type:"number",min:0,step:1,clearable:!0}}},{field:"jyhfhss",title:"压降后负荷损失（MW）",minWidth:140,sortable:!0,headerAlign:"center",align:"right",formatter:["formatterNumber",2],editRender:{name:"ElInput",props:{type:"number",min:0,step:1,clearable:!0}}},{field:"jyhfhsshj",title:"压降后负荷损失单电源用户合计",minWidth:140,sortable:!0,headerAlign:"center",align:"right",formatter:["formatterNumber",2],editRender:{name:"ElInput",props:{type:"number",min:0,step:1,clearable:!0}}},{field:"jyhzyyh",title:"压降后涉及全停重要用户",width:170,editRender:{name:"ElInput",props:{clearable:!0}}},{field:"yjjb",title:"预警级别",width:110,editRender:{name:"ElSelect",options:this.$store.state.staticOptionsObj.yjjb,props:{clearable:!0}}},{field:"yjfbdw",title:"预警发布单位",width:140,editRender:{name:"ElSelect",options:this.$store.state.staticOptionsObj.yjfbdw,props:{clearable:!0}}},{field:"fileList",title:"风险专报",width:300,slots:{default:"fileList_default"}},{field:"ly",title:"来源",width:120,editRender:{name:"ElSelect",options:[{label:"年度",value:"年度"},{label:"年度新增",value:"年度新增"},{label:"年度调整",value:"年度调整"},{label:"配合",value:"配合"}],props:{clearable:!0}}},{title:"日志",width:100,fixed:"right",slots:{default:"action"}}]},tableDetailHeaderList(){return[{field:"kssj",title:"开始时间",width:"50%",editRender:{name:"ElDatePicker",props:{type:"date",labelFormat:"YYYY-MM-DD",valueFormat:"YYYY-MM-DD"}}},{field:"jssj",title:"结束时间",width:"50%",itemClass:"borderRight",editRender:{name:"ElDatePicker",props:{type:"date",labelFormat:"YYYY-MM-DD",valueFormat:"YYYY-MM-DD"}}},{field:"tdcs",title:"停电场所",width:"100%",itemClass:"borderRight",editRender:{name:"$modal",props:{type:"tdcs"}}},{field:"tdsb",title:"停电设备",width:"100%",itemClass:"borderRight",editRender:{name:"$modal",props:{type:"tdsb"}}},{field:"glbm",title:"管理部门",width:"50%",editRender:{name:"ElSelect",options:this.$store.state.staticOptionsObj.glbm,props:{clearable:!0}}},{field:"gq",title:"工期",width:"50%",itemClass:"borderRight",editRender:{name:"ElInputNumber",props:{type:"number",min:0,step:1,clearable:!0}}},{field:"zygz",title:"主要工作",width:"100%",itemClass:"whole_row borderRight",editRender:{name:"ElInput",props:{type:"textarea",clearable:!0,autosize:!this.isAutoWrap||{maxRows:1},resize:"none"}}},{field:"fxfx",title:"风险分析",width:"100%",itemClass:"whole_row borderRight",editRender:{name:"ElInput",props:{type:"textarea",clearable:!0,autosize:!this.isAutoWrap||{maxRows:1},resize:"none"}}},{field:"gzfs",title:"故障方式",width:"50%",editRender:{name:"ElSelect",options:this.$store.state.staticOptionsObj.gzfs,props:{clearable:!0}}},{field:"jyqfhss",title:"压降前负荷损失（MW）",width:"50%",itemClass:"borderRight",editRender:{name:"ElInput",props:{type:"number",min:0,step:1}}},{field:"jyhfhss",title:"压降后负荷损失（MW）",width:"50%",itemClass:"height2",editRender:{name:"ElInput",props:{type:"number",min:0,step:1}}},{field:"jyhfhsshj",title:"压降后负荷损失单电源用户合计",width:"50%",itemClass:"borderRight",editRender:{name:"ElInput",props:{type:"number",min:0,step:1}}},{field:"yjjb",title:"预警级别",width:"50%",editRender:{name:"ElSelect",options:this.$store.state.staticOptionsObj.yjjb,props:{clearable:!0}}},{field:"jyhzyyh",title:"压降后涉及全停重要用户",width:"50%",itemClass:"borderRight",editRender:{name:"ElInput",props:{clearable:!0}}},{field:"yjfbdw",title:"预警发布单位",width:"50%",itemClass:"borderBottom",editRender:{name:"ElSelect",options:this.$store.state.staticOptionsObj.yjfbdw,props:{clearable:!0}}},{field:"state",title:"清单状态",width:"50%",itemClass:"borderBottom borderRight",editRender:{name:"ElInput",props:{clearable:!0}}}]},editRules:()=>({kssj:[{required:!0,message:"开始时间不能为空"},R.date.rule,{validator({cellValue:e,row:t}){if(e&&t.jssj&&j(e).isAfter(t.jssj))return new Error("开始时间必须在结束时间之前")}}],jssj:[{required:!0,message:"结束时间不能为空"},R.date.rule,{validator({cellValue:e,row:t}){if(e&&t.kssj&&j(e).isBefore(t.kssj))return new Error("结束时间必须在开始时间之后")}}],tdcs:[{required:!0,message:"停电场所不能为空"}],tdsb:[{required:!0,message:"停电设备不能为空"}],glbm:[{required:!0,message:"管理部门不能为空"}],zygz:[{required:!0,message:"主要工作不能为空"}],fxfx:[{required:!0,message:"风险分析不能为空"}],yjjb:[{required:!0,message:"预警级别不能为空"}],yjfbdw:[{required:!0,message:"预警发布单位不能为空"}]}),gridOptions(){return{height:"auto",border:!0,round:!0,stripe:!0,headerAlign:"center",align:"center",loading:!1,keepSource:!0,rowConfig:{isCurrent:!0,isHover:!0},radioConfig:{highlight:!0},checkboxConfig:{highlight:!0},columnConfig:{resizable:!0},sortConfig:{remote:!0},filterConfig:{remote:!0},showOverflow:this.isAutoWrap,headerCellClassName:"row-class",pagerConfig:this.pagerConfig,editConfig:{trigger:"click",mode:"cell",showStatus:!this.isModal,showIcon:!this.isModal,beforeEditMethod:this.beforeEditMethod},proxyConfig:{seq:!0,showResponseMsg:!1,showActionMsg:!1,sort:!0,filter:!0,ajax:{query:({page:e,sorts:t,filters:i})=>this.loadTableApi(e,t,i),queryAll:({sorts:e,filters:t})=>this.loadTableApi({pageSize:1e5,currentPage:1},e,t),delete:({body:e})=>this.doDeleteApi(e.removeRecords),save:({body:e})=>this.doSaveApi(e)}},exportConfig:{filename:"年度风险预警表",sheetName:"sheet1",type:"xlsx",mode:"all",modes:["current","selected","all"],message:!1,columns:this.tableHeaderList.filter(e=>"checkbox"!==e.type),exportMethod:this.exportMethod,afterExportMethod:this.afterExportMethod},menuConfig:{enabled:!this.isModal,body:{options:[[{code:"collect",name:"标记重点"}]]}},editRules:this.editRules,columns:this.tableHeaderList}},defaultLeftButtons(){return this.isModal?[{type:"gradientGreen",name:"查询"},{type:"gradientDarkGreen",name:"重置"}]:[{type:"gradientGreen",name:"查询"},{type:"gradientDarkGreen",name:"重置"},{type:"gradientGreen",name:"自动换行"}]},defaultRightButtons(){return this.isModal?[{type:"gradientBlue",name:"确定"}]:[{type:"gradientBlue",name:"下载导入模版"},{type:"gradientBlue",name:"复制"},{type:"gradientBlue",name:"新增"},{type:"gradientBlue",name:"保存"},{type:"gradientRed",name:"删除"}]}},created(){this.isModal?(this.searchParams.month=j().format("YYYY-MM"),this.searchParams.flag="1"):this.searchParams.year=j().format("YYYY")},mounted(){},methods:{reloadTableData(){this.$refs.xTable.commitProxy("query")},loadTableData(){this.$refs.xTable.commitProxy("reload")},loadTableApi(e,t,i){let a=this.getRealParams(this.searchParams,e,t,i);return new Promise(t=>{$.loadTableDataService(a).then(i=>{1e5==e.pageSize?(this.total=i.total,t(i.data)):(this.total=i.total,t({result:i.data,page:{total:i.total}}))})})},toggleWrap(){this.isAutoWrap?this.isAutoWrap=!1:this.isAutoWrap="tooltip"},doAdd(){this.$refs.xTable.insertAt({}).then(e=>{this.$refs.xTable.setEditRow(e)})},doSave(){const e=this.getUpdateRecords();e&&e.length>0&&this.$refs.xTable.commitProxy("save")},doSaveApi(e){return new Promise((t,i)=>{let{insertRecords:a,updateRecords:l}=e,s=[...a,...l];$.saveTableDataService({data:s}).then(e=>{this.$message.success(e.data),t()}).catch(()=>{i()})})},doDelete(){const e=this.getCheckboxRecords();e&&e.length>0&&this.$confirm("确认删除勾选的".concat(e.length,"条数据吗？"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.$refs.xTable.commitProxy("delete")})},doDeleteApi(e){return new Promise((t,i)=>{let a=e.map(e=>e.id).join(",");$.doDelTableDataService({ids:a}).then(e=>{this.$message.success(e.data),t()}).catch(()=>{i()})})},doCopy(){const e=this.getCheckboxRecord();if(e&&1==e.length){let t=this.tableHeaderList.filter(e=>e.title&&"日志"!=e.title).map(e=>e.title);this.$vxeModal.show(E,{formComponent:["checkbox"],checkboxList:t,defaultValue:{checkList:t}},{width:800,title:"选择复制列",height:400},{submit:t=>{let i=this.tableHeaderList.filter(e=>t.checkList.includes(e.title)).map(e=>e.field),a={};for(let l=0;l<i.length;l++)a[i[l]]=e[0][i[l]],"tdcs"!=i[l]?"tdsb"==i[l]&&(a[i[l]+"Id"]=e[0][i[l]+"Id"],a[i[l]+"List"]=e[0][i[l]+"List"],a[i[l]+"List0"]=e[0][i[l]+"List0"]):(a[i[l]+"Id"]=e[0][i[l]+"Id"],a[i[l]+"lx"]=e[0][i[l]+"lx"],a[i[l]+"Param"]=e[0][i[l]+"Param"],a[i[l]+"Param0"]=e[0][i[l]+"Param0"]);this.$refs.xTable.insertAt(a).then(e=>{this.$refs.xTable.setEditRow(e)})}})}},downloadModule(){v.exportFileService("/fxyj/download-ndfxyj-tpl",{})},doExport(e){v.exportFileService("/fxyj/exportNdFxyj",this.searchParams,e,this.pagerParam)},cellClick(e){let{row:t,column:i}=e;"tdcs"==i.field&&this.selectCs(t,i),"tdsb"==i.field&&this.selectSb(t,i)},doConfirm(){const e=this.getCheckboxRecords();e&&e.length>0&&this.$confirm("确认初始化勾选的".concat(e.length,"条数据吗？"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.$emit("doSubmit",e)})},doViewLog(e){$.loadViewDialogService({id:e.id}).then(e=>{this.$vxeModal.show(Y,{tableHeaderList:[{type:"seq",width:60},{field:"czr",title:"操作人",width:"100"},{field:"time",title:"操作时间",width:"150"},{field:"nr",title:"内容"}],tableData:e.data},{width:800,title:"日志",height:600},{})})},uploadMethod({file:e},t){const i=new FormData;return i.append("file",e),i.append("id",t.id),i.append("type","fxyj"),v.uploadFileService(i).then(e=>e.data)},downloadMethod({option:e}){v.downloadFileGetService({fileId:e.id})},removeMethod({option:e},t){e.id&&v.removeFileService({fileId:e.id,id:t.id}).then(()=>{this.$message.success("移除成功")})},previewMethod({option:e}){this.$store.state.isXzs?v.preViewFileGetService({fileId:e.id}):v.preViewFileService({fileId:e.id}).then(e=>{let t=M(e,"pdf")+"#toolbar=0";this.$vxeModal.show(S,{url:t},{width:800,title:"文件预览",height:window.innerHeight-20},{})})},resetParams(){this.isModal?(this.searchParams.month=j().format("YYYY-MM"),this.searchParams.flag="1"):this.searchParams.year=j().format("YYYY"),this.searchParams.keyword="",this.searchParams.sortOrder="",this.searchParams.sortColumn="",this.$nextTick(function(){this.loadTableData()})},beforeEditMethod({row:e,column:t}){return"tdcs"!=t.field&&"tdsb"!=t.field&&!this.isModal}}},z={class:"page_content"},A={key:0,class:"header-item"},_={key:1,class:"header-item"},O={class:"header-item"},B={class:"header-item"},q={key:2,class:"header-item"},V={key:0,class:"header-item"},F={class:"header-item"};const W=s(T,[["render",function(e,t,i,a,l,s){const j=o("el-date-picker"),v=o("el-input"),M=o("el-button"),R=o("arrow-down"),Y=o("el-icon"),C=o("el-dropdown-item"),D=o("el-dropdown-menu"),k=o("el-dropdown"),P=o("upload-http-component"),E=o("vxe-button"),S=o("vxe-upload"),L=o("vxe-grid");return d(),r("div",z,[n("header",null,[n("section",null,[i.isModal?p("",!0):(d(),r("div",A,[t[6]||(t[6]=h(" 年份： ",-1)),m(j,{modelValue:l.searchParams.year,"onUpdate:modelValue":t[0]||(t[0]=e=>l.searchParams.year=e),type:"year",format:"YYYY","value-format":"YYYY"},null,8,["modelValue"])])),i.isModal?(d(),r("div",_,[t[7]||(t[7]=h(" 月份： ",-1)),m(j,{modelValue:l.searchParams.month,"onUpdate:modelValue":t[1]||(t[1]=e=>l.searchParams.month=e),type:"month",format:"YYYY-MM","value-format":"YYYY-MM"},null,8,["modelValue"])])):p("",!0),n("div",O,[m(v,{placeholder:"请输入停电设备",modelValue:l.searchParams.keyword,"onUpdate:modelValue":t[2]||(t[2]=e=>l.searchParams.keyword=e),onKeydown:c(s.loadTableData,["enter"]),title:l.searchParams.keyword,clearable:""},null,8,["modelValue","onKeydown","title"])]),n("div",B,[(d(!0),r(f,null,u(s.defaultLeftButtons,(t,i)=>(d(),b(M,{type:t.type,plain:t.plain,key:i+"defaultLeftButtons",onClick:i=>e.btnClick(t)},{default:g(()=>[h(y(t.name),1)]),_:2},1032,["type","plain","onClick"]))),128))]),i.isModal?p("",!0):(d(),r("div",q,[m(k,null,{dropdown:g(()=>[m(D,null,{default:g(()=>[m(C,{onClick:s.doExport},{default:g(()=>[...t[9]||(t[9]=[h("导出当前页",-1)])]),_:1},8,["onClick"]),m(C,{onClick:t[3]||(t[3]=e=>s.doExport(!0))},{default:g(()=>[...t[10]||(t[10]=[h("导出全部",-1)])]),_:1})]),_:1})]),default:g(()=>[m(M,{type:"gradientGreen"},{default:g(()=>[t[8]||(t[8]=h(" 导出",-1)),m(Y,{class:"el-icon--right"},{default:g(()=>[m(R)]),_:1})]),_:1})]),_:1})]))]),n("section",null,[i.isModal?p("",!0):(d(),r("div",V,[m(P,{"prop-upload-url":"/fxyj/import-ndfxyj",onLoadTableData:t[4]||(t[4]=e=>s.loadTableData(!0))})])),n("div",F,[(d(!0),r(f,null,u(s.defaultRightButtons,(t,i)=>(d(),b(M,{type:t.type,plain:t.plain,key:i+"defaultRightButtons",onClick:i=>e.btnClick(t)},{default:g(()=>[h(y(t.name),1)]),_:2},1032,["type","plain","onClick"]))),128))])])]),n("article",null,[m(L,w(s.gridOptions,{ref:"xTable"},x({cellClick:s.cellClick}),{onMenuClick:t[5]||(t[5]=t=>e.menuClickEvent(t,"风险预警"))}),{action:g(({row:e})=>[e.id?(d(),b(E,{key:0,mode:"text",status:"primary",onClick:t=>s.doViewLog(e)},{default:g(()=>[...t[11]||(t[11]=[h("日志",-1)])]),_:1},8,["onClick"])):p("",!0)]),fileList_default:g(({row:e})=>[m(S,{multiple:"",isDisabeld:this.isModal,"file-types":["doc","docx","xls","xlsx","ppt","pptx","pdf","dwg"],modelValue:e.fileList,"onUpdate:modelValue":t=>e.fileList=t,"more-config":{maxCount:5,layout:"horizontal"},"show-button-text":!1,"show-download-button":"","upload-method":t=>s.uploadMethod(t,e),"download-method":s.downloadMethod,"remove-method":t=>s.removeMethod(t,e)},{corner:g(({option:e})=>[m(E,{mode:"text",icon:"vxe-icon-search",status:"primary",style:{"padding-right":"0"},onClick:t=>s.previewMethod({option:e})},null,8,["onClick"])]),_:1},8,["isDisabeld","modelValue","onUpdate:modelValue","upload-method","download-method","remove-method"])]),_:1},16)])])}],["__scopeId","data-v-7949a25c"]]),N=Object.freeze(Object.defineProperty({__proto__:null,default:W},Symbol.toStringTag,{value:"Module"}));export{I as c,N as i,W as n};
