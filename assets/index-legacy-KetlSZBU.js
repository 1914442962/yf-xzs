!function(){function e(e,t,i,l,a,d,o){try{var r=e[d](o),s=r.value}catch(e){return void i(e)}r.done?t(s):Promise.resolve(s).then(l,a)}function t(t){return function(){var i=this,l=arguments;return new Promise(function(a,d){var o=t.apply(i,l);function r(t){e(o,a,d,r,s,"next",t)}function s(t){e(o,a,d,r,s,"throw",t)}r(void 0)})}}function i(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,l)}return i}function l(e){for(var t=1;t<arguments.length;t++){var l=null!=arguments[t]?arguments[t]:{};t%2?i(Object(l),!0).forEach(function(t){a(e,t,l[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(l)):i(Object(l)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(l,t))})}return e}function a(e,t,i){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var l=i.call(e,t||"default");if("object"!=typeof l)return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}System.register(["./table_mixin-legacy-Cub7_6-X.js","./index-legacy-D5DnMBNv.js","./view_simple_table-legacy-lf9IsoOC.js","./dynamic_form_plus-legacy-DggWEs9J.js","./polyfill-legacy-aWkUxw0k.js","./zcq-sb-dky-legacy-F_c-Nbh-.js","./view_file-legacy-5QZYZh0d.js"],function(e,i){"use strict";var a,d,o,r,s,n,c,h,p,u,m,b,f,g,w,x,y,v,C,z,D,R,j,B;return{setters:[e=>{a=e.t,d=e.v},e=>{o=e.z,r=e.A,s=e.B,n=e._,c=e.D,h=e.r,p=e.o,u=e.c,m=e.b,b=e.F,f=e.q,g=e.e,w=e.w,x=e.h,y=e.t,v=e.d,C=e.v,z=e.x,D=e.n,R=e.i},e=>{j=e.v},e=>{B=e.d},null,null,null],execute:function(){let i=r.base;const T={loadTreeDataService:e=>o({url:`${i}/api/tzbgd/getMenuTree`,method:"get",showLoading:!0}),loadButtonDataService:e=>o({url:`${i}/sbqd/queryButtons`,method:"post",data:e,showLoading:!0}),loadTableDataService:e=>o({url:`${i}/api/tzbgd/node`,method:"post",data:e,showLoading:!0}),saveTableDataService:e=>o({url:`${i}/api/tzbgd/submit`,method:"post",data:e,showLoading:!0}),getTableConfigService:e=>new Promise((t,i)=>{e.node.name.includes("已")&&"相关查询"===e.node.parentName?t({data:{enabledField:""}}):e.node.name.includes("编制")?t({data:{enabledField:"xmmc,gznr,yjtysj,bzr,fileList"}}):t({data:{enabledField:""}})}),getDetailDataService:(e,t)=>o({url:`${i}/api/tzbgd/getInfo?id=${e}&type=${t}`,method:"get",showLoading:!0}),doOperateService:e=>o({url:`${i}/api/tzbgd/audit`,method:"post",data:e,showLoading:!0}),doDelTableDataService:e=>o({url:`${i}/api/tzbgd/deleteTzbgd?id=${e}`,method:"get",showLoading:!0}),loadDialogDataService:e=>o({url:`${i}/api/tzbgd/getLogInfo?id=${e}`,method:"get",showLoading:!0}),loadFlowDataService:e=>o({url:`${i}/sbqd/getLct`,method:"post",data:e,showLoading:!0}),exportTableDataFileService:(e,t)=>o({url:`${i}/common/deleteById`,method:"post",data:e,responseType:"blob",showLoading:!0}).then(e=>{s(e,t,"xlsx")}),downloadModuleService:e=>o({url:`${i}/common/downLoadModule`,method:"post",data:e,responseType:"blob",showLoading:!0}).then(e=>{s(e,"导入模板","xlsx")})},S={name:"mmlc_table",mixins:[a],components:{},props:{node:Object,buttons:Array},data:()=>({time:["",""],total:0,searchParams:{sortOrder:"",sortColumn:""},tableData:[],isAutoWrap:!1,defaultLeftButtons:[],defaultRightButtons:[],innerButtons:[]}),watch:{},computed:{tableHeaderList(){return[{type:"checkbox",width:50,fixed:"left"},{type:"seq",width:60,fixed:"left"},{field:"bh",title:"编号",width:120,fixed:"left"},{field:"xmmc",title:"项目名称",width:160},{field:"gznr",title:"工作内容",minWidth:250,editRender:{name:"ElInput",props:{type:"textarea",clearable:!0,autosize:!this.isAutoWrap||{maxRows:1},resize:"none"}}},{field:"yjtysj",title:"预计投运时间",sortable:!0,width:160,formatter:["formatterTime"]},{field:"fileList",title:"附件名称",minWidth:180,showOverflow:"tooltip",cellRender:{name:"VxeUpload",props:{readonly:!0,moreConfig:{maxCount:1,layout:"horizontal"}}}},{field:"bzr",title:"编制人",width:90},{field:"fbsj",title:"发布时间",sortable:!0,width:150,formatter:["formatterTime"]},{field:"status",title:"状态",width:100}]},tableDetailHeaderList(){return[{title:"变更单编制",width:"50px",children:[{field:"bh",title:"编号",width:"calc(50% - 25px)",disabled:!0,itemClass:"child",editRender:{}},{field:"xmmc",title:"项目名称",width:"calc(50% - 25px)",disabled:!0,itemClass:"borderRight child",editRender:{name:"ElInput",props:{clearable:!0}}},{field:"gznr",title:"工作内容",width:"calc(100% - 50px)",disabled:!0,itemClass:"whole_row borderRight child",editRender:{name:"ElInput",props:{type:"textarea",clearable:!0,autosize:!this.isAutoWrap||{maxRows:1},resize:"none"}}},{field:"yjtysj",title:"预计投运时间",width:"calc(100% - 50px)",disabled:!0,itemClass:"borderRight child",editRender:{name:"ElDatePicker",props:{type:"datetime",labelFormat:"YYYY-MM-DD HH:mm:ss",valueFormat:"YYYY-MM-DD HH:mm:ss"}}},{field:"bzr",title:"编制人",width:"calc(50% - 25px)",disabled:!0,itemClass:"child",editRender:{name:"ElInput",props:{clearable:!0},icons:[],associateField:"fbsj"}},{field:"fbsj",title:"发布时间",width:"calc(50% - 25px)",disabled:!0,itemClass:"borderRight child",editRender:{}},{field:"fileList",title:"附件",width:"calc(100% - 50px)",disabled:!0,itemClass:"whole_row borderRight child",editRender:{name:"vxeUpload",props:{multiple:!0,types:["doc","docx","xls","xlsx","pdf"],type:"sbmmbg",limitSize:50}}}]},{title:"运方审核",width:"50px",children:[{field:"yfYj",title:"运方意见",width:"calc(100% - 50px)",disabled:!0,itemClass:"whole_row borderRight child height2",editRender:{name:"ElInput",props:{type:"textarea",clearable:!0}}},{field:"yfQz",title:"运方签字",width:"calc(50% - 25px)",disabled:!0,itemClass:"child",editRender:{name:"ElInput",props:{clearable:!0},icons:[],associateField:"yfQzsj"}},{field:"yfQzsj",title:"运方签字时间",width:"calc(50% - 25px)",disabled:!0,itemClass:"borderRight child",editRender:{}}]},{title:"继保审核",width:"50px",children:[{field:"jbYj",title:"继保意见",width:"calc(100% - 50px)",disabled:!0,itemClass:"whole_row borderRight child height2",editRender:{name:"ElInput",props:{type:"textarea",clearable:!0,autosize:!this.isAutoWrap||{maxRows:1},resize:"none"}}},{field:"jbQz",title:"继保签字",width:"calc(50% - 25px)",disabled:!0,itemClass:"child",editRender:{name:"ElInput",props:{clearable:!0},icons:[],associateField:"jbQzsj"}},{field:"jbQzsj",title:"继保签字时间",width:"calc(50% - 25px)",disabled:!0,itemClass:"borderRight child",editRender:{}}]},{title:"调度审核",width:"50px",children:[{field:"ddYj",title:"调度意见",width:"calc(100% - 50px)",disabled:!0,itemClass:"whole_row borderRight child height2",editRender:{name:"ElInput",props:{type:"textarea",clearable:!0}}},{field:"ddQz",title:"调度签字",width:"calc(50% - 25px)",disabled:!0,itemClass:"child",editRender:{name:"ElInput",props:{clearable:!0},icons:[],associateField:"ddQzsj"}},{field:"ddQzsj",title:"调度签字时间",width:"calc(50% - 25px)",disabled:!0,itemClass:"borderRight child",editRender:{}}]},{title:"自动化审核",width:"50px",children:[{field:"zdhYj",title:"自动化意见",width:"calc(100% - 50px)",disabled:!0,itemClass:"whole_row borderRight child height2",editRender:{name:"ElInput",props:{type:"textarea",clearable:!0}}},{field:"zdhQz",title:"自动化签字",width:"calc(50% - 25px)",disabled:!0,itemClass:"child",editRender:{name:"ElInput",props:{clearable:!0},icons:[],associateField:"zdhQzsj"}},{field:"zdhQzsj",title:"自动化签字时间",width:"calc(50% - 25px)",disabled:!0,itemClass:"borderRight child",editRender:{}}]},{title:"自动化执行",width:"50px",children:[{field:"zdhZxYj",title:"自动化执行意见",width:"calc(100% - 50px)",disabled:!0,itemClass:"whole_row borderRight child height2",editRender:{name:"ElInput",props:{type:"textarea",clearable:!0}}},{field:"zdhZxQz",title:"自动化执行签字",width:"calc(50% - 25px)",disabled:!0,itemClass:"child",editRender:{name:"ElInput",props:{clearable:!0},icons:[],associateField:"zdhZxQzsj"}},{field:"zdhZxQzsj",title:"自动化执行时间",width:"calc(50% - 25px)",disabled:!0,itemClass:"borderRight child",editRender:{}}]},{title:"调度确认",width:"50px",itemClass:"borderBottom",children:[{field:"ddZxsm",title:"调度确认说明",width:"calc(100% - 50px)",disabled:!0,itemClass:"whole_row borderRight child height2",editRender:{name:"ElInput",props:{type:"textarea",clearable:!0,autosize:!this.isAutoWrap||{maxRows:1},resize:"none"}}},{field:"zxrQz",title:"执行人签字",width:"calc(50% - 25px)",disabled:!0,itemClass:"child borderBottom",editRender:{name:"ElInput",props:{clearable:!0},icons:[],associateField:"ddhqqzsj"}},{field:"zxrQzsj",title:"执行人签字时间",width:"calc(50% - 25px)",disabled:!0,itemClass:"borderBottom borderRight child",editRender:{}}]}]},editRules:()=>({xmmc:[{required:!0,message:"项目名称不能为空"}],gznr:[{required:!0,message:"工作内容不能为空"}],yjtysj:[{required:!0,message:"预计投运时间不能为空"}],bzr:[{required:!0,message:"编制人不能为空"}]}),gridOptions(){return{height:"auto",keepSource:!0,border:!0,round:!0,stripe:!0,headerAlign:"center",align:"center",loading:!1,rowConfig:{isCurrent:!0,isHover:!0},radioConfig:{highlight:!0},checkboxConfig:{highlight:!0},columnConfig:{resizable:!0},sortConfig:{remote:!0},filterConfig:{remote:!0},showOverflow:this.isAutoWrap,headerCellClassName:"row-class",pagerConfig:this.pagerConfig,proxyConfig:{seq:!0,showResponseMsg:!1,showActionMsg:!1,sort:!0,filter:!0,ajax:{query:({page:e,sorts:t,filters:i})=>this.loadTableApi(e,t,i),queryAll:({sorts:e,filters:t})=>this.loadTableApi({pageSize:1e5,currentPage:1},e,t),delete:({body:e})=>this.doDeleteApi(e.removeRecords)}},exportConfig:{filename:"设备命名变更表格",sheetName:"sheet1",type:"xlsx",mode:"all",modes:["current","selected","all"],message:!1,columns:this.tableHeaderList.filter(e=>"checkbox"!==e.type),exportMethod:this.exportMethod,afterExportMethod:this.afterExportMethod},menuConfig:{body:{options:[[{code:"collect",name:"标记重点"}]]}},columns:this.tableHeaderList,cellClassName:({row:e,column:t})=>"jszt"===t.field&&"未接收"===e.jszt?"row-red":null}},defaultDefaultButtons:()=>[{type:"gradientGreen",name:"查询"},{type:"gradientGreen",name:"自动换行"}]},mounted(){this.getButtons()},methods:{getButtons(){let e=this.buttons;this.defaultLeftButtons=e.outerBtns.filter(e=>"left"==e.position),this.defaultRightButtons=e.outerBtns.filter(e=>"right"==e.position),this.innerButtons=e.insideBtns},reloadTableData(){this.$refs.xTable.commitProxy("query")},loadTableData(){this.$refs.xTable.commitProxy("reload")},loadTableApi(e,t,i){let a=this.getRealParams(this.searchParams,e,t,i);return new Promise(t=>{T.loadTableDataService(l(l({},a),this.node)).then(i=>{1e5==e.pageSize?(this.total=i.total,t(i.data)):(this.total=i.total,t({result:i.data,page:{total:i.total}}))})})},toggleWrap(){this.isAutoWrap?this.isAutoWrap=!1:this.isAutoWrap="tooltip"},doDelete(){var e=this;const i=this.getCheckboxRecords();i&&i.length>0&&this.$confirm(`确认删除勾选的${i.length}条数据吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(t(function*(){yield e.$refs.xTable.commitProxy("delete"),e.loadTableData(),e.$emit("loadTree")}))},doDeleteApi(e){return new Promise((t,i)=>{let l=e.map(e=>e.id).join(",");T.doDelTableDataService(l).then(()=>{this.$message.success("删除成功"),t()}).catch(()=>{i()})})},resetParams(){this.searchParams.keyword="",this.searchParams.sortOrder="",this.searchParams.sortColumn="",this.time=["",""],this.$nextTick(function(){this.loadTableData()})},doAdd(){var e=this;return t(function*(){let t=yield c.getAddIdService().then(e=>e.data),i="xmmc,gznr,yjtysj,bzr,fileList".split(","),l=JSON.parse(JSON.stringify(e.tableDetailHeaderList));for(let e=0;e<i.length;e++)for(let t=0;t<l.length;t++){let a=l[t].children;for(let t=0;t<a.length;t++)a[t].field!=i[e]&&a[t].field+"Btn"!=i[e]||(i[e].includes("Btn")?a[t].editRender.icons=["edit"]:a[t].disabled=!1)}l=e.node.name.includes("编制")?l.filter(e=>e.title.includes("编制")):l;let a=l.length-1,d=l[a].children.length-1;l[a].itemClass="borderBottom",l[a].children[d].itemClass+=" borderBottom",l[a].children[d].width.includes("50%")&&(l[a].children[d-1].itemClass+=" borderBottom"),e.$vxeModal.show(B,{tableHeaderList:l,validateRules:e.editRules,row:{id:t,fileList:[]},labelWidth:"120px"},{width:1200,title:"新增",height:window.innerHeight-200},{doSubmit:t=>{t.isAdd=1,T.saveTableDataService(t).then(()=>{e.$message.success("保存成功"),e.$vxeModal.closeAll(),e.loadTableData(),e.$emit("loadTree")})}})})()},doExport(e){c.exportFileService("/sbqd/export",l(l({},this.searchParams),{},{nodeId:this.node.id}),e,this.pagerParam)},cellDblclick(e){let{row:t}=e;this.openDetail(t)},openDetail(e){var i=this;T.getDetailDataService(e.id,this.node.role).then(e=>{let l=e.data.enabledField.replaceAll("Qz","QzBtn").replaceAll("fj","fileList").split(","),a=JSON.parse(JSON.stringify(this.tableDetailHeaderList));for(let t=0;t<l.length;t++)for(let e=0;e<a.length;e++){let i=a[e].children;for(let e=0;e<i.length;e++)i[e].field!=l[t]&&i[e].field+"Btn"!=l[t]||(l[t].includes("Btn")?i[e].editRender.icons=["edit"]:i[e].disabled=!1)}a=this.node.name.includes("编制")?a.filter(e=>e.title.includes("编制")):a;let d=a.length-1,o=a[d].children.length-1;var r;a[d].itemClass="borderBottom",a[d].children[o].itemClass+=" borderBottom",a[d].children[o].width.includes("50%")&&(a[d].children[o-1].itemClass+=" borderBottom"),this.$vxeModal.show(B,{tableHeaderList:a,validateRules:this.editRules,row:e.data,labelWidth:"120px",footerButtonList:this.innerButtons},{width:1200,title:"详情",height:window.innerHeight-20},{close:()=>{},doSubmit:e=>{e.isAdd=0,T.saveTableDataService(e).then(()=>{this.$message.success("保存成功"),this.$vxeModal.closeAll(),this.loadTableData(),this.$emit("loadTree")})},doOperate:(r=t(function*(e){"查看流程图"==e.btn.name?i.doViewFlow():"查看日志"==e.btn.name?i.doViewDialog([e.data]):(e.data.isAdd=0,T.saveTableDataService(e.data).then(()=>{i.doOperation(e.btn,[e.data])}))}),function(e){return r.apply(this,arguments)})})})},doViewDialog(e=[]){e&&0!=e.length||(e=this.getCheckboxRecords()),e&&e.length>0&&T.loadDialogDataService(e[0].id).then(e=>{this.$vxeModal.show(j,{tableHeaderList:[{type:"seq",width:60},{field:"action",title:"操作",width:"80"},{field:"operateTime",title:"操作时间",width:"150",sortable:!0,formatter:["formatterTime"]},{field:"operator",title:"操作人",width:"90"},{field:"node",title:"开始节点",width:"100"},{field:"nextNode",title:"结束节点",width:"100"},{field:"opinion",title:"意见",align:"left",headerAlign:"center"},{field:"isUpdate",title:"是否修改",width:"80"}],tableData:e.data},{width:900,title:"日志",height:600},{})})},doOperation(e,t=[]){t&&0!=t.length||(t=this.getCheckboxRecord()),t&&t.length>0&&this.$vxeModal.show(d,{isRequire:!1},{width:360,height:220,title:`输入${e.name}意见`,resize:!1},{returnData:i=>{let l={tzbgdId:t[0].id,currentNode:this.node.role,action:e.action,opinion:i,isUpdate:"0"};T.doOperateService(l).then(()=>{this.$message.success(`${e.name}成功`),this.$vxeModal.closeAll(),this.loadTableData(),this.$emit("loadTree")})}})}}},L={class:"page_content"},$={class:"header-item"},O={class:"header-item"};const k=n(S,[["render",function(e,t,i,l,a,d){const o=h("el-button"),r=h("vxe-grid");return p(),u("div",L,[m("header",null,[m("section",null,[m("div",$,[(p(!0),u(b,null,f(d.defaultDefaultButtons,(t,i)=>(p(),g(o,{type:t.type,plain:t.plain,key:i+"defaultDefaultButtons",onClick:i=>e.btnClick(t)},{default:w(()=>[x(y(t.name),1)]),_:2},1032,["type","plain","onClick"]))),128)),(p(!0),u(b,null,f(a.defaultLeftButtons,t=>(p(),g(o,{type:t.type,onClick:i=>e.btnClick(t)},{default:w(()=>[x(y(t.name),1)]),_:2},1032,["type","onClick"]))),256))])]),m("section",null,[m("div",O,[(p(!0),u(b,null,f(a.defaultRightButtons,t=>(p(),g(o,{type:t.type,onClick:i=>e.btnClick(t)},{default:w(()=>[x(y(t.name),1)]),_:2},1032,["type","onClick"]))),256))])])]),m("article",null,[v(r,C(d.gridOptions,{ref:"xTable"},z({cellDblclick:d.cellDblclick}),{onMenuClick:t[0]||(t[0]=t=>e.menuClickEvent(t,"设备启动"))}),null,16)])])}],["__scopeId","data-v-43ee1b8c"]]);e("default",n({name:"mmbg",components:{Mmbg_table:k},data:()=>({treeData:[],node:{},buttons:{outerBtns:[],insideBtns:[]}}),created(){this.loadLeftData()},methods:{customNodeClass({id:e}){return this.node.id==e?"active_tree":""},loadLeftData(){T.loadTreeDataService({}).then(e=>{this.treeData=e.data,this.node.id||this.handleNodeClick(this.treeData[0].children[0])})},handleNodeClick(e){if(!e.children||0===e.children.length){this.buttons={outerBtns:e.outerBtns,insideBtns:e.insideBtns};let t=JSON.parse(JSON.stringify(e));delete t.outerBtns,delete t.insideBtns,delete t.children,this.node=t}}}},[["render",function(e,t,i,l,a,d){const o=h("el-tree"),r=h("el-aside"),s=h("mmbg_table"),n=h("el-main"),c=h("el-container");return p(),g(c,{id:"mmbg"},{default:w(()=>[v(r,null,{default:w(()=>[t[0]||(t[0]=m("p",null,[m("span",{class:"mmbg_left"}),x("设备命名变更")],-1)),v(o,{data:a.treeData,onNodeClick:d.handleNodeClick,"default-expand-all":!0,props:{class:d.customNodeClass}},{default:w(({node:e,data:t})=>[m("div",null,[m("i",{class:D([t.icon,"tree_icon"])},null,2),x(" "+y(t.name),1)])]),_:1},8,["data","onNodeClick","props"])]),_:1}),v(n,null,{default:w(()=>[a.node.id?(p(),g(s,{key:a.node.id,node:a.node,buttons:a.buttons,onLoadTree:d.loadLeftData},null,8,["node","buttons","onLoadTree"])):R("",!0)]),_:1})]),_:1})}],["__scopeId","data-v-f83630a8"]]))}}})}();
