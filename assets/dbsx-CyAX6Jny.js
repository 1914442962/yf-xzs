import{A as e,B as t,b as a,o as i,c as s,r as o,d as n,e as r,w as d,j as l,F as c,v as h,f as m,t as u,x as b,z as f}from"./index-0nalUVid.js";import{t as g}from"./table_mixin-Bm7KLuSQ.js";import"./polyfill-lGe4XDVY.js";let w=t.base;const p={loadTabDataService:t=>e({url:"".concat(w,"/first/getDbSxTab"),method:"post",data:t,showLoading:!0}),loadTableDataService:t=>e({url:"".concat(w,"/first/queryDbSx"),method:"post",data:t,showLoading:!0}),editStatusDataService:t=>e({url:"".concat(w,"/first/changeDbSx"),method:"post",data:t,showLoading:!0}),getNodeService:t=>e({url:"".concat(w,"/first/queryJxdId"),method:"post",data:t,showLoading:!0}),changeDbSxService:t=>e({url:"".concat(w,"/first/changeDbSxNew"),method:"post",data:t,showLoading:!0})},v=["src"];const D=a({name:"view_iframe",props:{src:String},data:()=>({iframeWin:{}}),mounted(){this.iframeWin=this.$refs.iframe.contentWindow,window.addEventListener("message",this.receiveMessage)},unmounted(){window.removeEventListener("message",this.receiveMessage)},methods:{receiveMessage(e){"returnData"===e.data.event&&this.$emit("returnData",e.data.data),"multi-jxd-close-tab"===e.data.name&&this.$emit("close")}}},[["render",function(e,t,a,o,n,r){return i(),s("iframe",{src:a.src,style:{width:"100%",height:"100%",border:"none"},ref:"iframe",id:"iframe"},null,8,v)}],["__scopeId","data-v-537d0786"]]),T={class:"page_content"},x={key:0,class:"red_point"};const N=a({name:"dbsx",mixins:[g],data:()=>({total:0,tabList:[],searchParams:{type:""},clickTimer:null}),watch:{"searchParams.type":{handler(e){e&&this.loadTableData()},immediate:!1}},computed:{innerWidth:()=>window.innerWidth,tableHeaderList:()=>[{field:"DQZT",width:10,slots:{default:"dqzt"}},{type:"seq",width:60},{field:"MOULD_NAME",title:"模块"},{field:"PAR_MODULE",title:"名称"},{field:"DBNR",title:"详情",headerAlign:"center",align:"left"},{field:"JZSJ",title:"截止时间"}],gridOptions(){return{height:"auto",keepSource:!0,border:!1,round:!0,headerAlign:"center",align:"center",loading:!1,rowConfig:{isCurrent:!0,isHover:!0},radioConfig:{highlight:!0},toolbarConfig:{slots:{buttons:"toolbarButtons"}},checkboxConfig:{highlight:!0,reserve:!0,showServeStatus:!0,range:!0},showOverflow:this.isAutoWrap,headerCellClassName:"row-class",proxyConfig:{seq:!0,showResponseMsg:!1,showActionMsg:!1,sort:!0,filter:!0,autoLoad:!1,ajax:{query:()=>this.loadTableApi()}},cellClassName:({row:e,column:t})=>"JZSJ"==t.field&&f(e.JZSJ).isBefore(f())?"row-red":null,columns:this.tableHeaderList}}},created(){},mounted(){this.getTabList()},methods:{getTabList(){p.loadTabDataService({}).then(e=>{this.tabList=e.data,this.tabList.length>0&&(this.searchParams.type?this.loadTableData():this.searchParams.type=this.tabList[0].name)})},reloadTableData(){this.$refs.xTable.commitProxy("query")},loadTableData(){this.$refs.xTable.commitProxy("reload")},loadTableApi(){return new Promise(e=>{p.loadTableDataService(this.searchParams).then(t=>{e(t.data)})})},cellClick({row:e}){clearTimeout(this.clickTimer),"未处理"===e.DQZT&&(this.clickTimer=setTimeout(()=>{p.editStatusDataService({id:e.ID,eventId:e.EVENTID,state:"已读"}).then(e=>{this.$message.success(e.data),this.getTabList()})},250))},cellDblclickEvent({column:e,row:t}){clearTimeout(this.clickTimer),p.getNodeService({bh:t.DBNR}).then(e=>{e.data.jxid?("未处理"===t.DQZT&&p.editStatusDataService({id:t.ID,eventId:t.EVENTID,state:"已读"}),this.openIframe(e.data,t)):p.editStatusDataService({id:t.ID,eventId:t.EVENTID,state:"已处理"}).then(()=>{this.getTabList()})})},closeModal(){QClient.Base.Utils.invokeGMethod("pop-notification-window","openFrame","false")},openIframe(e,t){let a="";a=window.origin.includes("192.168.1")?"http://192.168.1.194:10015/master/window.html#/spa/ycjx-rjh/public-visit?flag=13&userName=".concat(this.$store.state.userInfo.sysUser.loginName,"&id=").concat(e.jxid,"&nodeName=").concat(e.nodeName,"&parentNodeName=").concat(e.parentNodeName,"&nodeId=").concat(e.nodeId,"&flowNodeId=").concat(e.flowNodeId):"".concat(window.YCJX_WEBSITE_URL,"/master/window.html#/spa/ycjx-rjh/public-visit?flag=13&userName=").concat(this.$store.state.userInfo.sysUser.loginName,"&id=").concat(e.jxid,"&nodeName=").concat(e.nodeName,"&parentNodeName=").concat(e.parentNodeName,"&nodeId=").concat(e.nodeId,"&flowNodeId=").concat(e.flowNodeId),this.$vxeModal.show(D,{src:a},{width:window.innerWidth-10,title:"检修单详情",height:window.innerHeight-10,showZoom:!0},{close:()=>{p.changeDbSxService({state:e.state,jxid:e.jxid,dbId:t.ID,dbState:t.DQZT,eventId:t.EVENTID}).then(()=>{this.getTabList()})}})}}},[["render",function(e,t,a,f,g,w){const p=o("vxe-tab-pane"),v=o("vxe-tabs"),D=o("vxe-grid");return i(),s("div",T,[n("article",null,[r(D,b(w.gridOptions,{ref:"xTable",onCellClick:w.cellClick,onCellDblclick:w.cellDblclickEvent}),{toolbarButtons:d(()=>[r(v,{modelValue:g.searchParams.type,"onUpdate:modelValue":t[0]||(t[0]=e=>g.searchParams.type=e),width:w.innerWidth},{default:d(()=>[(i(!0),s(c,null,h(g.tabList,(e,t)=>(i(),m(p,{title:e.name,name:e.name,key:"tabList"+t},{"title-suffix":d(()=>[n("span",null,"（"+u(e.total)+"）",1)]),_:2},1032,["title","name"]))),128))]),_:1},8,["modelValue","width"])]),dqzt:d(({row:e})=>["未处理"===e.DQZT?(i(),s("span",x)):l("",!0)]),_:1},16,["onCellClick","onCellDblclick"])])])}],["__scopeId","data-v-e555f561"]]);export{N as default};
