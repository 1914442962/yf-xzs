import{t as e}from"./table_mixin-Up91sngm.js";import{d as t}from"./drfx-api-B0R9DOMP.js";import{b as a,r as s,o as i,c as r,d as o,e as l,i as d,g as n,F as m,v as c,f as p,w as h,t as u,x as f,E as g,z as b}from"./index-3VtalNXz.js";import{D as w}from"./DateRangerPickerComponent-C2bPbeCa.js";import"./polyfill-lGe4XDVY.js";const y={class:"page_content"},x={class:"header-item"},k={class:"header-item"},P={class:"header-item"},C={class:"header-item"},R={class:"header-item"};const v=a({name:"drfx",mixins:[e],components:{DateRangerPickerComponent:w},data:()=>({total:0,searchParams:{bh:"",keyword:"",lx:"单日",sortOrder:"",sortColumn:"",sdt:"",edt:""},tableData:[],isAutoWrap:!1}),watch:{},computed:{tableHeaderList(){return[{type:"checkbox",width:50,fixed:"left"},{type:"seq",width:60,fixed:"left"},{field:"bh",title:"检修编号",width:180},{field:"tdsb",title:"停电设备",minWidth:180,headerAlign:"center",align:"left",editRender:{name:"ElInput",props:{type:"textarea",clearable:!0,autosize:!this.isAutoWrap||{maxRows:1},resize:"none"}}},{field:"fxms",title:"风险描述",minWidth:200,headerAlign:"center",align:"left",editRender:{name:"ElInput",props:{type:"textarea",clearable:!0,autosize:!this.isAutoWrap||{maxRows:1},resize:"none"}}},{field:"fxdj",title:"风险等级",width:100,editRender:{name:"ElInput",props:{clearable:!0}}},{field:"kssj",title:"开始时间",width:140,sortable:!0,editRender:{name:"ElDatePicker",props:{type:"datetime",labelFormat:"YYYY-MM-DD HH:mm",valueFormat:"YYYY-MM-DD HH:mm",timeFormat:"HH:mm",clearable:!0}}},{field:"jssj",title:"结束时间",width:140,sortable:!0,editRender:{name:"ElDatePicker",props:{type:"datetime",labelFormat:"YYYY-MM-DD HH:mm",valueFormat:"YYYY-MM-DD HH:mm",timeFormat:"HH:mm",clearable:!0}}},{field:"yq",title:"要求",minWidth:200,headerAlign:"center",align:"left",editRender:{name:"ElInput",props:{type:"textarea",clearable:!0,autosize:!this.isAutoWrap||{maxRows:1},resize:"none"}}},{field:"bm",title:"部门",minWidth:120,editRender:{name:"ElInput",props:{type:"textarea",clearable:!0,autosize:!this.isAutoWrap||{maxRows:1},resize:"none"}}},{title:"操作",width:100,fixed:"right",slots:{default:"action"}}]},editRules:()=>({kssj:[{required:!0,message:"开始时间不能为空"},{validator({cellValue:e,row:t}){if(e&&t.jssj&&b(e).isAfter(t.jssj))return new Error("开始时间必须在结束时间之前")}}],jssj:[{required:!0,message:"结束时间不能为空"},{validator({cellValue:e,row:t}){if(e&&t.kssj&&b(e).isBefore(t.kssj))return new Error("结束时间必须在开始时间之后")}}]}),gridOptions(){return{height:"auto",border:!0,round:!0,stripe:!0,headerAlign:"center",keepSource:!0,align:"center",loading:!1,rowConfig:{isCurrent:!0,isHover:!0},columnConfig:{resizable:!0},resizeConfig:{isDblclickAutoWidth:!0},sortConfig:{remote:!0},showOverflow:this.isAutoWrap,headerCellClassName:"row-class",pagerConfig:this.pagerConfig,proxyConfig:{seq:!0,showResponseMsg:!1,showActionMsg:!1,sort:!0,filter:!0,ajax:{query:({page:e,sorts:t,filters:a})=>this.loadTableApi(e,t,a),queryAll:({sorts:e,filters:t})=>this.loadTableApi({pageSize:1e5,currentPage:1},e,t),save:({body:e})=>this.doSaveApi(e)}},editConfig:{trigger:"click",mode:"cell",showStatus:!0,showIcon:!0,beforeEditMethod:this.beforeEditMethod},editRules:this.editRules,columns:this.tableHeaderList,menuConfig:{body:{options:[[{code:"collect",name:"标记重点"}]]}}}},defaultLeftButtons:()=>[{type:"gradientGreen",name:"查询"},{type:"gradientDarkGreen",name:"重置"},{type:"gradientGreen",name:"自动换行"}],defaultRightButtons:()=>[{type:"gradientBlue",name:"保存"},{type:"gradientBlue",name:"发送短信"}]},mounted(){},methods:{reloadTableData(){this.$refs.xTable.commitProxy("query")},loadTableData(){this.$refs.xTable.commitProxy("reload")},loadTableApi(e,a,s){let i=this.getRealParams(this.searchParams,e,a,s);return new Promise(a=>{t.loadTableDataService(i).then(t=>{1e5==e.pageSize?(this.total=t.total,a(t.data)):(this.total=t.total,a({result:t.data,page:{total:t.total}}))})})},toggleWrap(){this.isAutoWrap?this.isAutoWrap=!1:this.isAutoWrap="tooltip"},doSave(){const e=this.getUpdateRecords();e&&e.length>0&&this.$refs.xTable.commitProxy("save")},doSaveApi(e){return new Promise((a,s)=>{let{insertRecords:i,updateRecords:r}=e,o=[...i,...r];t.saveTableDataService({data:o}).then(e=>{this.$message.success(e.data),a()}).catch(()=>{s()})})},resetParams(){this.searchParams.bh="",this.searchParams.keyword="",this.searchParams.sortOrder="",this.searchParams.sortColumn="",this.searchParams.sdt="",this.searchParams.edt="",this.$nextTick(function(){this.loadTableData()})},doExport(e){g.exportFileService("/fxyj/exportDrTx",this.searchParams,e,this.pagerParam)},doViewLog(e){let t="";t=window.origin.includes("192.168.1")?"http://192.168.1.194:10015/master/window.html#/spa/ycjx-snjh/public-visit?&flag=3&type=dd&id=".concat(e.jxdId,"&parentNodeName=地调调度台"):"".concat(window.YCJX_WEBSITE_URL,"/master/window.html#/spa/ycjx-snjh/public-visit?&flag=3&type=dd&id=").concat(e.jxdId,"&parentNodeName=地调调度台"),window.open(t)},doSendMessage(e){if(e&&e.id)this.doRealSendMessage([e]);else{const e=this.getCheckboxRecords();e&&e.length>0&&this.doRealSendMessage(e)}},doRealSendMessage(e){t.doSendMessageService({data:e}).then(e=>{this.$message.success(e.data)})},beforeEditMethod:({row:e,column:t})=>!0}},[["render",function(e,t,a,g,b,w){const v=s("DateRangerPickerComponent"),j=s("el-input"),D=s("el-button"),T=s("arrow-down"),A=s("el-icon"),E=s("el-dropdown-item"),S=s("el-dropdown-menu"),M=s("el-dropdown"),_=s("vxe-button"),Y=s("vxe-grid");return i(),r("div",y,[o("header",null,[o("section",null,[l(v,{"start-time":b.searchParams.sdt,"end-time":b.searchParams.edt,updateStartTime:b.searchParams.sdt,"onUpdate:updateStartTime":t[0]||(t[0]=e=>b.searchParams.sdt=e),updateEndTime:b.searchParams.edt,"onUpdate:updateEndTime":t[1]||(t[1]=e=>b.searchParams.edt=e)},null,8,["start-time","end-time","updateStartTime","updateEndTime"]),o("div",x,[t[6]||(t[6]=d(" 检修编号： ",-1)),l(j,{placeholder:"请输入检修编号",modelValue:b.searchParams.bh,"onUpdate:modelValue":t[2]||(t[2]=e=>b.searchParams.bh=e),onKeydown:n(w.loadTableData,["enter"]),title:b.searchParams.bh,clearable:""},null,8,["modelValue","onKeydown","title"])]),o("div",k,[l(j,{placeholder:"请输入关键字",modelValue:b.searchParams.keyword,"onUpdate:modelValue":t[3]||(t[3]=e=>b.searchParams.keyword=e),onKeydown:n(w.loadTableData,["enter"]),title:b.searchParams.keyword,clearable:""},null,8,["modelValue","onKeydown","title"])]),o("div",P,[(i(!0),r(m,null,c(w.defaultLeftButtons,(t,a)=>(i(),p(D,{type:t.type,plain:t.plain,key:a+"defaultLeftButtons",onClick:a=>e.btnClick(t)},{default:h(()=>[d(u(t.name),1)]),_:2},1032,["type","plain","onClick"]))),128))]),o("div",C,[l(M,null,{dropdown:h(()=>[l(S,null,{default:h(()=>[l(E,{onClick:w.doExport},{default:h(()=>[...t[8]||(t[8]=[d("导出当前页",-1)])]),_:1},8,["onClick"]),l(E,{onClick:t[4]||(t[4]=e=>w.doExport(!0))},{default:h(()=>[...t[9]||(t[9]=[d("导出全部",-1)])]),_:1})]),_:1})]),default:h(()=>[l(D,{type:"gradientGreen"},{default:h(()=>[t[7]||(t[7]=d(" 导出",-1)),l(A,{class:"el-icon--right"},{default:h(()=>[l(T)]),_:1})]),_:1})]),_:1})])]),o("section",null,[o("div",R,[(i(!0),r(m,null,c(w.defaultRightButtons,(t,a)=>(i(),p(D,{type:t.type,plain:t.plain,key:a+"defaultRightButtons",onClick:a=>e.btnClick(t)},{default:h(()=>[d(u(t.name),1)]),_:2},1032,["type","plain","onClick"]))),128))])])]),o("article",null,[l(Y,f(w.gridOptions,{ref:"xTable",onMenuClick:t[5]||(t[5]=t=>e.menuClickEvent(t,"风险预警"))}),{action:h(({row:e})=>[l(_,{mode:"text",status:"primary",onClick:t=>w.doViewLog(e)},{default:h(()=>[...t[10]||(t[10]=[d("查看",-1)])]),_:1},8,["onClick"]),l(_,{mode:"text",status:"primary",onClick:t=>w.doSendMessage(e)},{default:h(()=>[...t[11]||(t[11]=[d("发送短信",-1)])]),_:1},8,["onClick"])]),_:1},16)])])}],["__scopeId","data-v-5b3064de"]]);export{v as default};
