!function(){function e(e,t,a,i,l,o,d){try{var s=e[o](d),r=s.value}catch(e){return void a(e)}s.done?t(r):Promise.resolve(r).then(i,l)}function t(t){return function(){var a=this,i=arguments;return new Promise(function(l,o){var d=t.apply(a,i);function s(t){e(d,l,o,s,r,"next",t)}function r(t){e(d,l,o,s,r,"throw",t)}s(void 0)})}}function a(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,i)}return a}function i(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?a(Object(i),!0).forEach(function(t){l(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):a(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}function l(e,t,a){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var i=a.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}System.register(["./index-legacy-C9R4tdre.js","./table_mixin-legacy-DIG8w3YV.js","./dynamic_form-legacy-Boj_rN6B.js","./view_simple_table-legacy-BbRzJWvH.js","./theme-default-legacy-CnvmjJHj.js","./view_flow.vue_vue_type_style_index_1_scoped_290ab896_lang-legacy-CnvmjJHj.js","./polyfill-legacy-aWkUxw0k.js","./view_file-legacy-Bt94_HJw.js","./zcq-sb-dky-legacy-D5iGgNmW.js"],function(e,a){"use strict";var l,o,d,s,r,n,c,h,u,p,f,m,g,b,y,w,v,x,D,j,k,_,T,C,$;return{setters:[e=>{l=e.z,o=e.A,d=e.B,s=e._,r=e.D,n=e.r,c=e.o,h=e.c,u=e.b,p=e.h,f=e.d,m=e.f,g=e.F,b=e.q,y=e.e,w=e.w,v=e.t,x=e.v,D=e.x,j=e.n,k=e.i},e=>{_=e.t,T=e.v},e=>{C=e.d},e=>{$=e.v},null,null,null,null,null],execute:function(){let a=o.base;const P={loadTreeDataService:e=>l({url:`${a}/jxjh/getMenu`,method:"post",data:e,showLoading:!0}),loadButtonDataService:e=>l({url:`${a}/public/getButton`,method:"post",data:e,showLoading:!0}),loadInnerButtonDataService:e=>l({url:`${a}/public/getTcButton`,method:"post",data:e,showLoading:!0}),loadTableDataService:e=>l({url:`${a}/jxjh/bgd`,method:"post",data:e,showLoading:!0}),saveTableDataService:e=>l({url:`${a}/jxjh/saveBgd`,method:"post",data:e,showLoading:!0}),doDelTableDataService:e=>l({url:`${a}/jxjh/deleteBgd`,method:"post",data:e,showLoading:!0}),loadDialogDataService:e=>l({url:`${a}/jxjh/bgdLog`,method:"post",data:e,showLoading:!0}),loadFlowDataService:e=>l({url:`${a}/common/deleteById`,method:"post",data:e,showLoading:!0}),exportTableDataFileService:(e,t)=>l({url:`${a}/common/deleteById`,method:"post",data:e,responseType:"blob",showLoading:!0}).then(e=>{d(e,t,"xlsx")}),downloadModuleService:e=>l({url:`${a}/common/downLoadModule`,method:"post",data:e,responseType:"blob",showLoading:!0}).then(e=>{d(e,"导入模板","xlsx")})},L={name:"fsbgd_table",mixins:[_],components:{},props:{node:Object},data:()=>({time:["",""],total:0,searchParams:{keyword:"",sdt:"",edt:"",sortOrder:"",sortColumn:""},tableData:[],isAutoWrap:!1,defaultLeftButtons:[],defaultRightButtons:[]}),watch:{time:{handler(e){e?(this.searchParams.sdt=e[0],this.searchParams.edt=e[1]):(this.searchParams.sdt="",this.searchParams.edt="")},immediate:!1}},computed:{tableHeaderList:()=>[{type:"checkbox",width:50,fixed:"left"},{type:"seq",width:60,fixed:"left"},{field:"bh",title:"编号",width:120,fixed:"left"},{field:"fslx",title:"方式类型",width:120},{field:"bgdmc",title:"变更单名称",width:120},{field:"bgdnr",title:"变更单内容",minWidth:160,headerAlign:"center",align:"left"},{field:"bzr",title:"编制人",width:90},{field:"bzsj",title:"编制时间",sortable:!0,width:150},{field:"tzsj",title:"调整时间",sortable:!0,width:150},{field:"fszt",title:"方式状态",width:100},{field:"dqzt",title:"处理状态",width:120,slots:{default:"dqzt"}}],tableDetailHeaderList(){return[{field:"bh",title:"变更单编号",colWidth:"50%",editRender:{}},{field:"bgdmc",title:"变更单名称",colWidth:"50%",editRender:{name:"ElInput",props:{clearable:!0}}},{field:"fslx",title:"方式类型",colWidth:"50%",editRender:{name:"$ElTreeSelect",data:this.$store.state.staticOptionsObj.fslx,props:{clearable:!0}}},{field:"tzsj",title:"调整时间",colWidth:"50%",editRender:{name:"ElDatePicker",props:{type:"datetime",labelFormat:"YYYY-MM-DD HH:mm:ss",valueFormat:"YYYY-MM-DD HH:mm:ss"}}},{field:"bgdnr",title:"变更单内容",editRender:{name:"ElInput",props:{type:"textarea",clearable:!0,autosize:!this.isAutoWrap||{maxRows:1},resize:"none"}}},{field:"fileList",title:"附件",editRender:{name:"vxeUpload",props:{multiple:!0,types:["doc","docx","xls","xlsx","pdf"],type:"fsbgd",limitSize:50}}},{field:"fszt",title:"方式状态",editRender:{name:"$ElTreeSelect",data:this.$store.state.staticOptionsObj.fszt,props:{clearable:!0,filterable:!0}}}]},editRules:()=>({bgdmc:[{required:!0,message:"变更单名称不能为空"}],fslx:[{required:!0,message:"方式类型不能为空"}],tzsj:[{required:!0,message:"调整时间不能为空"}],bgdnr:[{required:!0,message:"变更单内容不能为空"}],fszt:[{required:!0,message:"变更单内容不能为空"}]}),gridOptions(){return{height:"auto",keepSource:!0,border:!0,round:!0,stripe:!0,headerAlign:"center",align:"center",loading:!1,rowConfig:{isCurrent:!0,isHover:!0},radioConfig:{highlight:!0},checkboxConfig:{highlight:!0},columnConfig:{resizable:!0},sortConfig:{remote:!0},filterConfig:{remote:!0},showOverflow:this.isAutoWrap,headerCellClassName:"row-class",pagerConfig:this.pagerConfig,proxyConfig:{seq:!0,showResponseMsg:!1,showActionMsg:!1,sort:!0,filter:!0,ajax:{query:({page:e,sorts:t,filters:a})=>this.loadTableApi(e,t,a),queryAll:({sorts:e,filters:t})=>this.loadTableApi({pageSize:1e5,currentPage:1},e,t),delete:({body:e})=>this.doDeleteApi(e.removeRecords)}},exportConfig:{filename:"方式变更单表格",sheetName:"sheet1",type:"xlsx",mode:"all",modes:["current","selected","all"],message:!1,columns:this.tableHeaderList.filter(e=>"checkbox"!==e.type),exportMethod:this.exportMethod,afterExportMethod:this.afterExportMethod},columns:this.tableHeaderList,menuConfig:{body:{options:[[{code:"collect",name:"标记重点"}]]}},cellClassName:({row:e,column:t})=>"jszt"===t.field&&"未接收"===e.jszt?"row-red":null}},defaultDefaultButtons:()=>[{type:"gradientGreen",name:"查询"},{type:"gradientDarkGreen",name:"重置"},{type:"gradientGreen",name:"自动换行"}]},mounted(){this.getButtons()},methods:{getButtons(){P.loadButtonDataService({id:this.node.id,title:this.node.title}).then(e=>{this.defaultLeftButtons=e.data.filter(e=>"left"==e.position),this.defaultRightButtons=e.data.filter(e=>"right"==e.position)}).catch(()=>{this.defaultLeftButtons=[{type:"gradientBlue",name:"查看日志"},{type:"gradientBlue",name:"查看流程图"}],this.defaultRightButtons=[{type:"gradientBlue",name:"新增"},{type:"gradientRed",name:"删除"},{type:"gradientBlue",name:"发送"}]})},reloadTableData(){this.$refs.xTable.commitProxy("query")},loadTableData(){this.$refs.xTable.commitProxy("reload")},loadTableApi(e,t,a){let l=this.getRealParams(this.searchParams,e,t,a);return new Promise(t=>{P.loadTableDataService(i(i({},l),{},{id:this.node.id,title:this.node.title})).then(a=>{1e5==e.pageSize?(this.total=a.total,t(a.data)):(this.total=a.total,t({result:a.data,page:{total:a.total}}))})})},toggleWrap(){this.isAutoWrap?this.isAutoWrap=!1:this.isAutoWrap="tooltip"},doDelete(){var e=this;const a=this.getCheckboxRecords();a&&a.length>0&&this.$confirm(`确认删除勾选的${a.length}条数据吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(t(function*(){yield e.$refs.xTable.commitProxy("delete"),e.loadTableData(),e.$emit("loadTree")}))},doDeleteApi(e){return new Promise((t,a)=>{let i=e.map(e=>e.id).join(",");P.doDelTableDataService({ids:i}).then(e=>{this.$message.success(e.data),t()}).catch(()=>{a()})})},resetParams(){this.searchParams.keyword="",this.searchParams.sortOrder="",this.searchParams.sortColumn="",this.time=["",""],this.$nextTick(function(){this.loadTableData()})},doAdd(){r.getAddIdService().then(e=>{this.$vxeModal.show(C,{tableHeaderList:this.tableDetailHeaderList,validateRules:this.editRules,row:{id:e.data,fileList:[]},labelWidth:"120px"},{width:800,title:"新增",height:window.innerHeight-400},{doSubmit:e=>{let t={id:this.node.id,title:this.node.title,button:"新增",data:[e]};P.saveTableDataService(t).then(e=>{this.$message.success(e.data),this.$vxeModal.closeAll(),this.loadTableData(),this.$emit("loadTree")})}})})},doExport(e){r.exportFileService("/jxjh/exportBgd",i(i({},this.searchParams),{},{userName:this.$store.state.userInfo.sysUser.nickName,userId:this.$store.state.userInfo.sysUser.id,id:this.node.id,title:this.node.title}),e,this.pagerParam)},cellDblclick(e){let{row:t}=e;this.openDetail(t)},openDetail(e){var a=this;P.loadInnerButtonDataService({id:this.node.id,title:this.node.title}).then(i=>{let l=i.data.some(e=>"保存"==e.name);var o;this.$vxeModal.show(C,{tableHeaderList:this.tableDetailHeaderList,validateRules:this.editRules,row:e,isDisabled:!l,labelWidth:"120px",footerButtonList:i.data},{width:1200,title:"详情",height:window.innerHeight-200},{close:()=>{},doSubmit:e=>{let t={id:this.node.id,title:this.node.title,button:"保存",data:[e]};P.saveTableDataService(t).then(e=>{this.$message.success(e.data),this.$vxeModal.closeAll(),this.loadTableData(),this.$emit("loadTree")})},doOperate:(o=t(function*(e){yield a.doOperation(e.btn,[e.data]),a.$vxeModal.closeAll()}),function(e){return o.apply(this,arguments)})})})},doViewDialog(){const e=this.getCheckboxRecords();e&&e.length>0&&P.loadDialogDataService({bgdId:e[0].id}).then(e=>{this.$vxeModal.show($,{tableHeaderList:[{type:"seq",width:60},{field:"cz",title:"操作",width:"80"},{field:"time",title:"操作时间",width:"150"},{field:"czr",title:"操作人",width:"100"},{field:"ksjd",title:"开始节点"},{field:"jsjd",title:"结束节点"},{field:"yj",title:"意见"}],tableData:e.data},{width:800,title:"日志",height:600},{})})},doOperation(e,t=[]){t&&0!=t.length||(t=this.getCheckboxRecords()),t&&t.length>0&&this.$vxeModal.show(T,{},{width:360,height:220,title:"意见",resize:!1},{returnData:a=>{let i={id:this.node.id,title:this.node.title,button:e.name,yj:a,data:t};P.saveTableDataService(i).then(e=>{this.$message.success(e.data),this.loadTableData(),this.$emit("loadTree")})}})}}},B={class:"page_content"},S={class:"header-item"},z={class:"header-item"},O={class:"header-item"},M={class:"header-item"};const R=s(L,[["render",function(e,t,a,i,l,o){const d=n("el-date-picker"),s=n("el-input"),r=n("el-button"),j=n("arrow-down"),k=n("el-icon"),_=n("el-dropdown-item"),T=n("el-dropdown-menu"),C=n("el-dropdown"),$=n("vxe-tag"),P=n("vxe-grid");return c(),h("div",B,[u("header",null,[u("section",null,[u("div",S,[t[4]||(t[4]=p(" 日期范围： ",-1)),f(d,{modelValue:l.time,"onUpdate:modelValue":t[0]||(t[0]=e=>l.time=e),type:"daterange",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期",style:{width:"250px"}},null,8,["modelValue"])]),u("div",z,[f(s,{placeholder:"请输入关键字",modelValue:l.searchParams.keyword,"onUpdate:modelValue":t[1]||(t[1]=e=>l.searchParams.keyword=e),onKeydown:m(o.loadTableData,["enter"]),title:l.searchParams.keyword,clearable:"",style:{width:"150px"}},null,8,["modelValue","onKeydown","title"])]),u("div",O,[(c(!0),h(g,null,b(o.defaultDefaultButtons,(t,a)=>(c(),y(r,{type:t.type,plain:t.plain,key:a+"defaultDefaultButtons",onClick:a=>e.btnClick(t)},{default:w(()=>[p(v(t.name),1)]),_:2},1032,["type","plain","onClick"]))),128)),f(C,{style:{margin:"0 10px"}},{dropdown:w(()=>[f(T,null,{default:w(()=>[f(_,{onClick:o.doExport},{default:w(()=>[...t[6]||(t[6]=[p("导出当前页",-1)])]),_:1},8,["onClick"]),f(_,{onClick:t[2]||(t[2]=e=>o.doExport(!0))},{default:w(()=>[...t[7]||(t[7]=[p("导出全部",-1)])]),_:1})]),_:1})]),default:w(()=>[f(r,{type:"gradientGreen"},{default:w(()=>[t[5]||(t[5]=p(" 导出",-1)),f(k,{class:"el-icon--right"},{default:w(()=>[f(j)]),_:1})]),_:1})]),_:1}),(c(!0),h(g,null,b(l.defaultLeftButtons,(t,a)=>(c(),y(r,{type:t.type,plain:t.plain,key:a+"defaultLeftButtons",onClick:a=>e.btnClick(t)},{default:w(()=>[p(v(t.name),1)]),_:2},1032,["type","plain","onClick"]))),128))])]),u("section",null,[u("div",M,[(c(!0),h(g,null,b(l.defaultRightButtons,(t,a)=>(c(),y(r,{type:t.type,plain:t.plain,key:a+"defaultRightButtons",onClick:a=>e.btnClick(t)},{default:w(()=>[p(v(t.name),1)]),_:2},1032,["type","plain","onClick"]))),128))])])]),u("article",null,[f(P,x(o.gridOptions,{ref:"xTable"},D({cellDblclick:o.cellDblclick}),{onMenuClick:t[3]||(t[3]=t=>e.menuClickEvent(t,"设备检修"))}),{dqzt:w(({row:e,column:t})=>["已退回"==e.dqzt||"已作废"==e.dqzt?(c(),y($,{key:0,status:"error"},{default:w(()=>[p(v(e.dqzt),1)]),_:2},1024)):e.dqzt.includes("已")?(c(),y($,{key:1,status:"success"},{default:w(()=>[p(v(e.dqzt),1)]),_:2},1024)):(c(),y($,{key:2,status:"info"},{default:w(()=>[p(v(e.dqzt),1)]),_:2},1024))]),_:1},16)])])}],["__scopeId","data-v-499b9abf"]]);e("default",s({name:"fsgbd",components:{Fsbgd_table:R},data:()=>({treeData:[],node:{}}),created(){this.loadLeftData()},methods:{customNodeClass({id:e}){return this.node.id==e?"active_tree":""},loadLeftData(){P.loadTreeDataService({menu:this.keyword}).then(e=>{this.treeData=e.data.menuTreeList,this.node.id||this.handleNodeClick(this.treeData[0].children[0])})},handleNodeClick(e){e.children||(this.node=e)}}},[["render",function(e,t,a,i,l,o){const d=n("el-tree"),s=n("el-aside"),r=n("fsbgd_table"),h=n("el-main"),m=n("el-container");return c(),y(m,{id:"fsbgd"},{default:w(()=>[f(s,null,{default:w(()=>[t[0]||(t[0]=u("p",null,[u("span",{class:"fsbgd_left"}),p("运行方式变更单")],-1)),f(d,{data:l.treeData,onNodeClick:o.handleNodeClick,"default-expand-all":!0,props:{class:o.customNodeClass}},{default:w(({node:e,data:t})=>[u("div",null,[u("i",{class:j([t.icon,"tree_icon"])},null,2),p(" "+v(1==t.type?t.title:t.title+"（"+t.count+"）"),1)])]),_:1},8,["data","onNodeClick","props"])]),_:1}),f(h,null,{default:w(()=>[l.node.id?(c(),y(r,{key:l.node.id,node:l.node,onLoadTree:o.loadLeftData},null,8,["node","onLoadTree"])):k("",!0)]),_:1})]),_:1})}],["__scopeId","data-v-3efd1bcc"]]))}}})}();
