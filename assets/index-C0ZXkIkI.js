import{t as e,v as t}from"./table_mixin-B0gHWcei.js";import{z as i,A as l,B as a,_ as d,D as s,r as o,o as r,c as n,b as h,F as c,q as p,e as m,w as b,h as u,t as f,d as g,v as w,x,n as C,i as y}from"./index-9pCzIQ7O.js";import{v as z}from"./view_simple_table-PAfTPkCG.js";import{d as R}from"./dynamic_form_plus-CwktI8wp.js";import"./polyfill-lGe4XDVY.js";import"./zcq-sb-dky-tsGGPx-L.js";import"./view_file-CHG9eGLA.js";let D=l.base;const v={loadTreeDataService:e=>i({url:"".concat(D,"/api/tzbgd/getMenuTree"),method:"get",showLoading:!0}),loadButtonDataService:e=>i({url:"".concat(D,"/sbqd/queryButtons"),method:"post",data:e,showLoading:!0}),loadTableDataService:e=>i({url:"".concat(D,"/api/tzbgd/node"),method:"post",data:e,showLoading:!0}),saveTableDataService:e=>i({url:"".concat(D,"/api/tzbgd/submit"),method:"post",data:e,showLoading:!0}),getTableConfigService:e=>new Promise((t,i)=>{e.node.name.includes("已")&&"相关查询"===e.node.parentName?t({data:{enabledField:""}}):e.node.name.includes("编制")?t({data:{enabledField:"xmmc,gznr,yjtysj,bzr,fileList"}}):t({data:{enabledField:""}})}),getDetailDataService:(e,t)=>i({url:"".concat(D,"/api/tzbgd/getInfo?id=").concat(e,"&type=").concat(t),method:"get",showLoading:!0}),doOperateService:e=>i({url:"".concat(D,"/api/tzbgd/audit"),method:"post",data:e,showLoading:!0}),doDelTableDataService:e=>i({url:"".concat(D,"/api/tzbgd/deleteTzbgd?id=").concat(e),method:"get",showLoading:!0}),loadDialogDataService:e=>i({url:"".concat(D,"/api/tzbgd/getLogInfo?id=").concat(e),method:"get",showLoading:!0}),loadFlowDataService:e=>i({url:"".concat(D,"/sbqd/getLct"),method:"post",data:e,showLoading:!0}),exportTableDataFileService:(e,t)=>i({url:"".concat(D,"/common/deleteById"),method:"post",data:e,responseType:"blob",showLoading:!0}).then(e=>{a(e,t,"xlsx")}),downloadModuleService:e=>i({url:"".concat(D,"/common/downLoadModule"),method:"post",data:e,responseType:"blob",showLoading:!0}).then(e=>{a(e,"导入模板","xlsx")})},j={class:"page_content"},B={class:"header-item"},T={class:"header-item"};const L=d({name:"mmbg",components:{Mmbg_table:d({name:"mmlc_table",mixins:[e],components:{},props:{node:Object,buttons:Array},data:()=>({time:["",""],total:0,searchParams:{sortOrder:"",sortColumn:""},tableData:[],isAutoWrap:!1,defaultLeftButtons:[],defaultRightButtons:[],innerButtons:[]}),watch:{},computed:{tableHeaderList(){return[{type:"checkbox",width:50,fixed:"left"},{type:"seq",width:60,fixed:"left"},{field:"bh",title:"编号",width:120,fixed:"left"},{field:"xmmc",title:"项目名称",width:160},{field:"gznr",title:"工作内容",minWidth:250,editRender:{name:"ElInput",props:{type:"textarea",clearable:!0,autosize:!this.isAutoWrap||{maxRows:1},resize:"none"}}},{field:"yjtysj",title:"预计投运时间",sortable:!0,width:160,formatter:["formatterTime"]},{field:"fileList",title:"附件名称",minWidth:180,showOverflow:"tooltip",cellRender:{name:"VxeUpload",props:{readonly:!0,moreConfig:{maxCount:1,layout:"horizontal"}}}},{field:"bzr",title:"编制人",width:90},{field:"fbsj",title:"发布时间",sortable:!0,width:150,formatter:["formatterTime"]},{field:"status",title:"状态",width:100}]},tableDetailHeaderList(){return[{title:"变更单编制",width:"50px",children:[{field:"bh",title:"编号",width:"calc(50% - 25px)",disabled:!0,itemClass:"child",editRender:{}},{field:"xmmc",title:"项目名称",width:"calc(50% - 25px)",disabled:!0,itemClass:"borderRight child",editRender:{name:"ElInput",props:{clearable:!0}}},{field:"gznr",title:"工作内容",width:"calc(100% - 50px)",disabled:!0,itemClass:"whole_row borderRight child",editRender:{name:"ElInput",props:{type:"textarea",clearable:!0,autosize:!this.isAutoWrap||{maxRows:1},resize:"none"}}},{field:"yjtysj",title:"预计投运时间",width:"calc(100% - 50px)",disabled:!0,itemClass:"borderRight child",editRender:{name:"ElDatePicker",props:{type:"datetime",labelFormat:"YYYY-MM-DD HH:mm:ss",valueFormat:"YYYY-MM-DD HH:mm:ss"}}},{field:"bzr",title:"编制人",width:"calc(50% - 25px)",disabled:!0,itemClass:"child",editRender:{name:"ElInput",props:{clearable:!0},icons:[],associateField:"fbsj"}},{field:"fbsj",title:"发布时间",width:"calc(50% - 25px)",disabled:!0,itemClass:"borderRight child",editRender:{}},{field:"fileList",title:"附件",width:"calc(100% - 50px)",disabled:!0,itemClass:"whole_row borderRight child",editRender:{name:"vxeUpload",props:{multiple:!0,types:["doc","docx","xls","xlsx","pdf"],type:"sbmmbg",limitSize:50}}}]},{title:"运方审核",width:"50px",children:[{field:"yfYj",title:"运方意见",width:"calc(100% - 50px)",disabled:!0,itemClass:"whole_row borderRight child height2",editRender:{name:"ElInput",props:{type:"textarea",clearable:!0}}},{field:"yfQz",title:"运方签字",width:"calc(50% - 25px)",disabled:!0,itemClass:"child",editRender:{name:"ElInput",props:{clearable:!0},icons:[],associateField:"yfQzsj"}},{field:"yfQzsj",title:"运方签字时间",width:"calc(50% - 25px)",disabled:!0,itemClass:"borderRight child",editRender:{}}]},{title:"继保审核",width:"50px",children:[{field:"jbYj",title:"继保意见",width:"calc(100% - 50px)",disabled:!0,itemClass:"whole_row borderRight child height2",editRender:{name:"ElInput",props:{type:"textarea",clearable:!0,autosize:!this.isAutoWrap||{maxRows:1},resize:"none"}}},{field:"jbQz",title:"继保签字",width:"calc(50% - 25px)",disabled:!0,itemClass:"child",editRender:{name:"ElInput",props:{clearable:!0},icons:[],associateField:"jbQzsj"}},{field:"jbQzsj",title:"继保签字时间",width:"calc(50% - 25px)",disabled:!0,itemClass:"borderRight child",editRender:{}}]},{title:"调度审核",width:"50px",children:[{field:"ddYj",title:"调度意见",width:"calc(100% - 50px)",disabled:!0,itemClass:"whole_row borderRight child height2",editRender:{name:"ElInput",props:{type:"textarea",clearable:!0}}},{field:"ddQz",title:"调度签字",width:"calc(50% - 25px)",disabled:!0,itemClass:"child",editRender:{name:"ElInput",props:{clearable:!0},icons:[],associateField:"ddQzsj"}},{field:"ddQzsj",title:"调度签字时间",width:"calc(50% - 25px)",disabled:!0,itemClass:"borderRight child",editRender:{}}]},{title:"自动化审核",width:"50px",children:[{field:"zdhYj",title:"自动化意见",width:"calc(100% - 50px)",disabled:!0,itemClass:"whole_row borderRight child height2",editRender:{name:"ElInput",props:{type:"textarea",clearable:!0}}},{field:"zdhQz",title:"自动化签字",width:"calc(50% - 25px)",disabled:!0,itemClass:"child",editRender:{name:"ElInput",props:{clearable:!0},icons:[],associateField:"zdhQzsj"}},{field:"zdhQzsj",title:"自动化签字时间",width:"calc(50% - 25px)",disabled:!0,itemClass:"borderRight child",editRender:{}}]},{title:"自动化执行",width:"50px",children:[{field:"zdhZxYj",title:"自动化执行意见",width:"calc(100% - 50px)",disabled:!0,itemClass:"whole_row borderRight child height2",editRender:{name:"ElInput",props:{type:"textarea",clearable:!0}}},{field:"zdhZxQz",title:"自动化执行签字",width:"calc(50% - 25px)",disabled:!0,itemClass:"child",editRender:{name:"ElInput",props:{clearable:!0},icons:[],associateField:"zdhZxQzsj"}},{field:"zdhZxQzsj",title:"自动化执行时间",width:"calc(50% - 25px)",disabled:!0,itemClass:"borderRight child",editRender:{}}]},{title:"调度确认",width:"50px",itemClass:"borderBottom",children:[{field:"ddZxsm",title:"调度确认说明",width:"calc(100% - 50px)",disabled:!0,itemClass:"whole_row borderRight child height2",editRender:{name:"ElInput",props:{type:"textarea",clearable:!0,autosize:!this.isAutoWrap||{maxRows:1},resize:"none"}}},{field:"zxrQz",title:"执行人签字",width:"calc(50% - 25px)",disabled:!0,itemClass:"child borderBottom",editRender:{name:"ElInput",props:{clearable:!0},icons:[],associateField:"ddhqqzsj"}},{field:"zxrQzsj",title:"执行人签字时间",width:"calc(50% - 25px)",disabled:!0,itemClass:"borderBottom borderRight child",editRender:{}}]}]},editRules:()=>({xmmc:[{required:!0,message:"项目名称不能为空"}],gznr:[{required:!0,message:"工作内容不能为空"}],yjtysj:[{required:!0,message:"预计投运时间不能为空"}],bzr:[{required:!0,message:"编制人不能为空"}]}),gridOptions(){return{height:"auto",keepSource:!0,border:!0,round:!0,stripe:!0,headerAlign:"center",align:"center",loading:!1,rowConfig:{isCurrent:!0,isHover:!0},radioConfig:{highlight:!0},checkboxConfig:{highlight:!0},columnConfig:{resizable:!0},sortConfig:{remote:!0},filterConfig:{remote:!0},showOverflow:this.isAutoWrap,headerCellClassName:"row-class",pagerConfig:this.pagerConfig,proxyConfig:{seq:!0,showResponseMsg:!1,showActionMsg:!1,sort:!0,filter:!0,ajax:{query:({page:e,sorts:t,filters:i})=>this.loadTableApi(e,t,i),queryAll:({sorts:e,filters:t})=>this.loadTableApi({pageSize:1e5,currentPage:1},e,t),delete:({body:e})=>this.doDeleteApi(e.removeRecords)}},exportConfig:{filename:"设备命名变更表格",sheetName:"sheet1",type:"xlsx",mode:"all",modes:["current","selected","all"],message:!1,columns:this.tableHeaderList.filter(e=>"checkbox"!==e.type),exportMethod:this.exportMethod,afterExportMethod:this.afterExportMethod},menuConfig:{body:{options:[[{code:"collect",name:"标记重点"}]]}},columns:this.tableHeaderList,cellClassName:({row:e,column:t})=>"jszt"===t.field&&"未接收"===e.jszt?"row-red":null}},defaultDefaultButtons:()=>[{type:"gradientGreen",name:"查询"},{type:"gradientGreen",name:"自动换行"}]},mounted(){this.getButtons()},methods:{getButtons(){let e=this.buttons;this.defaultLeftButtons=e.outerBtns.filter(e=>"left"==e.position),this.defaultRightButtons=e.outerBtns.filter(e=>"right"==e.position),this.innerButtons=e.insideBtns},reloadTableData(){this.$refs.xTable.commitProxy("query")},loadTableData(){this.$refs.xTable.commitProxy("reload")},loadTableApi(e,t,i){let l=this.getRealParams(this.searchParams,e,t,i);return new Promise(t=>{v.loadTableDataService({...l,...this.node}).then(i=>{1e5==e.pageSize?(this.total=i.total,t(i.data)):(this.total=i.total,t({result:i.data,page:{total:i.total}}))})})},toggleWrap(){this.isAutoWrap?this.isAutoWrap=!1:this.isAutoWrap="tooltip"},doDelete(){const e=this.getCheckboxRecords();e&&e.length>0&&this.$confirm("确认删除勾选的".concat(e.length,"条数据吗？"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await this.$refs.xTable.commitProxy("delete"),this.loadTableData(),this.$emit("loadTree")})},doDeleteApi(e){return new Promise((t,i)=>{let l=e.map(e=>e.id).join(",");v.doDelTableDataService(l).then(()=>{this.$message.success("删除成功"),t()}).catch(()=>{i()})})},resetParams(){this.searchParams.keyword="",this.searchParams.sortOrder="",this.searchParams.sortColumn="",this.time=["",""],this.$nextTick(function(){this.loadTableData()})},async doAdd(){let e=await s.getAddIdService().then(e=>e.data),t="xmmc,gznr,yjtysj,bzr,fileList".split(","),i=JSON.parse(JSON.stringify(this.tableDetailHeaderList));for(let d=0;d<t.length;d++)for(let e=0;e<i.length;e++){let l=i[e].children;for(let e=0;e<l.length;e++)l[e].field!=t[d]&&l[e].field+"Btn"!=t[d]||(t[d].includes("Btn")?l[e].editRender.icons=["edit"]:l[e].disabled=!1)}i=this.node.name.includes("编制")?i.filter(e=>e.title.includes("编制")):i;let l=i.length-1,a=i[l].children.length-1;i[l].itemClass="borderBottom",i[l].children[a].itemClass+=" borderBottom",i[l].children[a].width.includes("50%")&&(i[l].children[a-1].itemClass+=" borderBottom"),this.$vxeModal.show(R,{tableHeaderList:i,validateRules:this.editRules,row:{id:e,fileList:[]},labelWidth:"120px"},{width:1200,title:"新增",height:window.innerHeight-200},{doSubmit:e=>{e.isAdd=1,v.saveTableDataService(e).then(()=>{this.$message.success("保存成功"),this.$vxeModal.closeAll(),this.loadTableData(),this.$emit("loadTree")})}})},doExport(e){s.exportFileService("/sbqd/export",{...this.searchParams,nodeId:this.node.id},e,this.pagerParam)},cellDblclick(e){let{row:t}=e;this.openDetail(t)},openDetail(e){v.getDetailDataService(e.id,this.node.role).then(e=>{let t=e.data.enabledField.replaceAll("Qz","QzBtn").replaceAll("fj","fileList").split(","),i=JSON.parse(JSON.stringify(this.tableDetailHeaderList));for(let d=0;d<t.length;d++)for(let e=0;e<i.length;e++){let l=i[e].children;for(let e=0;e<l.length;e++)l[e].field!=t[d]&&l[e].field+"Btn"!=t[d]||(t[d].includes("Btn")?l[e].editRender.icons=["edit"]:l[e].disabled=!1)}i=this.node.name.includes("编制")?i.filter(e=>e.title.includes("编制")):i;let l=i.length-1,a=i[l].children.length-1;i[l].itemClass="borderBottom",i[l].children[a].itemClass+=" borderBottom",i[l].children[a].width.includes("50%")&&(i[l].children[a-1].itemClass+=" borderBottom"),this.$vxeModal.show(R,{tableHeaderList:i,validateRules:this.editRules,row:e.data,labelWidth:"120px",footerButtonList:this.innerButtons},{width:1200,title:"详情",height:window.innerHeight-20},{close:()=>{},doSubmit:e=>{e.isAdd=0,v.saveTableDataService(e).then(()=>{this.$message.success("保存成功"),this.$vxeModal.closeAll(),this.loadTableData(),this.$emit("loadTree")})},doOperate:async e=>{"查看流程图"==e.btn.name?this.doViewFlow():"查看日志"==e.btn.name?this.doViewDialog([e.data]):(e.data.isAdd=0,v.saveTableDataService(e.data).then(()=>{this.doOperation(e.btn,[e.data])}))}})})},doViewDialog(e=[]){e&&0!=e.length||(e=this.getCheckboxRecords()),e&&e.length>0&&v.loadDialogDataService(e[0].id).then(e=>{this.$vxeModal.show(z,{tableHeaderList:[{type:"seq",width:60},{field:"action",title:"操作",width:"80"},{field:"operateTime",title:"操作时间",width:"150",sortable:!0,formatter:["formatterTime"]},{field:"operator",title:"操作人",width:"90"},{field:"node",title:"开始节点",width:"100"},{field:"nextNode",title:"结束节点",width:"100"},{field:"opinion",title:"意见",align:"left",headerAlign:"center"},{field:"isUpdate",title:"是否修改",width:"80"}],tableData:e.data},{width:900,title:"日志",height:600},{})})},doOperation(e,i=[]){i&&0!=i.length||(i=this.getCheckboxRecord()),i&&i.length>0&&this.$vxeModal.show(t,{isRequire:!1},{width:360,height:220,title:"输入".concat(e.name,"意见"),resize:!1},{returnData:t=>{let l={tzbgdId:i[0].id,currentNode:this.node.role,action:e.action,opinion:t,isUpdate:"0"};v.doOperateService(l).then(()=>{this.$message.success("".concat(e.name,"成功")),this.$vxeModal.closeAll(),this.loadTableData(),this.$emit("loadTree")})}})}}},[["render",function(e,t,i,l,a,d){const s=o("el-button"),C=o("vxe-grid");return r(),n("div",j,[h("header",null,[h("section",null,[h("div",B,[(r(!0),n(c,null,p(d.defaultDefaultButtons,(t,i)=>(r(),m(s,{type:t.type,plain:t.plain,key:i+"defaultDefaultButtons",onClick:i=>e.btnClick(t)},{default:b(()=>[u(f(t.name),1)]),_:2},1032,["type","plain","onClick"]))),128)),(r(!0),n(c,null,p(a.defaultLeftButtons,t=>(r(),m(s,{type:t.type,onClick:i=>e.btnClick(t)},{default:b(()=>[u(f(t.name),1)]),_:2},1032,["type","onClick"]))),256))])]),h("section",null,[h("div",T,[(r(!0),n(c,null,p(a.defaultRightButtons,t=>(r(),m(s,{type:t.type,onClick:i=>e.btnClick(t)},{default:b(()=>[u(f(t.name),1)]),_:2},1032,["type","onClick"]))),256))])])]),h("article",null,[g(C,w(d.gridOptions,{ref:"xTable"},x({cellDblclick:d.cellDblclick}),{onMenuClick:t[0]||(t[0]=t=>e.menuClickEvent(t,"设备启动"))}),null,16)])])}],["__scopeId","data-v-43ee1b8c"]])},data:()=>({treeData:[],node:{},buttons:{outerBtns:[],insideBtns:[]}}),created(){this.loadLeftData()},methods:{customNodeClass({id:e}){return this.node.id==e?"active_tree":""},loadLeftData(){v.loadTreeDataService({}).then(e=>{this.treeData=e.data,this.node.id||this.handleNodeClick(this.treeData[0].children[0])})},handleNodeClick(e){if(!e.children||0===e.children.length){this.buttons={outerBtns:e.outerBtns,insideBtns:e.insideBtns};let t=JSON.parse(JSON.stringify(e));delete t.outerBtns,delete t.insideBtns,delete t.children,this.node=t}}}},[["render",function(e,t,i,l,a,d){const s=o("el-tree"),n=o("el-aside"),c=o("mmbg_table"),p=o("el-main"),w=o("el-container");return r(),m(w,{id:"mmbg"},{default:b(()=>[g(n,null,{default:b(()=>[t[0]||(t[0]=h("p",null,[h("span",{class:"mmbg_left"}),u("设备命名变更")],-1)),g(s,{data:a.treeData,onNodeClick:d.handleNodeClick,"default-expand-all":!0,props:{class:d.customNodeClass}},{default:b(({node:e,data:t})=>[h("div",null,[h("i",{class:C([t.icon,"tree_icon"])},null,2),u(" "+f(t.name),1)])]),_:1},8,["data","onNodeClick","props"])]),_:1}),g(p,null,{default:b(()=>[a.node.id?(r(),m(c,{key:a.node.id,node:a.node,buttons:a.buttons,onLoadTree:d.loadLeftData},null,8,["node","buttons","onLoadTree"])):y("",!0)]),_:1})]),_:1})}],["__scopeId","data-v-f83630a8"]]);export{L as default};
