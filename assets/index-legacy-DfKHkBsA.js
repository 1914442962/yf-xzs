!function(){function e(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,l)}return a}function t(t){for(var l=1;l<arguments.length;l++){var i=null!=arguments[l]?arguments[l]:{};l%2?e(Object(i),!0).forEach(function(e){a(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):e(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}function a(e,t,a){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var l=a.call(e,t||"default");if("object"!=typeof l)return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}System.register(["./table_mixin-legacy-a2qRsxfo.js","./UploadHttpComponent-legacy-C2pizi70.js","./index-legacy-BVk_Mtvn.js","./xwb-api-legacy-twgLZRGh.js","./view_simple_table-legacy-C6TpHIvK.js","./dynamic_form-legacy-B1IegRz0.js","./validateRules-legacy-Co865pER.js","./polyfill-legacy-aWkUxw0k.js","./view_file-legacy-C-pdxPUN.js","./zcq-sb-dky-legacy-Kd_Ps_V0.js"],function(e,a){"use strict";var l,i,r,s,o,d,n,c,p,u,m,h,b,f,g,y,w,x,v,z,k,O,j,C;return{setters:[e=>{l=e.t},e=>{i=e.U},e=>{r=e._,s=e.r,o=e.o,d=e.c,n=e.F,c=e.q,p=e.b,u=e.t,m=e.d,h=e.w,b=e.h,f=e.M,g=e.e,y=e.i,w=e.v,x=e.y,v=e.D,z=e.N},e=>{k=e.x},e=>{O=e.v},e=>{j=e.d},e=>{C=e.v},null,null,null],execute:function(){const a={class:"DataTextComponent"},P={class:"span_label"};const S={class:"page_content"},D={class:"header-item"},R={class:"header-item"},q={class:"header-item"},A={class:"header-item"},T={class:"header-item"},_={class:"header-item"},E={class:"header-item"},$={class:"header-item"};e("default",r({name:"xwb",components:{DataTextComponent:r({name:"DataTextComponent",props:{textArr:Array}},[["render",function(e,t,l,i,r,f){const g=s("el-text");return o(),d("div",a,[(o(!0),d(n,null,c(l.textArr,e=>(o(),d("span",null,[p("span",P,u(e.name)+"：",1),m(g,{tag:"b",type:"primary"},{default:h(()=>[b(u(e.value),1)]),_:2},1024)]))),256))])}],["__scopeId","data-v-d0b4796a"]]),QuestionFilled:f,UploadHttpComponent:i},mixins:[l],data:()=>({time:["",""],total:0,searchParams:{bdzmcList:[],sfcyqs:!1,year:x().format("YYYY"),sortOrder:"",sortColumn:"",bz:""},textArr:[],tableData:[],isAutoWrap:!1,bdzOptions:[],bdzRealOptions:[],llkgOptions:[],editRow:{}}),watch:{"searchParams.sfcyqs":{handler(){this.loadTableData()},immediate:!1}},computed:{tableHeaderList(){return[{type:"checkbox",width:50,fixed:"left"},{type:"seq",width:60,fixed:"left"},{field:"bdzmc",title:"变电站名称",width:120,editRender:{name:"ElSelect",options:this.bdzRealOptions,props:{filterable:!0}}},{field:"bdzdydj",title:"变电站电压等级（kV）",width:120,sortable:!0,editRender:{name:"ElSelect",options:this.$store.state.staticOptionsObj.bdzdydj,props:{clearable:!0}}},{field:"llkg",title:"拉路开关",minWidth:200,filters:[{data:""}],filterRender:{name:"VxeInput"},slots:{edit:"llkg"},editRender:{}},{field:"kgdydj",title:"开关电压等级（kV）",width:120,sortable:!0,editRender:{name:"ElSelect",options:this.$store.state.staticOptionsObj.bdzdydj,props:{clearable:!0}}},{field:"fh",title:"负荷（万千瓦）",width:120,sortable:!0,headerAlign:"center",align:"right",formatter:["formatterNumber",2],titleSuffix:{content:"将当前负荷值与去年同期最大负荷值进行比较，取二者中的较大值作为更新后的基准负荷值"},editRender:{name:"ElInput",props:{type:"number",min:0,step:1}}},{field:"ygFhz",title:"有功负荷值（万千瓦）",width:130,sortable:!0,headerAlign:"center",align:"right",formatter:["formatterNumber",2],titleSuffix:{content:"去年D5000最大采样值"}},{field:"ssdwfq",title:"所属电网分区",width:140,editRender:{name:"ElSelect",options:this.$store.state.selectOptionsObj.fq,props:{clearable:!0}},filters:this.$store.state.selectOptionsObj.fq},{field:"zyfh",title:"主要负荷【用户名称】",minWidth:180,editRender:{name:"ElInput",props:{clearable:!0}},filters:[{data:""}],filterRender:{name:"VxeInput"}},{field:"ssxzqy",title:"所属行政区域",width:120,editRender:{name:"ElSelect",options:this.$store.state.selectOptionsObj.xzqy,props:{clearable:!0}},filters:this.$store.state.selectOptionsObj.xzqy},{field:"sz220bdz",title:"所在220千伏变电站",width:120,editRender:{name:"ElInput",props:{clearable:!0}}},{field:"fhxz",title:"负荷性质",width:130,editRender:{name:"ElInput",props:{clearable:!0}}},{field:"fd",title:"分档",width:110,editRender:{name:"ElInput",props:{clearable:!0}}},{field:"bz",title:"备注",width:110,editRender:{name:"ElSelect",options:this.$store.state.staticOptionsObj.bz,props:{clearable:!0}}},{title:"日志",width:100,fixed:"right",slots:{default:"action"}}]},editRules:()=>({bdzmc:[{required:!0,message:"变电站名称不能为空"}],bdzdydj:[{required:!0,message:"变电站电压等级不能为空"}],llkg:[{required:!0,message:"拉路开关不能为空"}],kgdydj:[{required:!0,message:"开关电压等级不能为空"}],fh:[{required:!0,message:"负荷不能为空"}],ssdwfq:[{required:!0,message:"所属电网分区不能为空"}],zyfh:[{required:!0,message:"主要负荷不能为空"}],ssxzqy:[{required:!0,message:"所属行政区域不能为空"}]}),gridOptions(){return{height:"auto",border:!0,round:!0,stripe:!0,headerAlign:"center",align:"center",loading:!1,keepSource:!0,rowConfig:{isCurrent:!0,isHover:!0},radioConfig:{highlight:!0},checkboxConfig:{highlight:!0},columnConfig:{resizable:!0},sortConfig:{remote:!0},filterConfig:{remote:!0},showOverflow:this.isAutoWrap,headerCellClassName:"row-class",pagerConfig:t(t({},this.pagerConfig),{},{pageSize:100,pageSizes:[20,50,100,200,300,500]}),editConfig:{trigger:"click",mode:"cell",showStatus:!0,showIcon:!0,beforeEditMethod:this.beforeEditMethod},proxyConfig:{seq:!0,showResponseMsg:!1,showActionMsg:!1,sort:!0,filter:!0,ajax:{query:({page:e,sorts:t,filters:a})=>this.loadTableApi(e,t,a),queryAll:({sorts:e,filters:t})=>this.loadTableApi({pageSize:1e5,currentPage:1},e,t),querySuccess:()=>{this.loadData()},delete:({body:e})=>this.doDeleteApi(e.removeRecords),save:({body:e})=>this.doSaveApi(e)}},exportConfig:{filename:"序位表",sheetName:"sheet1",type:"xlsx",mode:"all",modes:["current","selected","all"],message:!1,columns:this.tableHeaderList.filter(e=>"checkbox"!==e.type),exportMethod:this.exportMethod,afterExportMethod:this.afterExportMethod},menuConfig:{body:{options:[[{code:"collect",name:"标记重点"}]]}},cellClassName:({row:e})=>e.ygFhz||0===e.ygFhz?"增补"===e.bz?"row-blue":"剔除"===e.bz?"row-orangered":null:"row-red",editRules:this.editRules,columns:this.tableHeaderList,spanMethod({row:e,rowIndex:t,column:a,visibleData:l}){const i=e.bdzmc;if(i&&["bdzmc","bdzdydj"].includes(a.field)){const e=l[t-1];let a=l[t+1];if(e&&e.bdzmc===i)return{rowspan:0,colspan:0};{let e=1;for(;a&&a.bdzmc===i;)a=l[++e+t];if(e>1)return{rowspan:e,colspan:1}}}}}},defaultLeftButtons:()=>[{type:"gradientGreen",name:"查询"},{type:"gradientDarkGreen",name:"重置"}],defaultRightButtons:()=>[{type:"gradientBlue",name:"下载导入模版"},{type:"gradientBlue",name:"新增"},{type:"gradientBlue",name:"生成"},{type:"gradientBlue",name:"保存"},{type:"gradientRed",name:"删除"}]},created(){this.queryBdz()},mounted(){},methods:{queryBdz(){k.getD5000BdzService({bdzmc:""}).then(e=>{this.bdzOptions=e.data,this.bdzRealOptions=this.bdzOptions.map(e=>({label:e.bdzmc,value:e.bdzmc}))})},loadData(){k.loadDataService(this.searchParams.year).then(e=>{this.textArr=e.data})},reloadTableData(){this.$refs.xTable.commitProxy("query")},loadTableData(){this.$refs.xTable.commitProxy("reload")},loadTableApi(e,t,a){let l=this.getRealParams(this.searchParams,e,t,a);return new Promise(t=>{k.loadTableDataService(l).then(a=>{1e5==e.pageSize?(this.total=a.total,t(a.data)):(this.total=a.total,t({result:a.data,page:{total:a.total}}))})})},toggleWrap(){this.isAutoWrap?this.isAutoWrap=!1:this.isAutoWrap="tooltip"},doAdd(){this.textArr.length>2&&this.textArr[2].value>this.textArr[0].value&&z.alert(`${this.textArr[2].name}大于${this.textArr[0].name}`);this.$refs.xTable.insertAt({}).then(e=>{this.$refs.xTable.setEditRow(e)})},doSave(){const e=this.getUpdateRecords();e&&e.length>0&&this.$refs.xTable.commitProxy("save")},doSaveApi(e){return new Promise((t,a)=>{let{insertRecords:l,updateRecords:i}=e,r=[...l,...i];k.saveTableDataService({data:r}).then(e=>{this.$message.success(e.data),t()}).catch(()=>{a()})})},doDelete(){const e=this.getCheckboxRecords();e&&e.length>0&&this.$confirm(`确认删除勾选的${e.length}条数据吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.$refs.xTable.commitProxy("delete")})},doDeleteApi(e){return new Promise((t,a)=>{let l=e.map(e=>e.id).join(",");k.doDelTableDataService({ids:l}).then(e=>{this.$message.success(e.data),t()}).catch(()=>{a()})})},doSync(){k.doSyncDataService({}).then(e=>{this.$message.success(e.data),this.loadTableData()})},downloadModule(){v.exportFileService("/xwb/download-xwb-tpl",{})},doExport(e){v.exportFileService("/xwb/exportXwb",this.searchParams,e,this.pagerParam)},resetParams(){this.searchParams={bdzmcList:[],sfcyqs:!1,year:x().format("YYYY"),sortOrder:"",sortColumn:"",bz:""},this.$nextTick(function(){this.loadTableData()})},beforeEditMethod:({row:e,column:t})=>!0,editClosed({row:e,column:t}){if("bdzmc"===t.field){let t=this.bdzOptions.filter(t=>t.bdzmc===e.bdzmc)[0];e.bdzdydj=t.bdzdydj,e.llkg="",e.kgdydj=""}if("llkg"===t.field){let t=this.llkgOptions.filter(t=>t.llkg===e.llkg)[0];e.kgdydj=t.kgdydj,e.ycb=t.ycb,e.ycy=t.ycy,e.fh=t.fh,e.ygFhz=t.ygFhz}},remoteMethod(e,t){t.bdzmc?k.getLlkgInfoService({bdzmc:t.bdzmc,llkg:e,saveYear:this.searchParams.year}).then(e=>{this.llkgOptions=e.data,t.llkgOptions=e.data.map(e=>({label:e.llkg,value:e.llkg}))}):this.$message.warning("变电站不存在，请重新选择变电站")},doSc(){this.$vxeModal.show(j,{tableHeaderList:[{field:"year",title:"参考年份",width:150,editRender:{name:"ElDatePicker",props:{type:"year",labelFormat:"YYYY",valueFormat:"YYYY"}}},{field:"inputNumber",title:"总负荷值（万千瓦）",minWidth:120,headerAlign:"center",align:"right",editRender:{name:"ElInput",props:{type:"number",min:0,step:1}}}],validateRules:{inputNumber:[{required:!0,message:"总负荷值（万千瓦）不能为空"},C.positive_number.rule],year:[{required:!0,message:"参考年份不能为空"}]},row:{year:"2025",inputNumber:0},footerButtonList:[{type:"gradientBlue",name:"保存"}]},{width:400,title:"选择参考年份和输入总负荷值（万千瓦）",height:270},{doSubmit:e=>{console.log(e),k.doScDataService({fhTotal:e.inputNumber,saveYear:this.searchParams.year,copyYear:e.year}).then(e=>{this.$message.success(e.data),this.loadTableData()})}})},doViewLog(e){k.loadViewDialogService({id:e.id}).then(e=>{this.$vxeModal.show(O,{tableHeaderList:[{type:"seq",width:60},{field:"czr",title:"操作人",width:"100"},{field:"time",title:"操作时间",width:"150"},{field:"nr",title:"内容"}],tableData:e.data},{width:800,title:"日志",height:600},{})})}}},[["render",function(e,t,a,l,i,r){const f=s("el-date-picker"),x=s("el-option"),v=s("el-select"),z=s("QuestionFilled"),k=s("el-icon"),O=s("el-tooltip"),j=s("el-switch"),C=s("el-button"),P=s("arrow-down"),Y=s("el-dropdown-item"),V=s("el-dropdown-menu"),L=s("el-dropdown"),B=s("upload-http-component"),M=s("vxe-button"),I=s("DataTextComponent"),F=s("vxe-grid");return o(),d("div",S,[p("header",null,[p("section",null,[p("div",D,[t[7]||(t[7]=b(" 年： ",-1)),m(f,{style:{width:"120px"},modelValue:i.searchParams.year,"onUpdate:modelValue":t[0]||(t[0]=e=>i.searchParams.year=e),type:"year",format:"YYYY","value-format":"YYYY"},null,8,["modelValue"])]),p("div",R,[t[8]||(t[8]=b(" 变电站名称： ",-1)),m(v,{modelValue:i.searchParams.bdzmcList,"onUpdate:modelValue":t[1]||(t[1]=e=>i.searchParams.bdzmcList=e),placeholder:"请选择",clearable:"",filterable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":"","tag-type":"",style:{width:"180px"}},{default:h(()=>[(o(!0),d(n,null,c(this.$store.state.selectOptionsObj.bdz,e=>(o(),g(x,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),p("div",q,[m(O,{effect:"dark",content:"筛选没有有功负荷值的开关"},{default:h(()=>[m(k,{size:16},{default:h(()=>[m(z)]),_:1})]),_:1}),t[9]||(t[9]=b(" 是否采样缺失： ",-1)),m(j,{modelValue:i.searchParams.sfcyqs,"onUpdate:modelValue":t[2]||(t[2]=e=>i.searchParams.sfcyqs=e),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])]),p("div",A,[t[10]||(t[10]=b(" 备注： ",-1)),m(v,{style:{width:"130px"},modelValue:i.searchParams.bz,"onUpdate:modelValue":t[3]||(t[3]=e=>i.searchParams.bz=e),placeholder:"请选择",clearable:""},{default:h(()=>[(o(!0),d(n,null,c(this.$store.state.staticOptionsObj.bz,e=>(o(),g(x,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),p("div",T,[(o(!0),d(n,null,c(r.defaultLeftButtons,(t,a)=>(o(),g(C,{type:t.type,plain:t.plain,key:a+"defaultLeftButtons",onClick:a=>e.btnClick(t)},{default:h(()=>[b(u(t.name),1)]),_:2},1032,["type","plain","onClick"]))),128))]),p("div",_,[m(L,null,{dropdown:h(()=>[m(V,null,{default:h(()=>[m(Y,{onClick:r.doExport},{default:h(()=>[...t[12]||(t[12]=[b("导出当前页",-1)])]),_:1},8,["onClick"]),m(Y,{onClick:t[4]||(t[4]=e=>r.doExport(!0))},{default:h(()=>[...t[13]||(t[13]=[b("导出全部",-1)])]),_:1})]),_:1})]),default:h(()=>[m(C,{type:"gradientGreen"},{default:h(()=>[t[11]||(t[11]=b(" 导出",-1)),m(k,{class:"el-icon--right"},{default:h(()=>[m(P)]),_:1})]),_:1})]),_:1})])]),p("section",null,[p("div",E,[m(B,{"prop-upload-url":"/xwb/import-xwb",onLoadTableData:t[5]||(t[5]=e=>r.loadTableData(!0))})]),p("div",$,[(o(!0),d(n,null,c(r.defaultRightButtons,(t,a)=>(o(),g(C,{type:t.type,plain:t.plain,key:a+"defaultRightButtons",onClick:a=>e.btnClick(t)},{default:h(()=>[b(u(t.name),1)]),_:2},1032,["type","plain","onClick"]))),128))])])]),p("article",null,[m(F,w(r.gridOptions,{ref:"xTable",onMenuClick:t[6]||(t[6]=t=>e.menuClickEvent(t,"序位表")),onEditClosed:r.editClosed}),{action:h(({row:e})=>[e.id?(o(),g(M,{key:0,mode:"text",status:"primary",onClick:t=>r.doViewLog(e)},{default:h(()=>[...t[14]||(t[14]=[b("日志 ",-1)])]),_:1},8,["onClick"])):y("",!0)]),llkg:h(({row:e})=>[m(v,{modelValue:e.llkg,"onUpdate:modelValue":t=>e.llkg=t,filterable:"",remote:"","remote-method":t=>this.remoteMethod(t,e)},{default:h(()=>[(o(!0),d(n,null,c(e.llkgOptions,e=>(o(),g(x,{value:e.value,label:e.label},null,8,["value","label"]))),256))]),_:2},1032,["modelValue","onUpdate:modelValue","remote-method"])]),pagerLeft:h(()=>[m(I,{"text-arr":i.textArr},null,8,["text-arr"])]),_:1},16,["onEditClosed"])])])}],["__scopeId","data-v-4f7b31b5"]]))}}})}();
