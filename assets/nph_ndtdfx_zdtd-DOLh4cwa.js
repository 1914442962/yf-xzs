import{t as e}from"./table_mixin-Bm7KLuSQ.js";import{U as t}from"./UploadHttpComponent-nVBlbYdp.js";import{d as a}from"./dynamic_form-NBAtoJIc.js";import{v as i}from"./validateRules-33HAVMqP.js";import{A as s,B as l,D as d,b as o,r,o as n,c,d as h,i as m,e as p,F as u,v as f,f as g,w as b,t as x,x as w,y,z as j,E as v}from"./index-0nalUVid.js";import"./view_file-nia3YLJy.js";import"./zcq-sb-dky-DEUWHwSD.js";import"./polyfill-lGe4XDVY.js";let D=l.base;const k={loadTableDataService:e=>s({url:"".concat(D,"/jxjh/ndjxZdtd"),method:"post",data:e,showLoading:!0}),saveTableDataService:e=>s({url:"".concat(D,"/jxjh/saveNdjxZdtd"),method:"post",data:e,showLoading:!0}),doDelTableDataService:e=>s({url:"".concat(D,"/jxjh/deleteNdjxZdtd"),method:"post",data:e,showLoading:!0}),importDataService:e=>s({url:"".concat(D,"/jxjh/initNdjxZdtd"),method:"post",data:e,showLoading:!0}),createFxyjDataService:e=>s({url:"".concat(D,"/jxjh/sgNdFxyj"),method:"post",data:e,showLoading:!0}),exportTableDataFileService:(e,t)=>s({url:"".concat(D,"/common/deleteById"),method:"post",data:e,responseType:"blob",showLoading:!0}).then(e=>{d(e,t,"xlsx")}),downloadModuleService:e=>s({url:"".concat(D,"/common/downLoadModule"),method:"post",data:e,responseType:"blob",showLoading:!0}).then(e=>{d(e,"导入模板","xlsx")})},R={class:"page_content"},C={class:"header-item"},Y={class:"header-item"},T={class:"header-item"},S={class:"header-item"};const A=o({name:"nph_ndtdfx_zdtd",mixins:[e],components:{UploadHttpComponent:t},data:()=>({time:["",""],total:0,searchParams:{year:"",sortOrder:"",sortColumn:""},tableData:[],isAutoWrap:!1}),watch:{},computed:{tableHeaderList(){return[{type:"checkbox",width:50},{type:"seq",width:60},{field:"sbdydj",title:"电压等级",width:100,sortable:!0,editRender:{name:"ElSelect",options:[{label:"110",value:"110"},{label:"35",value:"35"},{label:"20",value:"20"},{label:"10",value:"10"}],props:{clearable:!0}}},{field:"ssdq",title:"所属地区",width:100,editRender:{}},{field:"tdcs",title:"停电场所",width:100,editRender:{name:"$modal",props:{type:"tdcs"}}},{field:"tdsb",title:"停电设备",minWidth:200,editRender:{name:"$modal",props:{type:"tdsb"}}},{field:"gznr",title:"工作内容",minWidth:200,headerAlign:"center",align:"left",editRender:{name:"ElInput",props:{type:"textarea",clearable:!0,autosize:!this.isAutoWrap||{maxRows:1},resize:"none"}}},{field:"tdkssj",title:"停电开始时间",width:125,sortable:!0,editRender:{name:"ElDatePicker",props:{type:"date",labelFormat:"YYYY-MM-DD",valueFormat:"YYYY-MM-DD"}}},{field:"tdjssj",title:"停电结束时间",width:125,sortable:!0,editRender:{name:"ElDatePicker",props:{type:"date",labelFormat:"YYYY-MM-DD",valueFormat:"YYYY-MM-DD"}}},{field:"ts",title:"停电天数",width:100,sortable:!0,headerAlign:"center",align:"right",formatter:["formatterNumber",0],editRender:{}},{field:"isGlYjh",title:"是否关联月度计划",width:80,editRender:{}},{field:"xmmc",title:"项目名称",width:120,editRender:{}},{field:"xmlx",title:"项目类型",width:100,editRender:{}},{field:"sqr",title:"计划申请人",width:100,editRender:{}},{field:"jhsqdw",title:"计划申请单位",width:120,editRender:{}},{field:"jhsbbm",title:"计划申请部门",width:120,editRender:{}},{field:"ssfq",title:"所属分区",width:100,editRender:{}},{field:"jhbh",title:"计划编号",width:140,editRender:{}},{field:"flowState",title:"流程状态",width:100,editRender:{}}]},editRules:()=>({sbdydj:[{required:!0,message:"电压等级不能为空"}],tdcs:[{required:!0,message:"停电场所不能为空"}],tdsb:[{required:!0,message:"停电设备不能为空"}],gznr:[{required:!0,message:"工作内容不能为空"}],tdkssj:[{required:!0,message:"日期不能为空"},i.date.rule],tdjssj:[{required:!0,message:"日期不能为空"},i.date.rule]}),gridOptions(){return{height:"auto",border:!0,round:!0,stripe:!0,headerAlign:"center",align:"center",loading:!1,rowConfig:{isCurrent:!0,isHover:!0},radioConfig:{highlight:!0},checkboxConfig:{highlight:!0},columnConfig:{resizable:!0},sortConfig:{remote:!0},filterConfig:{remote:!0},showOverflow:this.isAutoWrap,headerCellClassName:"row-class",pagerConfig:this.pagerConfig,proxyConfig:{seq:!0,showResponseMsg:!1,showActionMsg:!1,sort:!0,filter:!0,ajax:{query:({page:e,sorts:t,filters:a})=>this.loadTableApi(e,t,a),queryAll:({sorts:e,filters:t})=>this.loadTableApi({pageSize:1e5,currentPage:1},e,t),delete:({body:e})=>this.doDeleteApi(e.removeRecords)}},exportConfig:{filename:"年度重大停电表",sheetName:"sheet1",type:"xlsx",mode:"all",modes:["current","selected","all"],message:!1,columns:this.tableHeaderList.filter(e=>"checkbox"!==e.type),exportMethod:this.exportMethod,afterExportMethod:this.afterExportMethod},menuConfig:{body:{options:[[{code:"collect",name:"标记重点"}]]}},editRules:this.editRules,columns:this.tableHeaderList}},defaultLeftButtons:()=>[{type:"gradientGreen",name:"查询"},{type:"gradientGreen",name:"自动换行"}],defaultRightButtons:()=>[{type:"gradientRed",name:"删除"}]},mounted(){this.searchParams.year=j().format("YYYY")},methods:{reloadTableData(){this.$refs.xTable.commitProxy("query")},loadTableData(){this.$refs.xTable.commitProxy("reload")},loadTableApi(e,t,a){let i=this.getRealParams(this.searchParams,e,t,a);return new Promise(t=>{k.loadTableDataService(i).then(a=>{1e5==e.pageSize?(this.total=a.total,t(a.data)):(this.total=a.total,t({result:a.data,page:{total:a.total}}))})})},toggleWrap(){this.isAutoWrap?this.isAutoWrap=!1:this.isAutoWrap="tooltip"},doDelete(){const e=this.getCheckboxRecords();e&&e.length>0&&this.$confirm("确认删除勾选的".concat(e.length,"条数据吗？"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.$refs.xTable.commitProxy("delete")})},doDeleteApi(e){return new Promise((t,a)=>{let i=e.map(e=>e.id).join(",");k.doDelTableDataService({ids:i}).then(e=>{this.$message.success(e.data),t()}).catch(()=>{a()})})},importData(){k.importDataService({}).then(e=>{this.$message.success(e.data),this.loadTableData()})},createData(){const e=this.getCheckboxRecords();e&&e.length>0&&k.createFxyjDataService({data:e}).then(e=>{this.$message.success(e.data)})},doExport(e){v.exportFileService("/jxjh/exportNdjxZdtd",this.searchParams,e,this.pagerParam)},cellDblclick(e){let{row:t}=e;this.openDetail(t)},resetParams(){this.time=["",""],this.$nextTick(function(){this.loadTableData()})},openDetail(e){this.$vxeModal.show(a,{tableHeaderList:this.tableHeaderList,validateRules:this.editRules,row:e},{width:800,title:"详情",height:window.innerHeight-100},{close:()=>{},doSubmit:e=>{e.tdkssj&&e.tdjssj&&j(e.tdkssj).isAfter(e.tdjssj)?this.$message.error("停电开始时间不能在停电结束时间之后"):(e.ts=j(e.tdjssj).diff(e.tdkssj,"day")+1,e.csDataIn=e.tdcsParam,e.sbDataIn=e.tdsbList,this.doRealSave([e]))}})},doSave(){this.$refs.xTable.commitProxy("save")},doRealSave(e){k.saveTableDataService({data:e}).then(e=>{this.$message.success(e.data),this.$vxeModal.closeAll(),this.loadTableData()})}}},[["render",function(e,t,a,i,s,l){const d=r("el-date-picker"),o=r("el-button"),j=r("arrow-down"),v=r("el-icon"),D=r("el-dropdown-item"),k=r("el-dropdown-menu"),A=r("el-dropdown"),M=r("vxe-grid");return n(),c("div",R,[h("header",null,[h("section",null,[h("div",C,[t[3]||(t[3]=m(" 年： ",-1)),p(d,{modelValue:s.searchParams.year,"onUpdate:modelValue":t[0]||(t[0]=e=>s.searchParams.year=e),type:"year",format:"YYYY","value-format":"YYYY"},null,8,["modelValue"])]),h("div",Y,[(n(!0),c(u,null,f(l.defaultLeftButtons,(t,a)=>(n(),g(o,{type:t.type,plain:t.plain,key:a+"defaultLeftButtons",onClick:a=>e.btnClick(t)},{default:b(()=>[m(x(t.name),1)]),_:2},1032,["type","plain","onClick"]))),128))]),h("div",T,[p(A,null,{dropdown:b(()=>[p(k,null,{default:b(()=>[p(D,{onClick:l.doExport},{default:b(()=>[...t[5]||(t[5]=[m("导出当前页",-1)])]),_:1},8,["onClick"]),p(D,{onClick:t[1]||(t[1]=e=>l.doExport(!0))},{default:b(()=>[...t[6]||(t[6]=[m("导出全部",-1)])]),_:1})]),_:1})]),default:b(()=>[p(o,{type:"gradientGreen"},{default:b(()=>[t[4]||(t[4]=m(" 导出",-1)),p(v,{class:"el-icon--right"},{default:b(()=>[p(j)]),_:1})]),_:1})]),_:1})])]),h("section",null,[h("div",S,[p(o,{type:"gradientBlue",onClick:l.importData},{default:b(()=>[...t[7]||(t[7]=[m("从年计划抽取",-1)])]),_:1},8,["onClick"]),(n(!0),c(u,null,f(l.defaultRightButtons,(t,a)=>(n(),g(o,{type:t.type,plain:t.plain,key:a+"defaultRightButtons",onClick:a=>e.btnClick(t)},{default:b(()=>[m(x(t.name),1)]),_:2},1032,["type","plain","onClick"]))),128)),p(o,{type:"gradientBlue",onClick:l.createData},{default:b(()=>[...t[8]||(t[8]=[m("生成年度风险预警",-1)])]),_:1},8,["onClick"])])])]),h("article",null,[p(M,w(l.gridOptions,{ref:"xTable"},y({cellDblclick:l.cellDblclick}),{onMenuClick:t[2]||(t[2]=t=>e.menuClickEvent(t,"设备检修"))}),null,16)])])}],["__scopeId","data-v-bc963341"]]);export{A as default};
