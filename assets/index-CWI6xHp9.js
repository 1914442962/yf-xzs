import{D as t}from"./default-setting-mixin-CFiRPWJ9.js";import{u as e,m as s,a as n,s as r,b as o,r as i,o as l,c,d as a,e as h,w as u,f as d,g as m,h as g,i as f,j as y,t as p,k as _,l as T,n as E}from"./index-0nalUVid.js";import{U as C}from"./url-utils-BnIa3tlD.js";import"./polyfill-lGe4XDVY.js";let w={data:()=>({sysKey:null,localTicket:null,bind:!1,fullLoading:!1,isError:!1,errorMsg:"",autoToIndex:!1,omsLoading:!1}),computed:{...n(["token"])},created(){this.handleAutoLogin()},methods:{...s(["setUserInfo","setToken"]),handleAutoLogin(){let t=C.getUrlSearchQueryString("token");t&&(this.fullLoading=!0,this.setToken("Bearer "+t).then(()=>{this.onSetTokenSuccess()}))},onSetTokenSuccess(){return e.getUseInfo().then(t=>{this.setUserInfo(t)}).then(()=>{this.fullLoading=!1,router.push("/index")}).catch(t=>{this.fullLoading=!1,this.onError(t)})},onError(t){this.isError=!0,this.errorMsg=t}}};function B(){this.mode=1,this.isPadding=!0,this.sk=new Array(32)}function S(){this.SM4_ENCRYPT=1,this.SM4_DECRYPT=0;const t=[214,144,233,254,204,225,61,183,22,182,20,194,40,251,44,5,43,103,154,118,42,190,4,195,170,68,19,38,73,134,6,153,156,66,80,244,145,239,152,122,51,84,11,67,237,207,172,98,228,179,28,169,201,8,232,149,128,223,148,250,117,143,63,166,71,7,167,252,243,115,23,186,131,89,60,25,230,133,79,168,104,107,129,178,113,100,218,139,248,235,15,75,112,86,157,53,30,36,14,94,99,88,209,162,37,34,124,59,1,33,120,135,212,0,70,87,159,211,39,82,76,54,2,231,160,196,200,158,234,191,138,210,64,199,56,181,163,247,242,206,249,97,21,161,224,174,93,164,155,52,26,85,173,147,50,48,245,140,177,227,29,246,226,46,130,102,202,96,192,41,35,171,13,83,78,111,213,219,55,69,222,253,142,47,3,255,106,114,109,108,91,81,141,27,175,146,187,221,188,127,17,217,92,65,31,16,90,216,10,193,49,136,165,205,123,189,45,116,208,18,184,229,180,176,137,105,151,74,12,150,119,126,101,185,241,9,197,110,198,132,24,240,125,236,58,220,77,32,121,238,95,62,215,203,57,72],e=[2746333894,1453994832,1736282519,2993693404],s=[462357,472066609,943670861,1415275113,1886879365,2358483617,2830087869,3301692121,3773296373,4228057617,404694573,876298825,1347903077,1819507329,2291111581,2762715833,3234320085,3705924337,4177462797,337322537,808926789,1280531041,1752135293,2223739545,2695343797,3166948049,3638552301,4110090761,269950501,741554753,1213159005,1684763257];this.GET_ULONG_BE=function(t,e){return(255&t[e])<<24|(255&t[e+1])<<16|(255&t[e+2])<<8|255&t[e+3]},this.PUT_ULONG_BE=function(t,e,s){var n=255&t>>24,r=255&t>>16,o=255&t>>8,i=255&t;e[s]=n>128?n-256:n,e[s+1]=r>128?r-256:r,e[s+2]=o>128?o-256:o,e[s+3]=i>128?i-256:i},this.SHL=function(t,e){return(4294967295&t)<<e},this.ROTL=function(t,e){return this.SHL(t,e)|t>>32-e},this.sm4Lt=function(t){let e,s;const n=new Array(4),r=new Array(4);return this.PUT_ULONG_BE(t,n,0),r[0]=this.sm4Sbox(n[0]),r[1]=this.sm4Sbox(n[1]),r[2]=this.sm4Sbox(n[2]),r[3]=this.sm4Sbox(n[3]),e=this.GET_ULONG_BE(r,0),s=e^this.ROTL(e,2)^this.ROTL(e,10)^this.ROTL(e,18)^this.ROTL(e,24),s},this.sm4F=function(t,e,s,n,r){return t^this.sm4Lt(e^s^n^r)},this.sm4CalciRK=function(t){let e,s;const n=new Array(4),r=new Array(4);return this.PUT_ULONG_BE(t,n,0),r[0]=this.sm4Sbox(n[0]),r[1]=this.sm4Sbox(n[1]),r[2]=this.sm4Sbox(n[2]),r[3]=this.sm4Sbox(n[3]),e=this.GET_ULONG_BE(r,0),s=e^this.ROTL(e,13)^this.ROTL(e,23),s},this.sm4Sbox=function(e){const s=t[255&e];return s>128?s-256:s},this.sm4_setkey_enc=function(t,e){return null==t?(alert("ctx is null!"),!1):null==e||16!==e.length?(alert("key error!"),!1):(t.mode=this.SM4_ENCRYPT,void this.sm4_setkey(t.sk,e))},this.sm4_setkey_dec=function(t,e){null==e||e.length,t.mode=0,this.sm4_setkey(t.sk,e),t.sk=t.sk.reverse()},this.sm4_setkey=function(t,n){const r=new Array(4),o=new Array(36);r[0]=this.GET_ULONG_BE(n,0),r[1]=this.GET_ULONG_BE(n,4),r[2]=this.GET_ULONG_BE(n,8),r[3]=this.GET_ULONG_BE(n,12),o[0]=r[0]^e[0],o[1]=r[1]^e[1],o[2]=r[2]^e[2],o[3]=r[3]^e[3];for(let e=0;e<32;e++)o[e+4]=o[e]^this.sm4CalciRK(o[e+1]^o[e+2]^o[e+3]^s[e]),t[e]=o[e+4]},this.padding=function(t,e){let s;if(null==t)return null;let n=null;if(e===this.SM4_ENCRYPT){s=parseInt(16-t.length%16),n=t.slice(0);for(let e=0;e<s;e++)n[t.length+e]=s}else s=t[t.length-1],n=t.slice(0,t.length-s);return n},this.sm4_one_round=function(t,e,s){let n=0;const r=new Array(36);for(r[0]=this.GET_ULONG_BE(e,0),r[1]=this.GET_ULONG_BE(e,4),r[2]=this.GET_ULONG_BE(e,8),r[3]=this.GET_ULONG_BE(e,12);n<32;)r[n+4]=this.sm4F(r[n],r[n+1],r[n+2],r[n+3],t[n]),n++;this.PUT_ULONG_BE(r[35],s,0),this.PUT_ULONG_BE(r[34],s,4),this.PUT_ULONG_BE(r[33],s,8),this.PUT_ULONG_BE(r[32],s,12)},this.sm4_crypt_ecb=function(t,e){null==e&&alert("input is null!"),t.isPadding&&t.mode===this.SM4_ENCRYPT&&(e=this.padding(e,this.SM4_ENCRYPT));let s=0,n=e.length,r=[];for(;n>0;n-=16){var o=new Array(16),i=e.slice(16*s,16*(s+1));this.sm4_one_round(t.sk,i,o),r=r.concat(o),s++}let l=r;for(t.isPadding&&t.mode===this.SM4_DECRYPT&&(l=this.padding(l,this.SM4_DECRYPT)),s=0;s<l.length;s++)l[s]<0&&(l[s]=l[s]+256);return l},this.sm4_crypt_cbc=function(t,e,s){let n,r,o,i;null!=e&&16===e.length||alert("iv error!"),null==s&&alert("input is null!"),t.isPadding&&t.mode===this.SM4_ENCRYPT&&(s=this.padding(s,this.SM4_ENCRYPT));let l=0,c=s.length,a=[];if(t.mode===this.SM4_ENCRYPT)for(i=0;c>0;c-=16){for(n=new Array(16),o=new Array(16),r=s.slice(16*i,16*(i+1)),l=0;l<16;l++)n[l]=r[l]^e[l];this.sm4_one_round(t.sk,n,o),e=o.slice(0,16),a=a.concat(o),i++}else{let h=[];for(i=0;c>0;c-=16){for(n=new Array(16),o=new Array(16),r=s.slice(16*i,16*(i+1)),h=r.slice(0,16),this.sm4_one_round(t.sk,r,n),l=0;l<16;l++)o[l]=n[l]^e[l];e=h.slice(0,16),a=a.concat(o),i++}}let h=a;for(t.isPadding&&t.mode===this.SM4_DECRYPT&&(h=this.padding(h,this.SM4_DECRYPT)),l=0;l<h.length;l++)h[l]<0&&(h[l]=h[l]+256);return h}}!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else{let e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.base64js=t()}}(function(){return function t(e,s,n){const r="function"==typeof require&&require;function o(i,l){if(!s[i]){if(!e[i]){const t="function"==typeof require&&require;if(!l&&t)return t(i,!0);if(r)return r(i,!0);const e=new Error("Cannot find module '"+i+"'");throw e.code="MODULE_NOT_FOUND",e}const c=s[i]={exports:{}};e[i][0].call(c.exports,function(t){const s=e[i][1][t];return o(s||t)},c,c.exports,t,e,s,n)}return s[i].exports}for(let i=0;i<n.length;i++)o(n[i]);return o}({"/":[function(t,e,s){s.byteLength=function(t){return 3*t.length/4-c(t)},s.toByteArray=function(t){let e,s,n,i,l;const a=t.length;i=c(t),l=new o(3*a/4-i),s=i>0?a-4:a;let h=0;for(e=0;e<s;e+=4)n=r[t.charCodeAt(e)]<<18|r[t.charCodeAt(e+1)]<<12|r[t.charCodeAt(e+2)]<<6|r[t.charCodeAt(e+3)],l[h++]=n>>16&255,l[h++]=n>>8&255,l[h++]=255&n;2===i?(n=r[t.charCodeAt(e)]<<2|r[t.charCodeAt(e+1)]>>4,l[h++]=255&n):1===i&&(n=r[t.charCodeAt(e)]<<10|r[t.charCodeAt(e+1)]<<4|r[t.charCodeAt(e+2)]>>2,l[h++]=n>>8&255,l[h++]=255&n);return l},s.fromByteArray=function(t){let e;const s=t.length,r=s%3;let o="";const i=[],l=16383;let c=0,a=s-r;for(;c<a;c+=l)i.push(h(t,c,c+l>a?a:c+l));1===r?(e=t[s-1],o+=n[e>>2],o+=n[e<<4&63],o+="=="):2===r&&(e=(t[s-2]<<8)+t[s-1],o+=n[e>>10],o+=n[e>>4&63],o+=n[e<<2&63],o+="=");return i.push(o),i.join("")};const n=[],r=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";let l=0;for(;l<64;++l)n[l]=i[l],r[i.charCodeAt(l)]=l;function c(t){const e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===t[e-2]?2:"="===t[e-1]?1:0}function a(t){return n[t>>18&63]+n[t>>12&63]+n[t>>6&63]+n[63&t]}function h(t,e,s){let n;const r=[];for(let o=e;o<s;o+=3)n=(t[o]<<16)+(t[o+1]<<8)+t[o+2],r.push(a(n));return r.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},{}]},{},[])("/")});const b=function(){this.secretKey="GJwsXX_BzW=gJWJW",this.iv="ZkR_SiNoSOFT=568",this.hexString=!1,this.encryptDefault_ECB=function(t){try{const e=new S,s=new B;s.isPadding=!0,s.mode=e.SM4_ENCRYPT;const n=this.stringToByte(this.secretKey);e.sm4_setkey_enc(s,n);const r=e.sm4_crypt_ecb(s,this.stringToByte(t)),o=base64js.fromByteArray(r);return null!=o&&o.trim().length>0&&o.replace(/(\s*|\t|\r|\n)/g,""),o}catch(e){return console.error(e),null}},this.encryptCustom_ECB=function(t,e){try{const s=new S,n=new B;n.isPadding=!0,n.mode=s.SM4_ENCRYPT;const r=this.stringToByte(e);s.sm4_setkey_enc(n,r);const o=s.sm4_crypt_ecb(n,this.stringToByte(t)),i=base64js.fromByteArray(o);return null!=i&&i.trim().length>0&&i.replace(/(\s*|\t|\r|\n)/g,""),i}catch(s){return console.error(s),null}},this.decryptDefault_ECB=function(t){try{let e=new S,s=new B;s.isPadding=!0,s.mode=e.SM4_ENCRYPT;let n=this.stringToByte(this.secretKey);e.sm4_setkey_dec(s,n);let r=e.sm4_crypt_ecb(s,base64js.toByteArray(t));return this.byteToString(r)}catch(e){return console.error(e),null}},this.decryptCustom_ECB=function(t,e){try{let s=new S,n=new B;n.isPadding=!0,n.mode=s.SM4_ENCRYPT;let r=this.stringToByte(e);s.sm4_setkey_dec(n,r);let o=s.sm4_crypt_ecb(n,base64js.toByteArray(t));return this.byteToString(o)}catch(s){return console.error(s),null}},this.encryptDefault_CBC=function(t){try{const e=new S,s=new B;s.isPadding=!0,s.mode=e.SM4_ENCRYPT;const n=this.stringToByte(this.secretKey),r=this.stringToByte(this.iv);e.sm4_setkey_enc(s,n);const o=e.sm4_crypt_cbc(s,r,this.stringToByte(t)),i=base64js.fromByteArray(o);return null!=i&&i.trim().length>0&&i.replace(/(\s*|\t|\r|\n)/g,""),i}catch(e){return console.error(e),null}},this.encryptCustom_CBC=function(t,e,s){try{const n=new S,r=new B;r.isPadding=!0,r.mode=n.SM4_ENCRYPT;const o=this.stringToByte(s),i=this.stringToByte(e);n.sm4_setkey_enc(r,o);const l=n.sm4_crypt_cbc(r,i,this.stringToByte(t)),c=base64js.fromByteArray(l);return null!=c&&c.trim().length>0&&c.replace(/(\s*|\t|\r|\n)/g,""),c}catch(n){return console.error(n),null}},this.decryptDefault_CBC=function(t){try{let e=new S,s=new B;s.isPadding=!0,s.mode=e.SM4_ENCRYPT;let n=this.stringToByte(this.secretKey),r=this.stringToByte(this.iv);e.sm4_setkey_dec(s,n);let o=e.sm4_crypt_cbc(s,r,base64js.toByteArray(t));return this.byteToString(o)}catch(e){return console.error(e),null}},this.decryptCustom_CBC=function(t,e,s){try{let n=new S,r=new B;r.isPadding=!0,r.mode=n.SM4_ENCRYPT;let o=this.stringToByte(s),i=this.stringToByte(e);n.sm4_setkey_dec(r,o);let l=n.sm4_crypt_cbc(r,i,base64js.toByteArray(t));return this.byteToString(l)}catch(n){return console.error(n),null}},this.stringToByte=function(t){const e=[];let s,n;s=t.length;for(let r=0;r<s;r++)n=t.charCodeAt(r),n>=65536&&n<=1114111?(e.push(n>>18&7|240),e.push(n>>12&63|128),e.push(n>>6&63|128),e.push(63&n|128)):n>=2048&&n<=65535?(e.push(n>>12&15|224),e.push(n>>6&63|128),e.push(63&n|128)):n>=128&&n<=2047?(e.push(n>>6&31|192),e.push(63&n|128)):e.push(255&n);return e},this.byteToString=function(t){if("string"==typeof t)return t;let e="",s=t;for(let n=0;n<s.length;n++){const t=s[n].toString(2),r=t.match(/^1+?(?=0)/);if(r&&8===t.length){const t=r[0].length;let o=s[n].toString(2).slice(7-t);for(let e=1;e<t;e++)o+=s[e+n].toString(2).slice(2);e+=String.fromCharCode(parseInt(o,2)),n+=t-1}else e+=String.fromCharCode(s[n])}return e}},L={class:"login-container"},N={class:"login-form"},A={class:"login-page-name"},P={style:{"font-size":"16px",opacity:"0.8","margin-top":"10px","font-family":"DengXian"}},U={class:"version-info"};const k=o({name:"login",computed:{User:()=>E,Lock:()=>T},data:()=>({loginForm:{username:"",password:""},loginFormRules:{username:[{required:!0,message:"请输入登录名称",trigger:"blur"}],password:[{required:!0,message:"请输入登录密码",trigger:"blur"}]},passwordType:"password",capsTooltip:!1,loading:!1,showDialog:!1,redirect:void 0,otherQuery:{},sysKey:null,projectEnglishName:"YUN FANG YE WU ZHI LIAN QU DONG PING TAI"}),mixins:[w,t],watch:{$route:{handler:function(t){const e=t.query;e&&(this.redirect=e.redirect,this.otherQuery=this.getOtherQuery(e))},immediate:!0}},mounted(){""===this.loginForm.username?this.$refs.username.focus():""===this.loginForm.password&&this.$refs.password.focus()},methods:{handleLogin(){this.$refs.loginForm.validate(t=>{if(!t)return console.log("error submit!!"),!1;{this.loading=!0;let t=new b,n="{sm4c}".concat(t.encryptCustom_CBC(this.loginForm.password,"@$binfo-tech%$&*","@#binfo-tech!%$*")),o={first:this.loginForm.username,pwd:n};(s=o,new Promise((t,n)=>{e.loginInService(s).then(e=>{r.dispatch("setToken","Bearer "+e.data).then(()=>{t()})}).catch(t=>{n(t)})})).then(()=>{this.loading=!1,_.push("/index")}).catch(()=>{this.loading=!1})}var s})},getOtherQuery:t=>Object.keys(t).reduce((e,s)=>("redirect"!==s&&(e[s]=t[s]),e),{})}},[["render",function(t,e,s,n,r,o){const _=i("el-input"),T=i("el-form-item"),E=i("i-ep-lock"),C=i("el-button"),w=i("el-form"),B=i("el-alert");return l(),c("div",L,[a("div",N,[h(w,{ref:"loginForm",model:r.loginForm,rules:r.loginFormRules,autocomplete:"on",class:"form_div","label-position":"left"},{default:u(()=>[e[3]||(e[3]=a("div",{class:"title-container"},[a("h3",{class:"title"},"欢迎登陆")],-1)),h(T,{prop:"username"},{default:u(()=>[h(_,{size:"large",ref:"username","prefix-icon":o.User,modelValue:r.loginForm.username,"onUpdate:modelValue":e[0]||(e[0]=t=>r.loginForm.username=t),placeholder:"请输入用户名",name:"username",type:"text",tabindex:"1",autocomplete:"on"},null,8,["prefix-icon","modelValue"])]),_:1}),h(T,{prop:"password"},{default:u(()=>[h(E,{class:"mx-2"}),(l(),d(_,{size:"large",key:r.passwordType,ref:"password","prefix-icon":o.Lock,modelValue:r.loginForm.password,"onUpdate:modelValue":e[1]||(e[1]=t=>r.loginForm.password=t),type:r.passwordType,placeholder:"请输入密码",name:"password","show-password":"",tabindex:"2",autocomplete:"on",onKeyup:m(o.handleLogin,["enter","native"])},null,8,["prefix-icon","modelValue","type","onKeyup"]))]),_:1}),h(C,{loading:r.loading,type:"primary",class:"login_button",size:"large",onClick:g(o.handleLogin,["prevent"])},{default:u(()=>[...e[2]||(e[2]=[f("登 录 ",-1)])]),_:1},8,["loading","onClick"])]),_:1},8,["model","rules"])]),t.isError&&!t.autoToIndex?(l(),d(B,{key:0,title:t.errorMsg,type:"error"},null,8,["title"])):y("",!0),e[4]||(e[4]=a("div",{class:"login-page-logo"},null,-1)),a("div",A,[a("p",null,p(t.projectName),1),a("p",P,p(r.projectEnglishName),1)]),a("div",U,p(t.version),1)])}],["__scopeId","data-v-9f9c53a1"]]);export{k as default};
