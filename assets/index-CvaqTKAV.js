import{A as e,B as t,D as a,b as i,E as l,r as s,o as d,c as o,d as r,i as n,e as h,g as c,F as u,v as m,f as p,w as f,t as g,x as b,y as w,p as x,j as y}from"./index-CRHEuOwk.js";import{t as D,v}from"./table_mixin-BbK9105O.js";import{d as k}from"./dynamic_form-CNCkViXR.js";import{v as _}from"./view_simple_table-CQGl65v9.js";/* empty css                      *//* empty css                                                                  */import"./polyfill-lGe4XDVY.js";import"./view_file-Wf0UYuGf.js";import"./zcq-sb-dky-MAcsFiX-.js";let C=t.base;const T={loadTreeDataService:t=>e({url:"".concat(C,"/jxjh/getMenu"),method:"post",data:t,showLoading:!0}),loadButtonDataService:t=>e({url:"".concat(C,"/public/getButton"),method:"post",data:t,showLoading:!0}),loadInnerButtonDataService:t=>e({url:"".concat(C,"/public/getTcButton"),method:"post",data:t,showLoading:!0}),loadTableDataService:t=>e({url:"".concat(C,"/jxjh/bgd"),method:"post",data:t,showLoading:!0}),saveTableDataService:t=>e({url:"".concat(C,"/jxjh/saveBgd"),method:"post",data:t,showLoading:!0}),doDelTableDataService:t=>e({url:"".concat(C,"/jxjh/deleteBgd"),method:"post",data:t,showLoading:!0}),loadDialogDataService:t=>e({url:"".concat(C,"/jxjh/bgdLog"),method:"post",data:t,showLoading:!0}),loadFlowDataService:t=>e({url:"".concat(C,"/common/deleteById"),method:"post",data:t,showLoading:!0}),exportTableDataFileService:(t,i)=>e({url:"".concat(C,"/common/deleteById"),method:"post",data:t,responseType:"blob",showLoading:!0}).then(e=>{a(e,i,"xlsx")}),downloadModuleService:t=>e({url:"".concat(C,"/common/downLoadModule"),method:"post",data:t,responseType:"blob",showLoading:!0}).then(e=>{a(e,"导入模板","xlsx")})},j={class:"page_content"},L={class:"header-item"},B={class:"header-item"},z={class:"header-item"},S={class:"header-item"};const $=i({name:"fsgbd",components:{Fsbgd_table:i({name:"fsbgd_table",mixins:[D],components:{},props:{node:Object},data:()=>({time:["",""],total:0,searchParams:{keyword:"",sdt:"",edt:"",sortOrder:"",sortColumn:""},tableData:[],isAutoWrap:!1,defaultLeftButtons:[],defaultRightButtons:[]}),watch:{time:{handler(e){e?(this.searchParams.sdt=e[0],this.searchParams.edt=e[1]):(this.searchParams.sdt="",this.searchParams.edt="")},immediate:!1}},computed:{tableHeaderList:()=>[{type:"checkbox",width:50,fixed:"left"},{type:"seq",width:60,fixed:"left"},{field:"bh",title:"编号",width:120,fixed:"left"},{field:"fslx",title:"方式类型",width:120},{field:"bgdmc",title:"变更单名称",width:120},{field:"bgdnr",title:"变更单内容",minWidth:160,headerAlign:"center",align:"left"},{field:"bzr",title:"编制人",width:90},{field:"bzsj",title:"编制时间",sortable:!0,width:150},{field:"tzsj",title:"调整时间",sortable:!0,width:150},{field:"fszt",title:"方式状态",width:100},{field:"dqzt",title:"处理状态",width:120,slots:{default:"dqzt"}}],tableDetailHeaderList(){return[{field:"bh",title:"变更单编号",colWidth:"50%",editRender:{}},{field:"bgdmc",title:"变更单名称",colWidth:"50%",editRender:{name:"ElInput",props:{clearable:!0}}},{field:"fslx",title:"方式类型",colWidth:"50%",editRender:{name:"$ElTreeSelect",data:this.$store.state.staticOptionsObj.fslx,props:{clearable:!0}}},{field:"tzsj",title:"调整时间",colWidth:"50%",editRender:{name:"ElDatePicker",props:{type:"datetime",labelFormat:"YYYY-MM-DD HH:mm:ss",valueFormat:"YYYY-MM-DD HH:mm:ss"}}},{field:"bgdnr",title:"变更单内容",editRender:{name:"ElInput",props:{type:"textarea",clearable:!0,autosize:!this.isAutoWrap||{maxRows:1},resize:"none"}}},{field:"fileList",title:"附件",editRender:{name:"vxeUpload",props:{multiple:!0,types:["doc","docx","xls","xlsx","pdf"],type:"fsbgd",limitSize:50}}},{field:"fszt",title:"方式状态",editRender:{name:"$ElTreeSelect",data:this.$store.state.staticOptionsObj.fszt,props:{clearable:!0,filterable:!0}}}]},editRules:()=>({bgdmc:[{required:!0,message:"变更单名称不能为空"}],fslx:[{required:!0,message:"方式类型不能为空"}],tzsj:[{required:!0,message:"调整时间不能为空"}],bgdnr:[{required:!0,message:"变更单内容不能为空"}],fszt:[{required:!0,message:"变更单内容不能为空"}]}),gridOptions(){return{height:"auto",keepSource:!0,border:!0,round:!0,stripe:!0,headerAlign:"center",align:"center",loading:!1,rowConfig:{isCurrent:!0,isHover:!0},radioConfig:{highlight:!0},checkboxConfig:{highlight:!0},columnConfig:{resizable:!0},sortConfig:{remote:!0},filterConfig:{remote:!0},showOverflow:this.isAutoWrap,headerCellClassName:"row-class",pagerConfig:this.pagerConfig,proxyConfig:{seq:!0,showResponseMsg:!1,showActionMsg:!1,sort:!0,filter:!0,ajax:{query:({page:e,sorts:t,filters:a})=>this.loadTableApi(e,t,a),queryAll:({sorts:e,filters:t})=>this.loadTableApi({pageSize:1e5,currentPage:1},e,t),delete:({body:e})=>this.doDeleteApi(e.removeRecords)}},exportConfig:{filename:"方式变更单表格",sheetName:"sheet1",type:"xlsx",mode:"all",modes:["current","selected","all"],message:!1,columns:this.tableHeaderList.filter(e=>"checkbox"!==e.type),exportMethod:this.exportMethod,afterExportMethod:this.afterExportMethod},columns:this.tableHeaderList,menuConfig:{body:{options:[[{code:"collect",name:"标记重点"}]]}},cellClassName:({row:e,column:t})=>"jszt"===t.field&&"未接收"===e.jszt?"row-red":null}},defaultDefaultButtons:()=>[{type:"gradientGreen",name:"查询"},{type:"gradientDarkGreen",name:"重置"},{type:"gradientGreen",name:"自动换行"}]},mounted(){this.getButtons()},methods:{getButtons(){T.loadButtonDataService({id:this.node.id,title:this.node.title}).then(e=>{this.defaultLeftButtons=e.data.filter(e=>"left"==e.position),this.defaultRightButtons=e.data.filter(e=>"right"==e.position)}).catch(()=>{this.defaultLeftButtons=[{type:"gradientBlue",name:"查看日志"},{type:"gradientBlue",name:"查看流程图"}],this.defaultRightButtons=[{type:"gradientBlue",name:"新增"},{type:"gradientRed",name:"删除"},{type:"gradientBlue",name:"发送"}]})},reloadTableData(){this.$refs.xTable.commitProxy("query")},loadTableData(){this.$refs.xTable.commitProxy("reload")},loadTableApi(e,t,a){let i=this.getRealParams(this.searchParams,e,t,a);return new Promise(t=>{T.loadTableDataService({...i,id:this.node.id,title:this.node.title}).then(a=>{1e5==e.pageSize?(this.total=a.total,t(a.data)):(this.total=a.total,t({result:a.data,page:{total:a.total}}))})})},toggleWrap(){this.isAutoWrap?this.isAutoWrap=!1:this.isAutoWrap="tooltip"},doDelete(){const e=this.getCheckboxRecords();e&&e.length>0&&this.$confirm("确认删除勾选的".concat(e.length,"条数据吗？"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await this.$refs.xTable.commitProxy("delete"),this.loadTableData(),this.$emit("loadTree")})},doDeleteApi(e){return new Promise((t,a)=>{let i=e.map(e=>e.id).join(",");T.doDelTableDataService({ids:i}).then(e=>{this.$message.success(e.data),t()}).catch(()=>{a()})})},resetParams(){this.searchParams.keyword="",this.searchParams.sortOrder="",this.searchParams.sortColumn="",this.time=["",""],this.$nextTick(function(){this.loadTableData()})},doAdd(){l.getAddIdService().then(e=>{this.$vxeModal.show(k,{tableHeaderList:this.tableDetailHeaderList,validateRules:this.editRules,row:{id:e.data,fileList:[]},labelWidth:"120px"},{width:800,title:"新增",height:window.innerHeight-400},{doSubmit:e=>{let t={id:this.node.id,title:this.node.title,button:"新增",data:[e]};T.saveTableDataService(t).then(e=>{this.$message.success(e.data),this.$vxeModal.closeAll(),this.loadTableData(),this.$emit("loadTree")})}})})},doExport(e){l.exportFileService("/jxjh/exportBgd",{...this.searchParams,userName:this.$store.state.userInfo.sysUser.nickName,userId:this.$store.state.userInfo.sysUser.id,id:this.node.id,title:this.node.title},e,this.pagerParam)},cellDblclick(e){let{row:t}=e;this.openDetail(t)},openDetail(e){T.loadInnerButtonDataService({id:this.node.id,title:this.node.title}).then(t=>{let a=t.data.some(e=>"保存"==e.name);this.$vxeModal.show(k,{tableHeaderList:this.tableDetailHeaderList,validateRules:this.editRules,row:e,isDisabled:!a,labelWidth:"120px",footerButtonList:t.data},{width:1200,title:"详情",height:window.innerHeight-200},{close:()=>{},doSubmit:e=>{let t={id:this.node.id,title:this.node.title,button:"保存",data:[e]};T.saveTableDataService(t).then(e=>{this.$message.success(e.data),this.$vxeModal.closeAll(),this.loadTableData(),this.$emit("loadTree")})},doOperate:async e=>{await this.doOperation(e.btn,[e.data]),this.$vxeModal.closeAll()}})})},doViewDialog(){const e=this.getCheckboxRecords();e&&e.length>0&&T.loadDialogDataService({bgdId:e[0].id}).then(e=>{this.$vxeModal.show(_,{tableHeaderList:[{type:"seq",width:60},{field:"cz",title:"操作",width:"80"},{field:"time",title:"操作时间",width:"150"},{field:"czr",title:"操作人",width:"100"},{field:"ksjd",title:"开始节点"},{field:"jsjd",title:"结束节点"},{field:"yj",title:"意见"}],tableData:e.data},{width:800,title:"日志",height:600},{})})},doOperation(e,t=[]){t&&0!=t.length||(t=this.getCheckboxRecords()),t&&t.length>0&&this.$vxeModal.show(v,{},{width:360,height:220,title:"意见",resize:!1},{returnData:a=>{let i={id:this.node.id,title:this.node.title,button:e.name,yj:a,data:t};T.saveTableDataService(i).then(e=>{this.$message.success(e.data),this.loadTableData(),this.$emit("loadTree")})}})}}},[["render",function(e,t,a,i,l,x){const y=s("el-date-picker"),D=s("el-input"),v=s("el-button"),k=s("arrow-down"),_=s("el-icon"),C=s("el-dropdown-item"),T=s("el-dropdown-menu"),$=s("el-dropdown"),M=s("vxe-tag"),R=s("vxe-grid");return d(),o("div",j,[r("header",null,[r("section",null,[r("div",L,[t[4]||(t[4]=n(" 日期范围： ",-1)),h(y,{modelValue:l.time,"onUpdate:modelValue":t[0]||(t[0]=e=>l.time=e),type:"daterange",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期",style:{width:"250px"}},null,8,["modelValue"])]),r("div",B,[h(D,{placeholder:"请输入关键字",modelValue:l.searchParams.keyword,"onUpdate:modelValue":t[1]||(t[1]=e=>l.searchParams.keyword=e),onKeydown:c(x.loadTableData,["enter"]),title:l.searchParams.keyword,clearable:"",style:{width:"150px"}},null,8,["modelValue","onKeydown","title"])]),r("div",z,[(d(!0),o(u,null,m(x.defaultDefaultButtons,(t,a)=>(d(),p(v,{type:t.type,plain:t.plain,key:a+"defaultDefaultButtons",onClick:a=>e.btnClick(t)},{default:f(()=>[n(g(t.name),1)]),_:2},1032,["type","plain","onClick"]))),128)),h($,{style:{margin:"0 10px"}},{dropdown:f(()=>[h(T,null,{default:f(()=>[h(C,{onClick:x.doExport},{default:f(()=>[...t[6]||(t[6]=[n("导出当前页",-1)])]),_:1},8,["onClick"]),h(C,{onClick:t[2]||(t[2]=e=>x.doExport(!0))},{default:f(()=>[...t[7]||(t[7]=[n("导出全部",-1)])]),_:1})]),_:1})]),default:f(()=>[h(v,{type:"gradientGreen"},{default:f(()=>[t[5]||(t[5]=n(" 导出",-1)),h(_,{class:"el-icon--right"},{default:f(()=>[h(k)]),_:1})]),_:1})]),_:1}),(d(!0),o(u,null,m(l.defaultLeftButtons,(t,a)=>(d(),p(v,{type:t.type,plain:t.plain,key:a+"defaultLeftButtons",onClick:a=>e.btnClick(t)},{default:f(()=>[n(g(t.name),1)]),_:2},1032,["type","plain","onClick"]))),128))])]),r("section",null,[r("div",S,[(d(!0),o(u,null,m(l.defaultRightButtons,(t,a)=>(d(),p(v,{type:t.type,plain:t.plain,key:a+"defaultRightButtons",onClick:a=>e.btnClick(t)},{default:f(()=>[n(g(t.name),1)]),_:2},1032,["type","plain","onClick"]))),128))])])]),r("article",null,[h(R,b(x.gridOptions,{ref:"xTable"},w({cellDblclick:x.cellDblclick}),{onMenuClick:t[3]||(t[3]=t=>e.menuClickEvent(t,"设备检修"))}),{dqzt:f(({row:e,column:t})=>["已退回"==e.dqzt||"已作废"==e.dqzt?(d(),p(M,{key:0,status:"error"},{default:f(()=>[n(g(e.dqzt),1)]),_:2},1024)):e.dqzt.includes("已")?(d(),p(M,{key:1,status:"success"},{default:f(()=>[n(g(e.dqzt),1)]),_:2},1024)):(d(),p(M,{key:2,status:"info"},{default:f(()=>[n(g(e.dqzt),1)]),_:2},1024))]),_:1},16)])])}],["__scopeId","data-v-499b9abf"]])},data:()=>({treeData:[],node:{}}),created(){this.loadLeftData()},methods:{customNodeClass({id:e}){return this.node.id==e?"active_tree":""},loadLeftData(){T.loadTreeDataService({menu:this.keyword}).then(e=>{this.treeData=e.data.menuTreeList,this.node.id||this.handleNodeClick(this.treeData[0].children[0])})},handleNodeClick(e){e.children||(this.node=e)}}},[["render",function(e,t,a,i,l,o){const c=s("el-tree"),u=s("el-aside"),m=s("fsbgd_table"),b=s("el-main"),w=s("el-container");return d(),p(w,{id:"fsbgd"},{default:f(()=>[h(u,null,{default:f(()=>[t[0]||(t[0]=r("p",null,[r("span",{class:"fsbgd_left"}),n("运行方式变更单")],-1)),h(c,{data:l.treeData,onNodeClick:o.handleNodeClick,"default-expand-all":!0,props:{class:o.customNodeClass}},{default:f(({node:e,data:t})=>[r("div",null,[r("i",{class:x([t.icon,"tree_icon"])},null,2),n(" "+g(1==t.type?t.title:t.title+"（"+t.count+"）"),1)])]),_:1},8,["data","onNodeClick","props"])]),_:1}),h(b,null,{default:f(()=>[l.node.id?(d(),p(m,{key:l.node.id,node:l.node,onLoadTree:o.loadLeftData},null,8,["node","onLoadTree"])):y("",!0)]),_:1})]),_:1})}],["__scopeId","data-v-3efd1bcc"]]);export{$ as default};
