System.register(["./table_mixin-legacy-CgAfMSCC.js","./drfx-api-legacy-C9T-YGx0.js","./index-legacy-CW2Mof-g.js","./view_file-legacy-ydAzmqEn.js","./DateRangerPickerComponent-legacy-BOJmcdm9.js","./polyfill-legacy-aWkUxw0k.js"],function(e,t){"use strict";var a,l,s,i,r,o,d,n,c,u,m,h,p,f,g,w,b,y,x,v,k;return{setters:[e=>{a=e.t},e=>{l=e.d},e=>{s=e.b,i=e.r,r=e.o,o=e.c,d=e.d,n=e.e,c=e.i,u=e.w,m=e.F,h=e.v,p=e.f,f=e.g,g=e.t,w=e.x,b=e.E,y=e.M,x=e.z},e=>{v=e.v},e=>{k=e.D},null],execute:function(){const t={class:"page_content"},C={class:"header-item"},P={class:"header-item"},R={class:"header-item"},S={class:"header-item"},j={class:"header-item"},M={class:"header-item"};e("default",s({name:"txfx",mixins:[a],components:{DateRangerPickerComponent:k},data:()=>({total:0,searchParams:{status:"全部",bh:"",keyword:"",lx:"特巡",sortOrder:"",sortColumn:"",sdt:"",edt:""},tableData:[],isAutoWrap:!1,statusOptions:[{label:"已确认",value:"已确认"},{label:"未确认",value:"未确认"}]}),watch:{},computed:{tableHeaderList(){return[{type:"checkbox",width:50,fixed:"left"},{type:"seq",width:60,fixed:"left"},{field:"bh",title:"检修编号",width:180},{field:"sy",title:"事由",minWidth:220,headerAlign:"center",align:"left",editRender:{name:"ElInput",props:{type:"textarea",clearable:!0,autosize:!this.isAutoWrap||{maxRows:1},resize:"none"}}},{field:"fxdj",title:"风险等级",width:100,editRender:{name:"ElInput",props:{clearable:!0}}},{field:"kssj",title:"开始时间",width:140,sortable:!0,editRender:{name:"ElDatePicker",props:{type:"datetime",labelFormat:"YYYY-MM-DD HH:mm",valueFormat:"YYYY-MM-DD HH:mm",timeFormat:"HH:mm",clearable:!0}}},{field:"jssj",title:"结束时间",width:140,sortable:!0,editRender:{name:"ElDatePicker",props:{type:"datetime",labelFormat:"YYYY-MM-DD HH:mm",valueFormat:"YYYY-MM-DD HH:mm",timeFormat:"HH:mm",clearable:!0}}},{field:"yq",title:"要求",minWidth:200,headerAlign:"center",align:"left",editRender:{name:"ElInput",props:{type:"textarea",clearable:!0,autosize:!this.isAutoWrap||{maxRows:1},resize:"none"}}},{field:"bm",title:"部门",width:120,editRender:{name:"ElInput",props:{type:"textarea",clearable:!0,autosize:!this.isAutoWrap||{maxRows:1},resize:"none"}}},{field:"status",title:"状态",width:100,editRender:{name:"ElSelect",options:[{label:"已确认",value:"已确认"},{label:"未确认",value:"未确认"}],props:{clearable:!0}},slots:{default:"status"}},{title:"操作",width:90,fixed:"right",slots:{default:"action"}}]},editRules:()=>({kssj:[{required:!0,message:"开始时间不能为空"},{validator({cellValue:e,row:t}){if(e&&t.jssj&&x(e).isAfter(t.jssj))return new Error("开始时间必须在结束时间之前")}}],jssj:[{required:!0,message:"结束时间不能为空"},{validator({cellValue:e,row:t}){if(e&&t.kssj&&x(e).isBefore(t.kssj))return new Error("结束时间必须在开始时间之后")}}]}),gridOptions(){return{height:"auto",border:!0,round:!0,stripe:!0,headerAlign:"center",keepSource:!0,align:"center",loading:!1,rowConfig:{isCurrent:!0,isHover:!0},columnConfig:{resizable:!0},resizeConfig:{isDblclickAutoWidth:!0},sortConfig:{remote:!0},showOverflow:this.isAutoWrap,headerCellClassName:"row-class",pagerConfig:this.pagerConfig,proxyConfig:{seq:!0,showResponseMsg:!1,showActionMsg:!1,sort:!0,filter:!0,ajax:{query:({page:e,sorts:t,filters:a})=>this.loadTableApi(e,t,a),queryAll:({sorts:e,filters:t})=>this.loadTableApi({pageSize:1e5,currentPage:1},e,t),save:({body:e})=>this.doSaveApi(e)}},editConfig:{trigger:"click",mode:"cell",showStatus:!0,showIcon:!0,beforeEditMethod:this.beforeEditMethod},editRules:this.editRules,columns:this.tableHeaderList,menuConfig:{body:{options:[[{code:"collect",name:"标记重点"}]]}}}},defaultLeftButtons:()=>[{type:"gradientGreen",name:"查询"},{type:"gradientDarkGreen",name:"重置"},{type:"gradientGreen",name:"自动换行"}],defaultRightButtons:()=>[{type:"gradientBlue",name:"保存"},{type:"gradientBlue",name:"发送短信"}]},mounted(){},methods:{reloadTableData(){this.$refs.xTable.commitProxy("query")},loadTableData(){this.$refs.xTable.commitProxy("reload")},loadTableApi(e,t,a){console.log(111);let s=this.getRealParams(this.searchParams,e,t,a);return new Promise(t=>{l.loadTableDataService(s).then(a=>{1e5==e.pageSize?(this.total=a.total,t(a.data)):(this.total=a.total,t({result:a.data,page:{total:a.total}}))})})},toggleWrap(){this.isAutoWrap?this.isAutoWrap=!1:this.isAutoWrap="tooltip"},doSave(){const e=this.getUpdateRecords();e&&e.length>0&&this.$refs.xTable.commitProxy("save")},doSaveApi(e){return new Promise((t,a)=>{let{insertRecords:s,updateRecords:i}=e,r=[...s,...i];l.saveTableDataService({data:r}).then(e=>{this.$message.success(e.data),t()}).catch(()=>{a()})})},resetParams(){this.searchParams.status="全部",this.searchParams.bh="",this.searchParams.keyword="",this.searchParams.sortOrder="",this.searchParams.sortColumn="",this.searchParams.sdt="",this.searchParams.edt="",this.$nextTick(function(){this.loadTableData()})},doExport(e){b.exportFileService("/fxyj/exportDrTx",this.searchParams,e,this.pagerParam)},doViewLog(e){let t="";t=window.origin.includes("192.168.1")?`http://192.168.1.194:10015/master/window.html#/spa/ycjx-snjh/public-visit?&flag=3&type=dd&id=${e.jxdId}&parentNodeName=地调调度台`:`${window.YCJX_WEBSITE_URL}/master/window.html#/spa/ycjx-snjh/public-visit?&flag=3&type=dd&id=${e.jxdId}&parentNodeName=地调调度台`,window.open(t)},doSendMessage(e){if(e&&e.id)this.doRealSendMessage([e]);else{const e=this.getCheckboxRecords();e&&e.length>0&&this.doRealSendMessage(e)}},doRealSendMessage(e){l.doSendMessageService({data:e}).then(e=>{this.$message.success(e.data)})},downloadMethod(e){l.getFileIdService({data:e}).then(e=>{b.downloadFileGetService({fileId:e.data.id})})},previewMethod(e){l.getFileIdService({data:e}).then(e=>{this.$store.state.isXzs?b.preViewFileGetService({fileId:e.data.id}):b.preViewFileService({fileId:e.data.id}).then(e=>{let t=y(e,"pdf")+"#toolbar=0";this.$vxeModal.show(v,{url:t},{width:800,title:"文件预览",height:window.innerHeight-20},{})})})},beforeEditMethod:({row:e,column:t})=>!0}},[["render",function(e,a,l,s,b,y){const x=i("DateRangerPickerComponent"),v=i("el-option"),k=i("el-select"),D=i("el-input"),T=i("el-button"),E=i("arrow-down"),_=i("el-icon"),A=i("el-dropdown-item"),Y=i("el-dropdown-menu"),H=i("el-dropdown"),V=i("vxe-button"),I=i("vxe-grid");return r(),o("div",t,[d("header",null,[d("section",null,[n(x,{"start-time":b.searchParams.sdt,"end-time":b.searchParams.edt,updateStartTime:b.searchParams.sdt,"onUpdate:updateStartTime":a[0]||(a[0]=e=>b.searchParams.sdt=e),updateEndTime:b.searchParams.edt,"onUpdate:updateEndTime":a[1]||(a[1]=e=>b.searchParams.edt=e)},null,8,["start-time","end-time","updateStartTime","updateEndTime"]),d("div",C,[a[7]||(a[7]=c(" 状态： ",-1)),n(k,{"value-on-clear":"全部",modelValue:b.searchParams.status,"onUpdate:modelValue":a[2]||(a[2]=e=>b.searchParams.status=e),placeholder:"请选择",clearable:"",style:{width:"100px"}},{default:u(()=>[(r(!0),o(m,null,h(b.statusOptions,e=>(r(),p(v,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),d("div",P,[a[8]||(a[8]=c(" 检修编号： ",-1)),n(D,{style:{width:"150px"},placeholder:"请输入检修编号",modelValue:b.searchParams.bh,"onUpdate:modelValue":a[3]||(a[3]=e=>b.searchParams.bh=e),onKeydown:f(y.loadTableData,["enter"]),title:b.searchParams.bh,clearable:""},null,8,["modelValue","onKeydown","title"])]),d("div",R,[n(D,{placeholder:"请输入关键字",modelValue:b.searchParams.keyword,"onUpdate:modelValue":a[4]||(a[4]=e=>b.searchParams.keyword=e),onKeydown:f(y.loadTableData,["enter"]),title:b.searchParams.keyword,clearable:""},null,8,["modelValue","onKeydown","title"])]),d("div",S,[(r(!0),o(m,null,h(y.defaultLeftButtons,(t,a)=>(r(),p(T,{type:t.type,plain:t.plain,key:a+"defaultLeftButtons",onClick:a=>e.btnClick(t)},{default:u(()=>[c(g(t.name),1)]),_:2},1032,["type","plain","onClick"]))),128))]),d("div",j,[n(H,null,{dropdown:u(()=>[n(Y,null,{default:u(()=>[n(A,{onClick:y.doExport},{default:u(()=>[...a[10]||(a[10]=[c("导出当前页",-1)])]),_:1},8,["onClick"]),n(A,{onClick:a[5]||(a[5]=e=>y.doExport(!0))},{default:u(()=>[...a[11]||(a[11]=[c("导出全部",-1)])]),_:1})]),_:1})]),default:u(()=>[n(T,{type:"gradientGreen"},{default:u(()=>[a[9]||(a[9]=c(" 导出",-1)),n(_,{class:"el-icon--right"},{default:u(()=>[n(E)]),_:1})]),_:1})]),_:1})])]),d("section",null,[d("div",M,[(r(!0),o(m,null,h(y.defaultRightButtons,(t,a)=>(r(),p(T,{type:t.type,plain:t.plain,key:a+"defaultRightButtons",onClick:a=>e.btnClick(t)},{default:u(()=>[c(g(t.name),1)]),_:2},1032,["type","plain","onClick"]))),128))])])]),d("article",null,[n(I,w(y.gridOptions,{ref:"xTable",onMenuClick:a[6]||(a[6]=t=>e.menuClickEvent(t,"风险预警"))}),{action:u(({row:e})=>[n(V,{mode:"text",status:"primary",onClick:t=>y.doViewLog(e)},{default:u(()=>[...a[12]||(a[12]=[c("查看",-1)])]),_:1},8,["onClick"]),n(V,{mode:"text",status:"primary",onClick:t=>y.doSendMessage(e)},{default:u(()=>[...a[13]||(a[13]=[c("发送短信",-1)])]),_:1},8,["onClick"]),n(V,{mode:"text",status:"primary",onClick:t=>y.previewMethod(e)},{default:u(()=>[...a[14]||(a[14]=[c("预览",-1)])]),_:1},8,["onClick"]),n(V,{mode:"text",status:"primary",onClick:t=>y.downloadMethod(e)},{default:u(()=>[...a[15]||(a[15]=[c("下载",-1)])]),_:1},8,["onClick"])]),status:u(({row:e})=>[d("span",null,g(e.status?e.status:"未确认"),1)]),_:1},16)])])}],["__scopeId","data-v-ca0a40c7"]]))}}});
