import{_ as t,r as e,o as n,c as r,b as o,d as i,w as l,F as c,q as a,e as s,i as u,p as f}from"./index-DrZ2SOez.js";import"./polyfill-lGe4XDVY.js";function g(t){const e=[];return t.querySelectorAll("g.nari_current_container g#link-container path").forEach(t=>{const r=t.getAttribute("d"),o=t.getAttribute("style"),i=t.getAttribute("keyid"),l=function(t){const e={stroke:"black",strokeWidth:2},n="#F04D41",r={"rgb(247,2,2)":"black","rgb(107,131,248)":n,"rgb(0,128,183)":"#9E88E5","#fcff01":n};return t?(t.split(";").forEach(t=>{const[n,o]=t.split(":").map(t=>t?t.trim():"");if("stroke"===n){let t=o.toLowerCase().replace(/[\s;]/g,"");r[t]?e.stroke=r[t]:e.stroke=o}else if("stroke-width"===n){const t=parseFloat(o);isNaN(t)||(e.strokeWidth=t)}}),e):e}(o),c=function(t){const e=t.trim().split(/(?=[ML])/),n=[];return e.forEach(t=>{const e=t[0],r=t.slice(1).trim().split(/[\s,]+/).map(Number);"M"!==e&&"L"!==e||n.push(...r)}),n}(r);if(c.length>=4)for(let a=0;a<c.length-2;a+=2){const t=n(c[a],c[a+1],c[a+2],c[a+3],l,i);e.push(t)}}),e;function n(t,e,n,r,o,i){return{points:[t,e,n,r],stroke:o.stroke,strokeWidth:o.strokeWidth,keyId:i,draggable:!0,name:i}}}function d(t){const e=[];return t.querySelectorAll("g#node-container > text").forEach((t,r)=>{const o=parseFloat(t.getAttribute("x"))||0,i=parseFloat(t.getAttribute("y"))||0,l=parseFloat(t.getAttribute("width"))||0,c=parseFloat(t.getAttribute("height"))||0,a=t.getAttribute("style"),s=t.getAttribute("transform"),u=t.getAttribute("fill");let f=n(a,"fill")||u;const g=function(t){if(!t)return"";if(t.startsWith("#"))return t.toLowerCase();const e=t.toLowerCase().replace(/\s/g,"");if(e.startsWith("rgb(")||e.startsWith("rgba("))return e.split("(")[0]+"("+e.split("(")[1].split(")")[0].split(",").map(t=>parseInt(t)).join(",")+")";return e}(f);if("rgb(0,255,0)"===g)return;const d=n(a,"font-size")||t.getAttribute("font-size"),h=parseFloat(d)||12,p=function(t){if(!t)return 0;const e=/rotate\(([^)\s]+)/,n=t.match(e);return n?parseFloat(n[1]):0}(s),b=n(a,"text-anchor");let k="",y=h;const m=t.querySelectorAll("tspan");if(m.length>0){const t=[];let e=0;m.forEach((n,r)=>{t.push(n.textContent.trim());const o=parseFloat(n.getAttribute("dy"));0===r?e=o:!isNaN(o)&&o>0&&o!==e&&(y=o)}),k=t.join("\n")}else k=t.textContent.trim();let w=f||"black",x=!1;"rgb(255,191,0)"===g?(w="black",x=!0):"rgb(255,204,0)"===g?w="black":"rgb(255,255,51)"===g||"#ffff33"===g?w="#FF3333":"rgb(255,255,255)"!==g&&"#ffffff"!==g&&"white"!==g||(w="black");const A=function(t,e,n,r,o,i,l,c,a,s,u){const f=parseFloat(o)||12,g=c?5:0,d=c?2:0;let h={x:0,y:0,text:n,fontSize:f,fill:r||"black",lineHeight:a/f,align:"middle"===l?"center":"end"===l?"right":"left",draggable:!0,type:"text"},p=0,b=0;"middle"===l?(p=s/2+g,b=-(s/2+g)):"end"===l?(p=s+g,b=-(s+g)):(p=g,b=-g);const k=.4*f,y=k+g;h.offsetY=k;const m={x:t,y:e,rotation:i,offsetX:p,offsetY:y,listening:!0,name:"selectable-shape",draggable:!0,children:[]};if(c){const t={x:b,y:-(k+g),width:s+10,height:u+10,fill:"white",stroke:"#87CEEB",strokeWidth:d,listening:!1,type:"rect"};m.children.push(t)}return m.children.push(h),m}(o,i,k,w,d,p,b,x,y,l,c);e.push(A)}),e;function n(t,e){if(!t)return null;const n=new RegExp("".concat(e,"\\s*:\\s*([^;]+)"),"i"),r=t.match(n);return r&&r[1]?r[1].trim().toLowerCase().replace(/['"]/g,""):null}}const h=t({name:"Konva",computed:{stageSize:()=>({width:window.innerWidth,height:window.innerHeight-40,draggable:!0,fill:"black"})},data:()=>({lines:[],nodes:[],texts:[],backgroundColor:""}),methods:{doImport(t){const e=t.target.files[0];if(!e)return;const n=new FileReader;let r=this;n.onload=function(t){const e=(new DOMParser).parseFromString(t.target.result,"image/svg+xml");console.log(e),r.lines=g(e),r.nodes=function(t){let e=[];const n=t.querySelectorAll('g#node-container > svg[nodeType="TransStation"], g#node-container > svg[nodeType="PowerStation"]'),r=["#powerPlant_220KV","#powerPlant_500KV"];return n.forEach((t,n)=>{const o=t.getAttribute("nodeType"),i=parseFloat(t.getAttribute("x"))||0,l=parseFloat(t.getAttribute("y"))||0,c=parseFloat(t.getAttribute("width"))||0,a=parseFloat(t.getAttribute("height"))||0;t.getAttribute("keyid")||"node-".concat(Date.now(),"-").concat(n);let s=null,u=i,f=l;if("TransStation"===o&&t.querySelector("g.lowbus")){u=i+c/2,f=l+a/2;const t=.7*Math.min(c,a)/2;s=function(t,e,n,r){const o={x:t,y:e,name:"TransStationNode",children:[]},i={x:0,y:0,radius:r,fill:"white",stroke:"black",strokeWidth:1,name:"outer-circle",type:"circle"};o.children.push(i);const l={x:0,y:0,radius:n,fill:"black",strokeWidth:0,name:"inner-circle",type:"circle"};return o.children.push(l),o}(u,f,.6*t,t)}else{if("PowerStation"!==o)return;{const e=t.querySelector("use"),n=e?e.getAttribute("xlink:href"):null;if(!r.includes(n))return;u=i,f=l,s=function(t,e,n){const r={x:t,y:e,width:n,height:n,name:"PowerStationWaveIcon",children:[]},o={x:0,y:0,width:n,height:n,fill:"white",stroke:"black",strokeWidth:2,name:"outer-rect",type:"rect"};r.children.push(o);const i=.15*n,l=i,c=n-i,a=n/2,s=.3*n,u=(l+c)/2,f=.1*(c-l),g={data:["M ".concat(l,",").concat(a),"C ".concat(l+f,",").concat(a-s),"".concat(u-f,",").concat(a-s),"".concat(u,",").concat(a),"C ".concat(u+f,",").concat(a+s),"".concat(c-f,",").concat(a+s),"".concat(c,",").concat(a)].join(" "),stroke:"black",strokeWidth:2,fill:null,lineCap:"round",lineJoin:"round",name:"wave-path",type:"path"};return r.children.push(g),r}(u,f,Math.min(c,a))}}s&&e.push(s)}),e}(e),r.texts=d(e),console.log(r.texts)},n.readAsText(e)}}},[["render",function(t,g,d,h,p,b){const k=e("v-line"),y=e("v-circle"),m=e("v-path"),w=e("v-rect"),x=e("v-group"),A=e("v-text"),F=e("v-layer"),v=e("v-stage");return n(),r("div",{class:"page_content",id:"konva",style:f({backgroundColor:p.backgroundColor})},[o("header",null,[o("input",{type:"file",id:"upload",onChange:g[0]||(g[0]=t=>b.doImport(t)),ref:"uploadFile"},null,544)]),o("article",null,[i(v,{config:b.stageSize,ref:"stageRef"},{default:l(()=>[i(F,null,{default:l(()=>[(n(!0),r(c,null,a(p.lines,(t,e)=>(n(),s(k,{key:"lines"+e,config:t},null,8,["config"]))),128)),(n(!0),r(c,null,a(p.nodes,(t,e)=>(n(),s(x,{key:"nodes"+e,config:t},{default:l(()=>[(n(!0),r(c,null,a(t.children,(t,o)=>(n(),r(c,{key:"nodes"+e+"children"+o},["circle"===t.type?(n(),s(y,{key:0,config:t},null,8,["config"])):u("",!0),"path"===t.type?(n(),s(m,{key:1,config:t},null,8,["config"])):u("",!0),"rect"===t.type?(n(),s(w,{key:2,config:t},null,8,["config"])):u("",!0)],64))),128))]),_:2},1032,["config"]))),128)),(n(!0),r(c,null,a(p.texts,(t,e)=>(n(),s(x,{key:"texts"+e,config:t},{default:l(()=>[(n(!0),r(c,null,a(t.children,(t,o)=>(n(),r(c,{key:"texts"+e+"children"+o},["text"===t.type?(n(),s(A,{key:0,config:t},null,8,["config"])):u("",!0),"rect"===t.type?(n(),s(w,{key:1,config:t},null,8,["config"])):u("",!0)],64))),128))]),_:2},1032,["config"]))),128))]),_:1})]),_:1},8,["config"])])],4)}],["__scopeId","data-v-5ca7746e"]]);export{h as default};
