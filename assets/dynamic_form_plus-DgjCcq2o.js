import{Z as e,a as l,z as t,c as d}from"./zcq-sb-dky-Jq3RMDln.js";import{_ as i,am as o,r,o as a,c as s,b as m,d as n,w as p,F as u,q as h,n as f,p as c,t as b,e as y,i as F,h as R,y as V,D as w,L as v}from"./index-DrZ2SOez.js";import{v as k}from"./view_file-DvYOS2im.js";const g={name:"dynamic_form_plus",components:{Edit:o},props:{validateRules:Array,row:Object,tableHeaderList:Array,labelWidth:{type:String,default:"auto"},showFooter:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},footerButtonList:{type:Array,default:[{type:"gradientDarkGreen",name:"刷新"},{type:"gradientBlue",name:"保存"}]}},data:()=>({ruleForm:{},formItems:[],originData:{}}),computed:{moreConfig:()=>({maxCount:1,layout:"horizontal"})},created(){this.originData=JSON.parse(JSON.stringify(this.row)),console.log("行数据",this.row),this.formItems=this.tableHeaderList.filter(e=>!("radio"==e.type||"checkbox"==e.type||"expand"==e.type||"seq"==e.type)),console.log("表单字段",this.formItems);let e={};for(let t=0;t<this.formItems[t].children;t++){this.formItems[t].field&&(e[this.formItems[t].field]="");for(const{field:l}of this.formItems[t].children)e[l]=""}for(var l in this.ruleForm=Object.assign({},e),this.row)this.ruleForm[l]=this.row[l]},methods:{refreshData(){this.ruleForm=JSON.parse(JSON.stringify(this.originData))},selectBtn(e){switch(e.editRender.props.type){case"tdcs":this.selectCs(e);break;case"tdsb":this.selectSb(e)}},btnClick(e){switch(e.name){case"刷新":this.refreshData();break;case"保存":this.doSubmit();break;case"打印":this.doPrint();break;case"取消":this.$emit("close");break;default:this.$emit("doOperate",{data:this.ruleForm,btn:e})}},selectCs(e){this.$vxeModal.show(d,{omsDefaultNode:this.$store.state.omsDefaultNode,d5000DefaultNode:this.$store.state.d5000DefaultNode,showOMS:!1},{width:600,height:188,title:"选择停电厂站类型"},{refreshCZXX:l=>{this.ruleForm[e.field]=l.CZMC,this.ruleForm[e.field+"Id"]=l.CZID,this.ruleForm[e.field+"lx"]=l.tdcslx,this.ruleForm[e.field+"Param"]=l,this.ruleForm[e.field+"Param0"]=l}})},selectSb(d){if(!this.ruleForm.tdcslx)return void this.$message({message:"停电场所类型为空，请先选择停电场所",type:"warning"});if(!this.ruleForm.tdcsParam)return void this.$message({message:"当前为非对象化场所，请重选场所后再选择停电设备",type:"warning"});let i={id:this.ruleForm.id,tdcsParam:this.ruleForm.tdcsParam,bdlx:"rjh-dd"};"D5000"==this.ruleForm.tdcslx?this.$vxeModal.show(e,{paramdata:i,sblist:this.ruleForm[d.field+"List"],isCommon:!0},{width:1e3,height:650,title:"设备选择-D5000"},{refreshSBXX:e=>{this.ruleForm[d.field+"List"]=e,this.ruleForm[d.field+"List0"]=e,this.ruleForm[d.field+"Id"]=e.map(e=>e.sbid).join(","),this.ruleForm[d.field]=e.map(e=>e.sbddmm).join(",")}}):"OMS"==this.ruleForm.tdcslx?this.$vxeModal.show(l,{paramdata:i,sblist:this.ruleForm[d.field+"List"],isCommon:!0},{width:1e3,height:650,title:"设备选择-OMS"},{refreshSBXX:e=>{this.ruleForm[d.field+"List"]=e,this.ruleForm[d.field+"List0"]=e,this.ruleForm[d.field+"Id"]=e.map(e=>e.sbid).join(","),this.ruleForm[d.field]=e.map(e=>e.sbddmm).join(",")}}):"DKY"==this.ruleForm.tdcslx&&this.$vxeModal.show(t,{paramdata:i,sblist:this.ruleForm[d.field+"List"],isCommon:!0},{width:1e3,height:650,title:"设备选择-DKY"},{refreshSBXX:e=>{this.ruleForm[d.field+"List"]=e,this.ruleForm[d.field+"List0"]=e,this.ruleForm[d.field+"Id"]=e.map(e=>e.sbid).join(","),this.ruleForm[d.field]=e.map(e=>e.sbddmm).join(",")}})},doSubmit(){console.log(this.ruleForm),this.$refs.ruleForm.validate(e=>{if(!e)return console.log("error submit!!"),!1;this.$emit("doSubmit",this.ruleForm)})},uploadMethod({file:e},l){const t=new FormData;return t.append("file",e),t.append("id",this.ruleForm.id),t.append("type",l.editRender.props.type),w.uploadFileService(t).then(e=>e.data)},downloadMethod({option:e}){w.downloadFileGetService({fileId:e.id})},removeMethod({option:e}){e.id&&w.removeFileService({fileId:e.id,id:this.ruleForm.id}).then(()=>{this.$message.success("移除成功")})},previewMethod({option:e}){this.$store.state.isXzs?w.preViewFileGetService({fileId:e.id}):w.preViewFileService({fileId:e.id}).then(e=>{let l=v(e,"pdf")+"#toolbar=0";this.$vxeModal.show(k,{url:l},{width:800,title:"文件预览",height:window.innerHeight-20},{})})},getData(e){this.ruleForm[e.field]=this.$store.state.userInfo.sysUser.nickName,this.ruleForm[e.editRender.associateField]=V().format("YYYY-MM-DD HH:mm:ss")}}},x={id:"dynamic_form_plus",class:"page_content"},U={class:"form_item_merge_label_span"},I={key:9},_={key:9},C={key:0};const S=i(g,[["render",function(e,l,t,d,i,o){const V=r("Edit"),w=r("el-icon"),v=r("el-input"),k=r("el-input-number"),g=r("el-date-picker"),S=r("el-option"),D=r("el-select"),M=r("el-radio"),$=r("el-radio-group"),L=r("vxe-upload"),E=r("el-form-item"),j=r("el-button"),z=r("el-form");return a(),s("div",x,[m("article",null,[n(z,{model:i.ruleForm,rules:t.validateRules,ref:"ruleForm","label-width":t.labelWidth,disabled:t.disabled},{default:p(()=>[(a(!0),s(u,null,h(i.formItems,(e,t)=>(a(),s(u,null,[e.children&&e.children.length>0?(a(),s("div",{key:"formItems"+t,class:f(["parent_div",e.itemClass])},[m("div",{class:"form_item_merge_label",style:c(e.width?{width:e.width}:{})},[m("span",U,b(e.title),1)],4),(a(!0),s(u,null,h(e.children,(l,d)=>(a(),y(E,{key:"formItems"+t+"children"+d,label:l.title,prop:l.field,class:f(l.itemClass),style:c([l.width?{width:l.width}:{width:"100%"},{position:"relative"}])},{default:p(()=>[l.editRender&&l.editRender.icons?(a(),y(w,{key:0,size:16,style:{position:"absolute",right:"0",top:"0","z-index":"100",cursor:"pointer"},color:"#0cb088"},{default:p(()=>[l.editRender.icons.includes("edit")?(a(),y(V,{key:0,onClick:e=>o.getData(l)},null,8,["onClick"])):F("",!0)]),_:2},1024)):F("",!0),"ElInput"!=l.editRender.name||l.editRender.props.type&&"text"!=l.editRender.props.type?F("",!0):(a(),y(v,{key:1,modelValue:i.ruleForm[l.field],"onUpdate:modelValue":e=>i.ruleForm[l.field]=e,type:"text",disabled:l.disabled,clearable:l.editRender.props.clearable},null,8,["modelValue","onUpdate:modelValue","disabled","clearable"])),"ElInput"==l.editRender.name&&"number"==l.editRender.props.type?(a(),y(v,{key:2,modelValue:i.ruleForm[l.field],"onUpdate:modelValue":e=>i.ruleForm[l.field]=e,type:"number",min:l.editRender.props.min,max:l.editRender.props.max,disabled:l.disabled,step:l.editRender.props.step,clearable:l.editRender.props.clearable},null,8,["modelValue","onUpdate:modelValue","min","max","disabled","step","clearable"])):F("",!0),"ElInputNumber"==l.editRender.name?(a(),y(k,{key:3,modelValue:i.ruleForm[l.field],"onUpdate:modelValue":e=>i.ruleForm[l.field]=e,min:l.editRender.props.min,max:l.editRender.props.max,disabled:l.disabled,step:l.editRender.props.step,"controls-position":"right"},null,8,["modelValue","onUpdate:modelValue","min","max","disabled","step"])):F("",!0),l.editRender&&"ElInput"==l.editRender.name&&"textarea"==l.editRender.props.type?(a(),y(v,{key:4,modelValue:i.ruleForm[l.field],"onUpdate:modelValue":e=>i.ruleForm[l.field]=e,type:"textarea",clearable:l.editRender.props.clearable,disabled:l.disabled,rows:6},null,8,["modelValue","onUpdate:modelValue","clearable","disabled"])):F("",!0),"ElDatePicker"==l.editRender.name&&["year","month","date","datetime"].includes(l.editRender.props.type)?(a(),y(g,{key:5,modelValue:i.ruleForm[l.field],"onUpdate:modelValue":e=>i.ruleForm[l.field]=e,type:l.editRender.props.type,"value-format":l.editRender.props.valueFormat,disabled:l.disabled,"label-format":l.editRender.props.labelFormat},null,8,["modelValue","onUpdate:modelValue","type","value-format","disabled","label-format"])):F("",!0),"ElSelect"==l.editRender.name?(a(),y(D,{key:6,modelValue:i.ruleForm[l.field],"onUpdate:modelValue":e=>i.ruleForm[l.field]=e,clearable:l.editRender.props.clearable,filterable:l.editRender.props.filterable,multiple:l.editRender.props.multiple,disabled:l.disabled},{default:p(()=>[l.editRender.options&&l.editRender.options.length>0?(a(!0),s(u,{key:0},h(l.editRender.options,(l,i)=>(a(),y(S,{key:"formItems"+t+"children"+d+e.field+i,value:l.value,label:l.label},null,8,["value","label"]))),128)):F("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue","clearable","filterable","multiple","disabled"])):F("",!0),"$radio"==l.editRender.name?(a(),y($,{key:7,modelValue:i.ruleForm[l.field],"onUpdate:modelValue":e=>i.ruleForm[l.field]=e,disabled:l.disabled},{default:p(()=>[l.editRender.options&&l.editRender.options.length>0?(a(!0),s(u,{key:0},h(l.editRender.options,(l,d)=>(a(),y(M,{key:"radio"+t+e.field+d,value:l.value},{default:p(()=>[R(b(l.label),1)]),_:2},1032,["value"]))),128)):F("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue","disabled"])):F("",!0),"vxeUpload"==l.editRender.name?(a(),y(L,{key:8,modelValue:i.ruleForm[l.field],"onUpdate:modelValue":e=>i.ruleForm[l.field]=e,disabled:l.disabled,multiple:l.editRender.props.multiple,"file-types":l.editRender.props.types,"more-config":o.moreConfig,"show-tip":!1,"show-download-button":"","button-text":"上传","limit-size":l.editRender.props.limitSize,"upload-method":e=>o.uploadMethod(e,l),"download-method":o.downloadMethod,"remove-method":o.removeMethod,"preview-method":o.previewMethod},null,8,["modelValue","onUpdate:modelValue","disabled","multiple","file-types","more-config","limit-size","upload-method","download-method","remove-method","preview-method"])):F("",!0),l.editRender.name?F("",!0):(a(),s("p",I,b(i.ruleForm[l.field]),1))]),_:2},1032,["label","prop","class","style"]))),128))],2)):(a(),y(E,{key:"formItems"+t,label:e.title,prop:e.field,class:f(e.itemClass),style:c(e.width?{width:e.width}:{width:"100%"})},{default:p(()=>["ElInput"!=e.editRender.name||e.editRender.props.type&&"text"!=e.editRender.props.type?F("",!0):(a(),y(v,{key:0,modelValue:i.ruleForm[e.field],"onUpdate:modelValue":l=>i.ruleForm[e.field]=l,type:"text",clearable:e.editRender.props.clearable},null,8,["modelValue","onUpdate:modelValue","clearable"])),"ElInput"==e.editRender.name&&"number"==e.editRender.props.type?(a(),y(v,{key:1,modelValue:i.ruleForm[e.field],"onUpdate:modelValue":l=>i.ruleForm[e.field]=l,type:"number",min:e.editRender.props.min,max:e.editRender.props.max,step:e.editRender.props.step,clearable:e.editRender.props.clearable},null,8,["modelValue","onUpdate:modelValue","min","max","step","clearable"])):F("",!0),"ElInputNumber"==e.editRender.name?(a(),y(k,{key:2,modelValue:i.ruleForm[e.field],"onUpdate:modelValue":l=>i.ruleForm[e.field]=l,min:e.editRender.props.min,max:e.editRender.props.max,step:e.editRender.props.step,"controls-position":"right"},null,8,["modelValue","onUpdate:modelValue","min","max","step"])):F("",!0),e.editRender&&"ElInput"==e.editRender.name&&"textarea"==e.editRender.props.type?(a(),y(v,{key:3,modelValue:i.ruleForm[e.field],"onUpdate:modelValue":l=>i.ruleForm[e.field]=l,type:"textarea",clearable:e.editRender.props.clearable,rows:6},null,8,["modelValue","onUpdate:modelValue","clearable"])):F("",!0),e.editRender&&"$modal"==e.editRender.name?(a(),s(u,{key:4},[n(v,{modelValue:i.ruleForm[e.field],"onUpdate:modelValue":l=>i.ruleForm[e.field]=l,readonly:"",style:{width:"calc(100% - 78px)","margin-right":"10px"},title:i.ruleForm[e.field]},null,8,["modelValue","onUpdate:modelValue","title"]),n(j,{onClick:l=>o.selectBtn(e),type:"primary",style:{"margin-right":"8px"}},{default:p(()=>[...l[1]||(l[1]=[R("选择 ",-1)])]),_:1},8,["onClick"])],64)):F("",!0),"ElDatePicker"==e.editRender.name&&["year","month","date","datetime"].includes(e.editRender.props.type)?(a(),y(g,{key:5,modelValue:i.ruleForm[e.field],"onUpdate:modelValue":l=>i.ruleForm[e.field]=l,type:e.editRender.props.type,"value-format":e.editRender.props.valueFormat,"label-format":e.editRender.props.labelFormat},null,8,["modelValue","onUpdate:modelValue","type","value-format","label-format"])):F("",!0),"ElSelect"==e.editRender.name?(a(),y(D,{key:6,modelValue:i.ruleForm[e.field],"onUpdate:modelValue":l=>i.ruleForm[e.field]=l,clearable:e.editRender.props.clearable,filterable:e.editRender.props.filterable,multiple:e.editRender.props.multiple},{default:p(()=>[e.editRender.options&&e.editRender.options.length>0?(a(!0),s(u,{key:0},h(e.editRender.options,(l,d)=>(a(),y(S,{key:"formItems"+t+e.field+d,value:l.value,label:l.label},null,8,["value","label"]))),128)):F("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue","clearable","filterable","multiple"])):F("",!0),"$radio"==e.editRender.name?(a(),y($,{key:7,modelValue:i.ruleForm[e.field],"onUpdate:modelValue":l=>i.ruleForm[e.field]=l},{default:p(()=>[e.editRender.options&&e.editRender.options.length>0?(a(!0),s(u,{key:0},h(e.editRender.options,(l,d)=>(a(),y(M,{key:"radio"+t+e.field+d,value:l.value},{default:p(()=>[R(b(l.label),1)]),_:2},1032,["value"]))),128)):F("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue"])):F("",!0),"vxeUpload"==e.editRender.name?(a(),y(L,{key:8,modelValue:i.ruleForm[e.field],"onUpdate:modelValue":l=>i.ruleForm[e.field]=l,multiple:e.editRender.props.multiple,"file-types":e.editRender.props.types,"more-config":o.moreConfig,"show-tip":!1,"show-download-button":"","button-text":"上传","limit-size":e.editRender.props.limitSize,"upload-method":l=>o.uploadMethod(l,e),"download-method":o.downloadMethod,"remove-method":o.removeMethod},null,8,["modelValue","onUpdate:modelValue","multiple","file-types","more-config","limit-size","upload-method","download-method","remove-method"])):F("",!0),e.editRender.name?F("",!0):(a(),s("p",_,b(i.ruleForm[e.field]),1))]),_:2},1032,["label","prop","class","style"]))],64))),256))]),_:1},8,["model","rules","label-width","disabled"])]),t.showFooter?(a(),s("footer",C,[n(j,{type:"gradientGray",onClick:l[0]||(l[0]=l=>e.$emit("close"))},{default:p(()=>[...l[2]||(l[2]=[R("取消",-1)])]),_:1}),(a(!0),s(u,null,h(t.footerButtonList,(e,l)=>(a(),y(j,{key:"footerButtonList"+l,type:e.type,onClick:l=>o.btnClick(e)},{default:p(()=>[R(b(e.name),1)]),_:2},1032,["type","onClick"]))),128))])):F("",!0)])}],["__scopeId","data-v-50cbf25c"]]);export{S as d};
