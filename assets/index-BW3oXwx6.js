import{t as e}from"./table_mixin-Bm7KLuSQ.js";import{U as t}from"./UploadHttpComponent-nVBlbYdp.js";import{b as a,r as l,o as i,c as s,F as r,v as o,d,t as n,e as c,w as m,i as p,N as h,f as u,j as b,x as f,z as g,E as y,O as x}from"./index-0nalUVid.js";import{x as w}from"./xwb-api-CSKrWb7V.js";import{v as z}from"./view_simple_table-BcKhqzJA.js";import{d as v}from"./dynamic_form-NBAtoJIc.js";import{v as k}from"./validateRules-33HAVMqP.js";import"./polyfill-lGe4XDVY.js";import"./view_file-nia3YLJy.js";import"./zcq-sb-dky-DEUWHwSD.js";const C={class:"DataTextComponent"},R={class:"span_label"};const O={class:"page_content"},j={class:"header-item"},S={class:"header-item"},q={class:"header-item"},D={class:"header-item"},A={class:"header-item"},T={class:"header-item"},_={class:"header-item"},P={class:"header-item"};const Y=a({name:"xwb",components:{DataTextComponent:a({name:"DataTextComponent",props:{textArr:Array}},[["render",function(e,t,a,h,u,b){const f=l("el-text");return i(),s("div",C,[(i(!0),s(r,null,o(a.textArr,e=>(i(),s("span",null,[d("span",R,n(e.name)+"：",1),c(f,{tag:"b",type:"primary"},{default:m(()=>[p(n(e.value),1)]),_:2},1024)]))),256))])}],["__scopeId","data-v-d0b4796a"]]),QuestionFilled:h,UploadHttpComponent:t},mixins:[e],data:()=>({time:["",""],total:0,searchParams:{bdzmcList:[],sfcyqs:!1,year:g().format("YYYY"),sortOrder:"",sortColumn:"",bz:""},textArr:[],tableData:[],isAutoWrap:!1,bdzOptions:[],bdzRealOptions:[],llkgOptions:[],editRow:{}}),watch:{"searchParams.sfcyqs":{handler(){this.loadTableData()},immediate:!1}},computed:{tableHeaderList(){return[{type:"checkbox",width:50,fixed:"left"},{type:"seq",width:60,fixed:"left"},{field:"bdzmc",title:"变电站名称",width:120,editRender:{name:"ElSelect",options:this.bdzRealOptions,props:{filterable:!0}}},{field:"bdzdydj",title:"变电站电压等级（kV）",width:120,sortable:!0,editRender:{name:"ElSelect",options:this.$store.state.staticOptionsObj.bdzdydj,props:{clearable:!0}}},{field:"llkg",title:"拉路开关",minWidth:200,filters:[{data:""}],filterRender:{name:"VxeInput"},slots:{edit:"llkg"},editRender:{}},{field:"kgdydj",title:"开关电压等级（kV）",width:120,sortable:!0,editRender:{name:"ElSelect",options:this.$store.state.staticOptionsObj.bdzdydj,props:{clearable:!0}}},{field:"fh",title:"负荷（万千瓦）",width:120,sortable:!0,headerAlign:"center",align:"right",formatter:["formatterNumber",2],titleSuffix:{content:"将当前负荷值与去年同期最大负荷值进行比较，取二者中的较大值作为更新后的基准负荷值"},editRender:{name:"ElInput",props:{type:"number",min:0,step:1}}},{field:"ygFhz",title:"有功负荷值（万千瓦）",width:130,sortable:!0,headerAlign:"center",align:"right",formatter:["formatterNumber",2],titleSuffix:{content:"去年D5000最大采样值"}},{field:"ssdwfq",title:"所属电网分区",width:140,editRender:{name:"ElSelect",options:this.$store.state.selectOptionsObj.fq,props:{clearable:!0}},filters:this.$store.state.selectOptionsObj.fq},{field:"zyfh",title:"主要负荷【用户名称】",minWidth:180,editRender:{name:"ElInput",props:{clearable:!0}},filters:[{data:""}],filterRender:{name:"VxeInput"}},{field:"ssxzqy",title:"所属行政区域",width:120,editRender:{name:"ElSelect",options:this.$store.state.selectOptionsObj.xzqy,props:{clearable:!0}},filters:this.$store.state.selectOptionsObj.xzqy},{field:"sz220bdz",title:"所在220千伏变电站",width:120,editRender:{name:"ElInput",props:{clearable:!0}}},{field:"fhxz",title:"负荷性质",width:130,editRender:{name:"ElInput",props:{clearable:!0}}},{field:"fd",title:"分档",width:110,editRender:{name:"ElInput",props:{clearable:!0}}},{field:"bz",title:"备注",width:110,editRender:{name:"ElSelect",options:this.$store.state.staticOptionsObj.bz,props:{clearable:!0}}},{title:"日志",width:100,fixed:"right",slots:{default:"action"}}]},editRules:()=>({bdzmc:[{required:!0,message:"变电站名称不能为空"}],bdzdydj:[{required:!0,message:"变电站电压等级不能为空"}],llkg:[{required:!0,message:"拉路开关不能为空"}],kgdydj:[{required:!0,message:"开关电压等级不能为空"}],fh:[{required:!0,message:"负荷不能为空"}],ssdwfq:[{required:!0,message:"所属电网分区不能为空"}],zyfh:[{required:!0,message:"主要负荷不能为空"}],ssxzqy:[{required:!0,message:"所属行政区域不能为空"}]}),gridOptions(){return{height:"auto",border:!0,round:!0,stripe:!0,headerAlign:"center",align:"center",loading:!1,keepSource:!0,rowConfig:{isCurrent:!0,isHover:!0},radioConfig:{highlight:!0},checkboxConfig:{highlight:!0},columnConfig:{resizable:!0},sortConfig:{remote:!0},filterConfig:{remote:!0},showOverflow:this.isAutoWrap,headerCellClassName:"row-class",pagerConfig:{...this.pagerConfig,pageSize:100,pageSizes:[20,50,100,200,300,500]},editConfig:{trigger:"click",mode:"cell",showStatus:!0,showIcon:!0,beforeEditMethod:this.beforeEditMethod},proxyConfig:{seq:!0,showResponseMsg:!1,showActionMsg:!1,sort:!0,filter:!0,ajax:{query:({page:e,sorts:t,filters:a})=>this.loadTableApi(e,t,a),queryAll:({sorts:e,filters:t})=>this.loadTableApi({pageSize:1e5,currentPage:1},e,t),querySuccess:()=>{this.loadData()},delete:({body:e})=>this.doDeleteApi(e.removeRecords),save:({body:e})=>this.doSaveApi(e)}},exportConfig:{filename:"序位表",sheetName:"sheet1",type:"xlsx",mode:"all",modes:["current","selected","all"],message:!1,columns:this.tableHeaderList.filter(e=>"checkbox"!==e.type),exportMethod:this.exportMethod,afterExportMethod:this.afterExportMethod},menuConfig:{body:{options:[[{code:"collect",name:"标记重点"}]]}},cellClassName:({row:e})=>e.ygFhz||0===e.ygFhz?"增补"===e.bz?"row-blue":"剔除"===e.bz?"row-orangered":null:"row-red",editRules:this.editRules,columns:this.tableHeaderList,spanMethod({row:e,rowIndex:t,column:a,visibleData:l}){const i=e.bdzmc;if(i&&["bdzmc","bdzdydj"].includes(a.field)){const e=l[t-1];let a=l[t+1];if(e&&e.bdzmc===i)return{rowspan:0,colspan:0};{let e=1;for(;a&&a.bdzmc===i;)a=l[++e+t];if(e>1)return{rowspan:e,colspan:1}}}}}},defaultLeftButtons:()=>[{type:"gradientGreen",name:"查询"},{type:"gradientDarkGreen",name:"重置"}],defaultRightButtons:()=>[{type:"gradientBlue",name:"下载导入模版"},{type:"gradientBlue",name:"新增"},{type:"gradientBlue",name:"生成"},{type:"gradientBlue",name:"保存"},{type:"gradientRed",name:"删除"}]},created(){this.queryBdz()},mounted(){},methods:{queryBdz(){w.getD5000BdzService({bdzmc:""}).then(e=>{this.bdzOptions=e.data,this.bdzRealOptions=this.bdzOptions.map(e=>({label:e.bdzmc,value:e.bdzmc}))})},loadData(){w.loadDataService(this.searchParams.year).then(e=>{this.textArr=e.data})},reloadTableData(){this.$refs.xTable.commitProxy("query")},loadTableData(){this.$refs.xTable.commitProxy("reload")},loadTableApi(e,t,a){let l=this.getRealParams(this.searchParams,e,t,a);return new Promise(t=>{w.loadTableDataService(l).then(a=>{1e5==e.pageSize?(this.total=a.total,t(a.data)):(this.total=a.total,t({result:a.data,page:{total:a.total}}))})})},toggleWrap(){this.isAutoWrap?this.isAutoWrap=!1:this.isAutoWrap="tooltip"},doAdd(){this.textArr.length>2&&this.textArr[2].value>this.textArr[0].value&&x.alert("".concat(this.textArr[2].name,"大于").concat(this.textArr[0].name));this.$refs.xTable.insertAt({}).then(e=>{this.$refs.xTable.setEditRow(e)})},doSave(){const e=this.getUpdateRecords();e&&e.length>0&&this.$refs.xTable.commitProxy("save")},doSaveApi(e){return new Promise((t,a)=>{let{insertRecords:l,updateRecords:i}=e,s=[...l,...i];w.saveTableDataService({data:s}).then(e=>{this.$message.success(e.data),t()}).catch(()=>{a()})})},doDelete(){const e=this.getCheckboxRecords();e&&e.length>0&&this.$confirm("确认删除勾选的".concat(e.length,"条数据吗？"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.$refs.xTable.commitProxy("delete")})},doDeleteApi(e){return new Promise((t,a)=>{let l=e.map(e=>e.id).join(",");w.doDelTableDataService({ids:l}).then(e=>{this.$message.success(e.data),t()}).catch(()=>{a()})})},doSync(){w.doSyncDataService({}).then(e=>{this.$message.success(e.data),this.loadTableData()})},downloadModule(){y.exportFileService("/xwb/download-xwb-tpl",{})},doExport(e){y.exportFileService("/xwb/exportXwb",this.searchParams,e,this.pagerParam)},resetParams(){this.searchParams={bdzmcList:[],sfcyqs:!1,year:g().format("YYYY"),sortOrder:"",sortColumn:"",bz:""},this.$nextTick(function(){this.loadTableData()})},beforeEditMethod:({row:e,column:t})=>!0,editClosed({row:e,column:t}){if("bdzmc"===t.field){let t=this.bdzOptions.filter(t=>t.bdzmc===e.bdzmc)[0];e.bdzdydj=t.bdzdydj,e.llkg="",e.kgdydj=""}if("llkg"===t.field){let t=this.llkgOptions.filter(t=>t.llkg===e.llkg)[0];e.kgdydj=t.kgdydj,e.ycb=t.ycb,e.ycy=t.ycy,e.fh=t.fh,e.ygFhz=t.ygFhz}},remoteMethod(e,t){t.bdzmc?w.getLlkgInfoService({bdzmc:t.bdzmc,llkg:e,saveYear:this.searchParams.year}).then(e=>{this.llkgOptions=e.data,t.llkgOptions=e.data.map(e=>({label:e.llkg,value:e.llkg}))}):this.$message.warning("变电站不存在，请重新选择变电站")},doSc(){this.$vxeModal.show(v,{tableHeaderList:[{field:"year",title:"参考年份",width:150,editRender:{name:"ElDatePicker",props:{type:"year",labelFormat:"YYYY",valueFormat:"YYYY"}}},{field:"inputNumber",title:"总负荷值（万千瓦）",minWidth:120,headerAlign:"center",align:"right",editRender:{name:"ElInput",props:{type:"number",min:0,step:1}}}],validateRules:{inputNumber:[{required:!0,message:"总负荷值（万千瓦）不能为空"},k.positive_number.rule],year:[{required:!0,message:"参考年份不能为空"}]},row:{year:"2025",inputNumber:0},footerButtonList:[{type:"gradientBlue",name:"保存"}]},{width:400,title:"选择参考年份和输入总负荷值（万千瓦）",height:270},{doSubmit:e=>{console.log(e),w.doScDataService({fhTotal:e.inputNumber,saveYear:this.searchParams.year,copyYear:e.year}).then(e=>{this.$message.success(e.data),this.loadTableData()})}})},doViewLog(e){w.loadViewDialogService({id:e.id}).then(e=>{this.$vxeModal.show(z,{tableHeaderList:[{type:"seq",width:60},{field:"czr",title:"操作人",width:"100"},{field:"time",title:"操作时间",width:"150"},{field:"nr",title:"内容"}],tableData:e.data},{width:800,title:"日志",height:600},{})})}}},[["render",function(e,t,a,h,g,y){const x=l("el-date-picker"),w=l("el-option"),z=l("el-select"),v=l("QuestionFilled"),k=l("el-icon"),C=l("el-tooltip"),R=l("el-switch"),Y=l("el-button"),E=l("arrow-down"),$=l("el-dropdown-item"),V=l("el-dropdown-menu"),L=l("el-dropdown"),B=l("upload-http-component"),M=l("vxe-button"),I=l("DataTextComponent"),F=l("vxe-grid");return i(),s("div",O,[d("header",null,[d("section",null,[d("div",j,[t[7]||(t[7]=p(" 年： ",-1)),c(x,{style:{width:"120px"},modelValue:g.searchParams.year,"onUpdate:modelValue":t[0]||(t[0]=e=>g.searchParams.year=e),type:"year",format:"YYYY","value-format":"YYYY"},null,8,["modelValue"])]),d("div",S,[t[8]||(t[8]=p(" 变电站名称： ",-1)),c(z,{modelValue:g.searchParams.bdzmcList,"onUpdate:modelValue":t[1]||(t[1]=e=>g.searchParams.bdzmcList=e),placeholder:"请选择",clearable:"",filterable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":"","tag-type":"",style:{width:"180px"}},{default:m(()=>[(i(!0),s(r,null,o(this.$store.state.selectOptionsObj.bdz,e=>(i(),u(w,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),d("div",q,[c(C,{effect:"dark",content:"筛选没有有功负荷值的开关"},{default:m(()=>[c(k,{size:16},{default:m(()=>[c(v)]),_:1})]),_:1}),t[9]||(t[9]=p(" 是否采样缺失： ",-1)),c(R,{modelValue:g.searchParams.sfcyqs,"onUpdate:modelValue":t[2]||(t[2]=e=>g.searchParams.sfcyqs=e),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])]),d("div",D,[t[10]||(t[10]=p(" 备注： ",-1)),c(z,{style:{width:"130px"},modelValue:g.searchParams.bz,"onUpdate:modelValue":t[3]||(t[3]=e=>g.searchParams.bz=e),placeholder:"请选择",clearable:""},{default:m(()=>[(i(!0),s(r,null,o(this.$store.state.staticOptionsObj.bz,e=>(i(),u(w,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),d("div",A,[(i(!0),s(r,null,o(y.defaultLeftButtons,(t,a)=>(i(),u(Y,{type:t.type,plain:t.plain,key:a+"defaultLeftButtons",onClick:a=>e.btnClick(t)},{default:m(()=>[p(n(t.name),1)]),_:2},1032,["type","plain","onClick"]))),128))]),d("div",T,[c(L,null,{dropdown:m(()=>[c(V,null,{default:m(()=>[c($,{onClick:y.doExport},{default:m(()=>[...t[12]||(t[12]=[p("导出当前页",-1)])]),_:1},8,["onClick"]),c($,{onClick:t[4]||(t[4]=e=>y.doExport(!0))},{default:m(()=>[...t[13]||(t[13]=[p("导出全部",-1)])]),_:1})]),_:1})]),default:m(()=>[c(Y,{type:"gradientGreen"},{default:m(()=>[t[11]||(t[11]=p(" 导出",-1)),c(k,{class:"el-icon--right"},{default:m(()=>[c(E)]),_:1})]),_:1})]),_:1})])]),d("section",null,[d("div",_,[c(B,{"prop-upload-url":"/xwb/import-xwb",onLoadTableData:t[5]||(t[5]=e=>y.loadTableData(!0))})]),d("div",P,[(i(!0),s(r,null,o(y.defaultRightButtons,(t,a)=>(i(),u(Y,{type:t.type,plain:t.plain,key:a+"defaultRightButtons",onClick:a=>e.btnClick(t)},{default:m(()=>[p(n(t.name),1)]),_:2},1032,["type","plain","onClick"]))),128))])])]),d("article",null,[c(F,f(y.gridOptions,{ref:"xTable",onMenuClick:t[6]||(t[6]=t=>e.menuClickEvent(t,"序位表")),onEditClosed:y.editClosed}),{action:m(({row:e})=>[e.id?(i(),u(M,{key:0,mode:"text",status:"primary",onClick:t=>y.doViewLog(e)},{default:m(()=>[...t[14]||(t[14]=[p("日志 ",-1)])]),_:1},8,["onClick"])):b("",!0)]),llkg:m(({row:e})=>[c(z,{modelValue:e.llkg,"onUpdate:modelValue":t=>e.llkg=t,filterable:"",remote:"","remote-method":t=>this.remoteMethod(t,e)},{default:m(()=>[(i(!0),s(r,null,o(e.llkgOptions,e=>(i(),u(w,{value:e.value,label:e.label},null,8,["value","label"]))),256))]),_:2},1032,["modelValue","onUpdate:modelValue","remote-method"])]),pagerLeft:m(()=>[c(I,{"text-arr":g.textArr},null,8,["text-arr"])]),_:1},16,["onEditClosed"])])])}],["__scopeId","data-v-4f7b31b5"]]);export{Y as default};
