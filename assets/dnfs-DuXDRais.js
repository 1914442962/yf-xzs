import{t as e}from"./table_mixin-BjqIVH_Q.js";import{_ as t,r as o,o as a,c as i,b as l,d as s,f as d,F as r,q as n,e as p,w as h,h as c,t as u,v as m,D as f,L as g,O as w}from"./index-CIzN2UtG.js";import{v as x}from"./view_file-CO9OLjy1.js";import{U as b}from"./UploadHttpComponent-Z9tjjzV3.js";import"./polyfill-lGe4XDVY.js";const v={class:"page_content"},y={class:"header-item"},C={class:"header-item"},k={class:"header-item"};const M=t({name:"dnfs",components:{UploadHttpComponent:b},mixins:[e],data:()=>({time:["",""],total:0,searchParams:{type:"dnfs",keyword:""},tableData:[],isAutoWrap:!1}),watch:{},computed:{tableHeaderList:()=>[{type:"checkbox",width:50},{type:"seq",width:60},{field:"fileName",title:"文件名"},{title:"操作",width:"150",slots:{default:"action"}}],gridOptions(){return{height:"auto",keepSource:!0,border:!0,round:!0,stripe:!0,headerAlign:"center",align:"center",loading:!1,rowConfig:{isCurrent:!0,isHover:!0},radioConfig:{highlight:!0},checkboxConfig:{highlight:!0},columnConfig:{resizable:!0},sortConfig:{remote:!0},filterConfig:{remote:!0},showOverflow:this.isAutoWrap,headerCellClassName:"row-class",pagerConfig:this.pagerConfig,proxyConfig:{seq:!0,showResponseMsg:!1,showActionMsg:!1,sort:!0,filter:!0,ajax:{query:({page:e,sorts:t,filters:o})=>this.loadTableApi(e,t,o),delete:({body:e})=>this.doDeleteApi(e.removeRecords),save:({body:e})=>this.doSaveApi(e)}},exportConfig:{filename:"运行方式模版管理表",sheetName:"sheet1",type:"xlsx",mode:"all",modes:["current","selected","all"],message:!1,columns:this.tableHeaderList.filter(e=>"checkbox"!==e.type),exportMethod:this.exportMethod,afterExportMethod:this.afterExportMethod},editConfig:{trigger:"click",mode:"cell",showStatus:!0,showIcon:!0,beforeEditMethod:this.beforeEditMethod},menuConfig:{body:{options:[[{code:"collect",name:"标记重点"}]]}},columns:this.tableHeaderList}},defaultLeftButtons:()=>[{type:"gradientGreen",name:"查询"}],defaultRightButtons:()=>[{type:"gradientBlue",name:"上传文件"}]},mounted(){},methods:{reloadTableData(){this.$refs.xTable.commitProxy("query")},loadTableData(){this.$refs.xTable.commitProxy("reload")},loadTableApi(e,t,o){let a=this.getRealParams(this.searchParams,e,t,o);return new Promise((t,o)=>{f.loadFileService(a).then(o=>{1e5==e.pageSize?(this.total=o.total,t(o.data)):(this.total=o.total,t({result:o.data,page:{total:o.total}}))})})},toggleWrap(){this.isAutoWrap?this.isAutoWrap=!1:this.isAutoWrap="tooltip"},async readFileEvent(){const e=[],{files:t}=await w.readFile({multiple:!0});t.forEach(t=>{e.push({id:this.rowKey++,name:t.name,size:t.size,file:t})}),this.gridOptions.data=e},uploadMethod({file:e}){const t=new FormData;t.append("file",e),t.append("id",""),t.append("type","dnfs"),f.uploadFileService(t).then(e=>{this.loadTableData()})},removeMethod(e){f.removeFileService({fileId:e.id}).then(()=>{this.$message.success("移除成功"),this.loadTableData()})},downloadMethod(e){f.downloadFileGetService({fileId:e.id})},previewMethod(e){this.$store.state.isXzs?f.preViewFileGetService({fileId:e.id}):f.preViewFileService({fileId:e.id}).then(e=>{let t=g(e,"pdf")+"#toolbar=0";this.$vxeModal.show(x,{url:t},{width:800,title:"文件预览",height:window.innerHeight-20},{})})}}},[["render",function(e,t,f,g,w,x){const b=o("el-input"),M=o("el-button"),A=o("vxe-upload"),F=o("vxe-button"),S=o("vxe-grid");return a(),i("div",v,[l("header",null,[l("section",null,[l("div",y,[s(b,{placeholder:"请输入文件名称",modelValue:w.searchParams.keyword,"onUpdate:modelValue":t[0]||(t[0]=e=>w.searchParams.keyword=e),onKeydown:d(x.loadTableData,["enter"]),title:w.searchParams.keyword,clearable:""},null,8,["modelValue","onKeydown","title"])]),l("div",C,[(a(!0),i(r,null,n(x.defaultLeftButtons,(t,o)=>(a(),p(M,{type:t.type,plain:t.plain,key:o+"defaultLeftButtons",onClick:o=>e.btnClick(t)},{default:h(()=>[c(u(t.name),1)]),_:2},1032,["type","plain","onClick"]))),128))])]),l("section",null,[l("div",k,[s(M,{type:"gradientBlue",onClick:t[1]||(t[1]=t=>e.$refs.uploadRef.choose())},{default:h(()=>[...t[3]||(t[3]=[c("上传",-1)])]),_:1}),s(A,{ref:"uploadRef",multiple:"","file-types":["doc","docx","xls","xlsx","ppt","pptx","pdf","dwg"],"button-text":"上传文件","show-list":!1,showUploadButton:!1,"upload-method":x.uploadMethod},null,8,["upload-method"])])])]),l("article",null,[s(S,m(x.gridOptions,{ref:"xTable",onMenuClick:t[2]||(t[2]=t=>e.menuClickEvent(t,"年度方式"))}),{action:h(({row:e})=>[s(F,{mode:"text",icon:"vxe-icon-search",status:"primary",onClick:t=>x.previewMethod(e)},null,8,["onClick"]),s(F,{mode:"text",status:"primary",icon:"vxe-icon-download",onClick:t=>x.downloadMethod(e)},null,8,["onClick"]),s(F,{mode:"text",status:"error",icon:"vxe-icon-delete",onClick:t=>x.removeMethod(e)},null,8,["onClick"])]),_:1},16)])])}],["__scopeId","data-v-e7b4fd30"]]);export{M as default};
