System.register(["./index-legacy-BhBZRkTD.js","./table_mixin-legacy-D9U6ScmD.js","./polyfill-legacy-aWkUxw0k.js"],function(e,t){"use strict";var a,i,s,o,r,d,l,n,c,h,m,u,g,b,f,w,p;return{setters:[e=>{a=e.A,i=e.B,s=e.b,o=e.o,r=e.c,d=e.r,l=e.d,n=e.e,c=e.w,h=e.j,m=e.F,u=e.v,g=e.f,b=e.t,f=e.x,w=e.z},e=>{p=e.t},null],execute:function(){let t=i.base;const v={loadTabDataService:e=>a({url:`${t}/first/getDbSxTab`,method:"post",data:e,showLoading:!0}),loadTableDataService:e=>a({url:`${t}/first/queryDbSx`,method:"post",data:e,showLoading:!0}),editStatusDataService:e=>a({url:`${t}/first/changeDbSx`,method:"post",data:e,showLoading:!0}),getNodeService:e=>a({url:`${t}/first/queryJxdId`,method:"post",data:e,showLoading:!0}),changeDbSxService:e=>a({url:`${t}/first/changeDbSxNew`,method:"post",data:e,showLoading:!0})},D=["src"],T=s({name:"view_iframe",props:{src:String},data:()=>({iframeWin:{}}),mounted(){this.iframeWin=this.$refs.iframe.contentWindow,window.addEventListener("message",this.receiveMessage)},unmounted(){window.removeEventListener("message",this.receiveMessage)},methods:{receiveMessage(e){"returnData"===e.data.event&&this.$emit("returnData",e.data.data),"multi-jxd-close-tab"===e.data.name&&this.$emit("close")}}},[["render",function(e,t,a,i,s,d){return o(),r("iframe",{src:a.src,style:{width:"100%",height:"100%",border:"none"},ref:"iframe",id:"iframe"},null,8,D)}],["__scopeId","data-v-537d0786"]]),x={class:"page_content"},N={key:0,class:"red_point"};e("default",s({name:"dbsx",mixins:[p],data:()=>({total:0,tabList:[],searchParams:{type:""},clickTimer:null}),watch:{"searchParams.type":{handler(e){e&&this.loadTableData()},immediate:!1}},computed:{innerWidth:()=>window.innerWidth,tableHeaderList:()=>[{field:"DQZT",width:10,slots:{default:"dqzt"}},{type:"seq",width:60},{field:"MOULD_NAME",title:"模块"},{field:"PAR_MODULE",title:"名称"},{field:"DBNR",title:"详情",headerAlign:"center",align:"left"},{field:"JZSJ",title:"截止时间"}],gridOptions(){return{height:"auto",keepSource:!0,border:!1,round:!0,headerAlign:"center",align:"center",loading:!1,rowConfig:{isCurrent:!0,isHover:!0},radioConfig:{highlight:!0},toolbarConfig:{slots:{buttons:"toolbarButtons"}},checkboxConfig:{highlight:!0,reserve:!0,showServeStatus:!0,range:!0},showOverflow:this.isAutoWrap,headerCellClassName:"row-class",proxyConfig:{seq:!0,showResponseMsg:!1,showActionMsg:!1,sort:!0,filter:!0,autoLoad:!1,ajax:{query:()=>this.loadTableApi()}},cellClassName:({row:e,column:t})=>"JZSJ"==t.field&&w(e.JZSJ).isBefore(w())?"row-red":null,columns:this.tableHeaderList}}},created(){},mounted(){this.getTabList()},methods:{getTabList(){v.loadTabDataService({}).then(e=>{this.tabList=e.data,this.tabList.length>0&&(this.searchParams.type?this.loadTableData():this.searchParams.type=this.tabList[0].name)})},reloadTableData(){this.$refs.xTable.commitProxy("query")},loadTableData(){this.$refs.xTable.commitProxy("reload")},loadTableApi(){return new Promise(e=>{v.loadTableDataService(this.searchParams).then(t=>{e(t.data)})})},cellClick({row:e}){clearTimeout(this.clickTimer),"未处理"===e.DQZT&&(this.clickTimer=setTimeout(()=>{v.editStatusDataService({id:e.ID,eventId:e.EVENTID,state:"已读"}).then(e=>{this.$message.success(e.data),this.getTabList()})},250))},cellDblclickEvent({column:e,row:t}){clearTimeout(this.clickTimer),v.getNodeService({bh:t.DBNR}).then(e=>{e.data.jxid?("未处理"===t.DQZT&&v.editStatusDataService({id:t.ID,eventId:t.EVENTID,state:"已读"}),this.openIframe(e.data,t)):v.editStatusDataService({id:t.ID,eventId:t.EVENTID,state:"已处理"}).then(()=>{this.getTabList()})})},closeModal(){QClient.Base.Utils.invokeGMethod("pop-notification-window","openFrame","false")},openIframe(e,t){let a="";a=window.origin.includes("192.168.1")?`http://192.168.1.194:10015/master/window.html#/spa/ycjx-rjh/public-visit?flag=13&userName=${this.$store.state.userInfo.sysUser.loginName}&id=${e.jxid}&nodeName=${e.nodeName}&parentNodeName=${e.parentNodeName}&nodeId=${e.nodeId}&flowNodeId=${e.flowNodeId}`:`${window.YCJX_WEBSITE_URL}/master/window.html#/spa/ycjx-rjh/public-visit?flag=13&userName=${this.$store.state.userInfo.sysUser.loginName}&id=${e.jxid}&nodeName=${e.nodeName}&parentNodeName=${e.parentNodeName}&nodeId=${e.nodeId}&flowNodeId=${e.flowNodeId}`,this.$vxeModal.show(T,{src:a},{width:window.innerWidth-10,title:"检修单详情",height:window.innerHeight-10,showZoom:!0},{close:()=>{v.changeDbSxService({state:e.state,jxid:e.jxid,dbId:t.ID,dbState:t.DQZT,eventId:t.EVENTID}).then(()=>{this.getTabList()})}})}}},[["render",function(e,t,a,i,s,w){const p=d("vxe-tab-pane"),v=d("vxe-tabs"),D=d("vxe-grid");return o(),r("div",x,[l("article",null,[n(D,f(w.gridOptions,{ref:"xTable",onCellClick:w.cellClick,onCellDblclick:w.cellDblclickEvent}),{toolbarButtons:c(()=>[n(v,{modelValue:s.searchParams.type,"onUpdate:modelValue":t[0]||(t[0]=e=>s.searchParams.type=e),width:w.innerWidth},{default:c(()=>[(o(!0),r(m,null,u(s.tabList,(e,t)=>(o(),g(p,{title:e.name,name:e.name,key:"tabList"+t},{"title-suffix":c(()=>[l("span",null,"（"+b(e.total)+"）",1)]),_:2},1032,["title","name"]))),128))]),_:1},8,["modelValue","width"])]),dqzt:c(({row:e})=>["未处理"===e.DQZT?(o(),r("span",N)):h("",!0)]),_:1},16,["onCellClick","onCellDblclick"])])])}],["__scopeId","data-v-e555f561"]]))}}});
